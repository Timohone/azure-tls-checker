{
  "count": 100,
  "data": [
    {
      "name": "1",
      "properties": {
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "author": "Microsoft - support@microsoft.com",
            "comments": "Solution template for PaloAlto-PAN-OS"
          },
          "outputs": {},
          "parameters": {
            "location": {
              "defaultValue": "[resourceGroup().location]",
              "metadata": {
                "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
              },
              "minLength": 1,
              "type": "string"
            },
            "workbook1-name": {
              "defaultValue": "Palo Alto overview",
              "metadata": {
                "description": "Name for the workbook"
              },
              "minLength": 1,
              "type": "string"
            },
            "workbook2-name": {
              "defaultValue": "Palo Alto Network Threat",
              "metadata": {
                "description": "Name for the workbook"
              },
              "minLength": 1,
              "type": "string"
            },
            "workspace": {
              "defaultValue": "",
              "metadata": {
                "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
              },
              "type": "string"
            },
            "workspace-location": {
              "defaultValue": "",
              "metadata": {
                "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
              },
              "type": "string"
            }
          },
          "resources": [
            {
              "apiVersion": "2020-10-01",
              "name": "pid-32502f0a-3c95-47de-a7e5-c9e28c9fdac2-partnercenter",
              "properties": {
                "mode": "Incremental",
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "resources": []
                }
              },
              "type": "Microsoft.Resources/deployments"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('dataConnectorTemplateSpecName1')]",
              "properties": {
                "description": "PaloAlto-PAN-OS data connector with template",
                "displayName": "PaloAlto-PAN-OS template"
              },
              "tags": {
                "hidden-sentinelContentType": "DataConnector",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS data connector with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('dataConnectorVersion1')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2021-03-01-preview",
                      "kind": "GenericUI",
                      "location": "[parameters('workspace-location')]",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
                      "properties": {
                        "connectorUiConfig": {
                          "availability": {
                            "isPreview": false,
                            "status": 1
                          },
                          "connectivityCriterias": [
                            {
                              "type": "IsConnectedQuery",
                              "value": [
                                "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                              ]
                            }
                          ],
                          "dataTypes": [
                            {
                              "lastDataReceivedQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)",
                              "name": "CommonSecurityLog (PaloAlto)"
                            }
                          ],
                          "descriptionMarkdown": "The Palo Alto Networks firewall connector allows you to easily connect your Palo Alto Networks logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
                          "graphQueries": [
                            {
                              "baseQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n",
                              "legend": "Palo Alto Networks",
                              "metricName": "Total data received"
                            }
                          ],
                          "id": "[variables('_uiConfigId1')]",
                          "instructionSteps": [
                            {
                              "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                              "innerSteps": [
                                {
                                  "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds.",
                                  "title": "1.1 Select or create a Linux machine"
                                },
                                {
                                  "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                                  "instructions": [
                                    {
                                      "parameters": {
                                        "fillWith": [
                                          "WorkspaceId",
                                          "PrimaryKey"
                                        ],
                                        "label": "Run the following command to install and apply the CEF collector:",
                                        "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                                      },
                                      "type": "CopyableLabel"
                                    }
                                  ],
                                  "title": "1.2 Install the CEF collector on the Linux machine"
                                }
                              ],
                              "title": "1. Linux Syslog agent configuration"
                            },
                            {
                              "description": "Configure Palo Alto Networks to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nGo to [configure Palo Alto Networks NGFW for sending CEF events.](https://aka.ms/sentinel-paloaltonetworks-readme)\n\nGo to [Palo Alto CEF Configuration](https://aka.ms/asi-syslog-paloalto-forwarding)  and Palo Alto [Configure Syslog Monitoring](https://aka.ms/asi-syslog-paloalto-configure)  steps 2, 3, choose your version, and follow the instructions using the following guidelines:\n\n1.  Set the Syslog server format to  **BSD**.\n\n2.  The copy/paste operations from the PDF might change the text and insert random characters. To avoid this, copy the text to an editor and remove any characters that might break the log format before pasting it.\n\n[Learn more >](https://aka.ms/CEFPaloAlto)",
                              "title": "2. Forward Palo Alto Networks logs to Syslog agent"
                            },
                            {
                              "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
                              "instructions": [
                                {
                                  "parameters": {
                                    "fillWith": [
                                      "WorkspaceId"
                                    ],
                                    "label": "Run the following command to validate your connectivity:",
                                    "value": "sudo wget  -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                                  },
                                  "type": "CopyableLabel"
                                }
                              ],
                              "title": "3. Validate connection"
                            },
                            {
                              "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                              "title": "4. Secure your machine "
                            }
                          ],
                          "metadata": {
                            "author": {
                              "name": "Palo Alto Networks"
                            },
                            "id": "ef80260c-3aec-43bc-a1e5-c2f2372c9adc",
                            "kind": "dataConnector",
                            "source": {
                              "kind": "community"
                            },
                            "support": {
                              "link": "https://www.paloaltonetworks.com/company/contact-support",
                              "name": "Palo Alto Networks",
                              "tier": "developer"
                            },
                            "version": "1.0.0"
                          },
                          "permissions": {
                            "resourceProvider": [
                              {
                                "permissionsDisplayText": "read and write permissions are required.",
                                "provider": "Microsoft.OperationalInsights/workspaces",
                                "providerDisplayName": "Workspace",
                                "requiredPermissions": {
                                  "delete": true,
                                  "read": true,
                                  "write": true
                                },
                                "scope": "Workspace"
                              },
                              {
                                "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                                "providerDisplayName": "Keys",
                                "requiredPermissions": {
                                  "action": true
                                },
                                "scope": "Workspace"
                              }
                            ]
                          },
                          "publisher": "Palo Alto Networks",
                          "sampleQueries": [
                            {
                              "description": "All logs",
                              "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | sort by TimeGenerated"
                            },
                            {
                              "description": "THREAT activity",
                              "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | where Activity == \"THREAT\"\n            | sort by TimeGenerated"
                            }
                          ],
                          "title": "Palo Alto Networks (Firewall)"
                        }
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_dataConnectorContentId1')]",
                        "kind": "DataConnector",
                        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('dataConnectorVersion1')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "DataConnector",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "dependsOn": [
                "[variables('_dataConnectorId1')]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "author": {
                  "email": "[variables('_email')]",
                  "name": "Microsoft"
                },
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "[variables('dataConnectorVersion1')]"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            },
            {
              "apiVersion": "2021-03-01-preview",
              "kind": "GenericUI",
              "location": "[parameters('workspace-location')]",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "properties": {
                "connectorUiConfig": {
                  "availability": {
                    "isPreview": false,
                    "status": 1
                  },
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "dataTypes": [
                    {
                      "lastDataReceivedQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)",
                      "name": "CommonSecurityLog (PaloAlto)"
                    }
                  ],
                  "descriptionMarkdown": "The Palo Alto Networks firewall connector allows you to easily connect your Palo Alto Networks logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
                  "graphQueries": [
                    {
                      "baseQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n",
                      "legend": "Palo Alto Networks",
                      "metricName": "Total data received"
                    }
                  ],
                  "id": "[variables('_uiConfigId1')]",
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds.",
                          "title": "1.1 Select or create a Linux machine"
                        },
                        {
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ],
                          "title": "1.2 Install the CEF collector on the Linux machine"
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "Configure Palo Alto Networks to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nGo to [configure Palo Alto Networks NGFW for sending CEF events.](https://aka.ms/sentinel-paloaltonetworks-readme)\n\nGo to [Palo Alto CEF Configuration](https://aka.ms/asi-syslog-paloalto-forwarding)  and Palo Alto [Configure Syslog Monitoring](https://aka.ms/asi-syslog-paloalto-configure)  steps 2, 3, choose your version, and follow the instructions using the following guidelines:\n\n1.  Set the Syslog server format to  **BSD**.\n\n2.  The copy/paste operations from the PDF might change the text and insert random characters. To avoid this, copy the text to an editor and remove any characters that might break the log format before pasting it.\n\n[Learn more >](https://aka.ms/CEFPaloAlto)",
                      "title": "2. Forward Palo Alto Networks logs to Syslog agent"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget  -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "permissions": {
                    "resourceProvider": [
                      {
                        "permissionsDisplayText": "read and write permissions are required.",
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "providerDisplayName": "Workspace",
                        "requiredPermissions": {
                          "delete": true,
                          "read": true,
                          "write": true
                        },
                        "scope": "Workspace"
                      },
                      {
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "providerDisplayName": "Keys",
                        "requiredPermissions": {
                          "action": true
                        },
                        "scope": "Workspace"
                      }
                    ]
                  },
                  "publisher": "Palo Alto Networks",
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "THREAT activity",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | where Activity == \"THREAT\"\n            | sort by TimeGenerated"
                    }
                  ],
                  "title": "Palo Alto Networks (Firewall)"
                }
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('huntingQueryTemplateSpecName1')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Hunting Query 1 with template",
                "displayName": "PaloAlto-PAN-OS Hunting Query template"
              },
              "tags": {
                "hidden-sentinelContentType": "HuntingQuery",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('huntingQueryTemplateSpecName1'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('huntingQueryTemplateSpecName1'),'/',variables('huntingQueryVersion1'))]",
              "properties": {
                "description": "PaloAlto-HighRiskPorts_HuntingQueries Hunting Query with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('huntingQueryVersion1')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2020-08-01",
                      "location": "[parameters('workspace-location')]",
                      "name": "PaloAlto-PAN-OS_Hunting_Query_1",
                      "properties": {
                        "category": "Hunting Queries",
                        "displayName": "Palo Alto - high-risk ports",
                        "eTag": "*",
                        "query": "\nlet HighRiskPorts = datatable (Port:int, Protocol:string, RiskType:string, RiskDescription:string)[\n13,\"udp\",\"3rd Party Attacks\",\"Daytime protocol used in reflection/amplification attacks\",\n17,\"udp\",\"3rd Party Attacks\",\"QOTD protocol, reflection/amplification attacks\",\n19,\"udp\",\"3rd Party Attacks\",\"Chargen protocol, reflection/amplification attacks\",\n20,\"tcp\",\"Unencrypted\",\"Unencrypted FTP Traffic\",\n21,\"tcp\",\"Unencrypted\",\"Unencrypted FTP Traffic\",\n22,\"tcp\",\"Management\",\"SSH, brute force attacks common\",\n23,\"tcp\",\"Management\",\"Telnet, allows unauthenticated and/or unencrypted\",\n53,\"udp\",\"3rd Party Attacks\",\"DNS, reflection/amplification attacks\",\n69,\"udp\",\"Management\",\"TFTP, allows unauthenticated and/or unencrypted\",\n111,\"udp\",\"Management\",\"RPC, unencrypted authentication allowed\",\n111,\"tcp\",\"Management\",\"RPC, unencrypted authentication allowed\",\n119,\"tcp\",\"Unsecure\",\"NNTP, unencrypted authentication\",\n123,\"udp\",\"3rd Party Attacks\",\"Network Time Protocol, reflection/amplification attacks\",\n135,\"tcp\",\"Management\",\"End Point Mapper, multiple remote management srvcs\",\n135,\"udp\",\"Management\",\"End Point Mapper, multiple remote management srvcs\",\n137,\"tcp\",\"Hacker Recon\",\"Netbios Name Service\",\n137,\"udp\",\"Hacker Recon\",\"Netbios Name Service\",\n138,\"tcp\",\"Hacker Recon\",\"Netbios Datagram Service\",\n138,\"udp\",\"Hacker Recon\",\"Netbios Datagram Service\",\n139,\"tcp\",\"Hacker Recon\",\"Netbios Session Service\",\n161,\"tcp\",\"Unsecure/3rd Party Attacks\",\"SNMP, unsecure / no authentication UDP Reflection attacks\",\n161,\"udp\",\"Unsecure/3rd Party Attacks\",\"SNMP, unsecure / no authentication UDP Reflection attacks\",\n162,\"tcp\",\"Unsecure\",\"SNMP Trap, unsecure / no authentication\",\n162,\"udp\",\"Unsecure\",\"SNMP Trap, unsecure / no authentication\",\n389,\"tcp\",\"Hacker Recon/3rd Party Attacks\",\"LDAP/CLDAP\",\n389,\"udp\",\"Hacker Recon/3rd Party Attacks\",\"LDAP/CLDAP\",\n443,\"udp\",\"3rd Party Attacks\",\"UDP Reflection / Amplification attacks\",\n445,\"tcp\",\"Unsecure\",\"SMB - well known attack vector\",\n512,\"tcp\",\"Management\",\"Rexec on Linux, remote commands w/o encrypt auth\",\n514,\"tcp\",\"Management\",\"Remote Shell, remote commands w/o auth or encrypt\",\n593,\"tcp\",\"Management\",\"HTTP RPC EPMAP, unencrypted remote procedure call\",\n593,\"udp\",\"Management\",\"HTTP RPC EPMAP, unencrypted remote procedure call\",\n636,\"tcp\",\"Hacker Recon\",\"Lightweight Directory Access Protocol\",\n873,\"tcp\",\"Management\",\"Rsync, unencrypted file transfer\",\n1433,\"tcp\",\"Data Access/Mgmt\",\"MS SQL Management & Data Access\",\n1434,\"udp\",\"Data Access/Mgmt\",\"MS SQL Monitor Port\",\n1900,\"udp\",\"Hacker Recon/3rd Party Attacks\",\"Simple Service Discovery Protocol, unencrypted\",\n2049,\"tcp\",\"Unsecure\",\"Network File System\",\n2049,\"udp\",\"Unsecure\",\"Network File System\",\n2301,\"tcp\",\"Hacker Recon\",\"Compaq Management Service, no recent incidents\",\n2381,\"tcp\",\"Management\",\"Compaq Management Service, no recent incidents\",\n3268,\"tcp\",\"Hacker Recon\",\"Microsoft Global Catalog LDAP\",\n3306,\"tcp\",\"Data Access/Mgmt\",\"MySQL Database Management Port\",\n3389,\"tcp\",\"Management/3rd Party Attacks\",\"RDP, Common brute force attack port\",\n3389,\"udp\",\"Management/3rd Party Attacks\",\"RDP, Common brute force attack port\",\n4333,\"tcp\",\"Data Access/Mgmt\",\"MSql\",\n5353,\"udp\",\"3rd Party Attacks\",\"mDNS\",\n5432,\"tcp\",\"Data Access/Mgmt\",\"PostgresSQL Database Management\",\n5800,\"tcp\",\"Management\",\"VNC Remote Frame Buffer over HTTP\",\n5900,\"tcp\",\"Management\",\"VNC Remote Frame Buffer over HTTP\",\n5985,\"tcp\",\"Management\",\"Windows Powershell\",\n5986,\"tcp\",\"Management\",\"Windows Powershell\",\n6379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n7000,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n7001,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n7199,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9042,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9160,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9200,\"tcp\",\"Data Access/Mgmt\",\"Elastic Search\",\n9300,\"tcp\",\"Data Access/Mgmt\",\"Elastic Search\",\n9987,\"udp\",\"3rd Party Attack\",\"DSM/SCM Target Interface\",\n11211,\"udp\",\"Unencrypted\",\"Memcached\",\n16379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n26379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n27017,\"tcp\",\"Data Access/Mgmt\",\"MongoDB\",\n];\nHighRiskPorts\n| join kind=inner (\n  CommonSecurityLog\n  | where DeviceVendor == \"Palo Alto Networks\" and Activity == \"TRAFFIC\" and DeviceAction != \"deny\"\n  | where SentBytes > 0 and ReceivedBytes > 0\n  //Remove private IP communation from DestinationIP\n  | extend result = ipv4_is_private(DestinationIP) \n  | where result == 0\n  | summarize\n      Count = count(),\n      StartTime = min(TimeGenerated),\n      EndTime = max(TimeGenerated)\n      by \n      DeviceName,\n      SourceIP,\n      DestinationIP,\n      DestinationPort,\n      Protocol\n) on $left.Port == $right.DestinationPort and $left.Protocol == $right.Protocol\n| project-away Protocol1, Port\n| order by DeviceName asc, SourceIP asc, DestinationIP asc, DestinationPort asc\n| extend timestamp = StartTime, IPCustomEntity = SourceIP\n",
                        "tags": [
                          {
                            "name": "description",
                            "value": "Identifies network connections whose ports are frequent targets of attacks and should not cross network boundaries or reach untrusted public networks.\nConsider updating the firewall policies to block the connections."
                          },
                          {
                            "name": "tactics",
                            "value": "InitialAccess,Discovery"
                          }
                        ],
                        "version": 2
                      },
                      "type": "Microsoft.OperationalInsights/savedSearches"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('HuntingQuery-', last(split(variables('huntingQueryId1'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_huntingQuerycontentId1')]",
                        "description": "PaloAlto-PAN-OS Hunting Query 1",
                        "kind": "HuntingQuery",
                        "parentId": "[variables('huntingQueryId1')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('huntingQueryVersion1')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "HuntingQuery",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('workbookTemplateSpecName1')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Workbook with template",
                "displayName": "PaloAlto-PAN-OS workbook template"
              },
              "tags": {
                "hidden-sentinelContentType": "Workbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
              "properties": {
                "description": "PaloAltoOverviewWorkbook Workbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('workbookVersion1')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2021-08-01",
                      "kind": "shared",
                      "location": "[parameters('workspace-location')]",
                      "metadata": {
                        "description": "Gain insights and comprehensive monitoring into Palo Alto firewalls by analyzing traffic and activities.\nThis workbook correlates all Palo Alto data with threat events to identify suspicious entities and relationships.\nYou can learn about trends across user and data traffic, and drill down into Palo Alto Wildfire and filter results."
                      },
                      "name": "[variables('workbookContentId1')]",
                      "properties": {
                        "category": "sentinel",
                        "displayName": "[parameters('workbook1-name')]",
                        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<div style=\\\"font-size: 200%;\\\">Palo Alto Networks overview</div>\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"a5c18655-3e2d-4d12-8ba4-82e57b296581\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"32f5a8aa-9c54-4fd1-a2b9-8461b2c57f55\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Source_IP\",\"label\":\"Source IP\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by SourceIP\\r\\n| where SourceIP != \\\"\\\"\\r\\n| order by Count desc, SourceIP asc\\r\\n| project Value = SourceIP, Label = strcat(SourceIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":1800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"b937ca33-bc62-4183-bc0f-9ad8306dc36a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Destination_IP\",\"label\":\"Destination IP\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by DestinationIP\\r\\n| where DestinationIP != \\\"\\\"\\r\\n| order by Count desc, DestinationIP asc\\r\\n| project Value = DestinationIP, Label = strcat(DestinationIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\",\"value\":[\"value::all\"],\"typeSettings\":{\"limitSelectTo\":10,\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"7f28bae3-a11f-408a-832f-77a0f3e633d7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EventClass\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| distinct DeviceEventClassID\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 35\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass});\\r\\ndata\\r\\n| summarize Count = count() by Activity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Activity)\\r\\n on Activity\\r\\n| project-away Activity1, TimeGenerated\\r\\n| extend Activitys = Activity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Activity = 'All', Activitys = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"Activity\",\"exportParameterName\":\"activities\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Activities, by volume\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Activity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"lightBlue\",\"showIcon\":true}},{\"columnMatch\":\"Activitys\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"name\":\"all activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass})\\r\\n| where '{activities}' == \\\"All\\\" or Activity == '{activities}'\\r\\n| summarize LogVolume=count() by DeviceEventClassID, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"aggregation\":3,\"exportToExcelOptions\":\"visible\",\"title\":\"Event trend, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"LogVolume\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Event trend by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//trend by sevearity\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass})\\r\\n| where '{activities}' == \\\"All\\\" or Activity == '{activities}'\\r\\n| summarize count() by bin_at(TimeGenerated, {TimeRange:grain},{TimeRange:start}), LogSeverity\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Events severity, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Events severity over time\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n### Traffic events summary\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ \\\"Traffic\\\";\\r\\ndata\\r\\n| summarize Count = count() by DeviceEventClassID\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceEventClassID)\\r\\n on DeviceEventClassID\\r\\n| project-away DeviceEventClassID1, TimeGenerated\\r\\n| extend DeviceEventClassIDs = DeviceEventClassID\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceEventClassID = 'All', DeviceEventClassIDs = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceEventClassID\",\"exportParameterName\":\"EventClass\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Device events Id summary - click to filter the graph below\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"Traffic event summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ \\\"Traffic\\\";\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceAction = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"DeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Device action summary - click to filter the graph below\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Traffic activity summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC'\\r\\n| where '{EventClass}' == \\\"All\\\" or DeviceEventClassID=='{EventClass}'\\r\\n| summarize EventCount= count() by DeviceAction, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Device action, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"Traffic activity by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where '{DeviceAction}' == \\\"All\\\" or DeviceAction=='{DeviceAction}'\\r\\n| where Activity =~ \\\"Traffic\\\"\\r\\n| summarize EventCount= count() by DeviceEventClassID, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Device events Id, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"Traffic class ID by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS' \\r\\n| where DeviceVendor =~ 'Palo Alto Networks' \\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC' \\r\\n| where DeviceEventClassID =~ 'end' \\r\\n| extend Reason = coalesce(\\r\\n                            column_ifexists(\\\"Reason\\\", \\\"\\\"),\\r\\n                            extract(';reason=(.*?);',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize ReasonCount= count() by  Reason, TimeGenerated  \\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Reasons for session ending, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Reasons for session ending\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Data sent outbound vs inbound\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC'\\r\\n| extend Direction=iff(DeviceCustomString4=~'Trust','Outbound' ,'Inbound' )\\r\\n| summarize DataSentOutBoundMB=sumif(SentBytes, Direction=~'Outbound')/1048576,   DataRecievedInboundMB=sumif(ReceivedBytes, Direction=~'Inbound')/1048576 by TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Sent and received data, by volume\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Sent and received data by volume\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Web filter\"},\"name\":\"text - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction contains 'block'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked URLs, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"purple\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 blocked URLs by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction in ('block-url', 'block-continue')\\r\\n| summarize CategoryCount=count() by DeviceCustomString2\\r\\n| project-rename CategoryName= DeviceCustomString2\\r\\n| top 5 by CategoryCount\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 URL blocked, by category\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CategoryName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"op 5 URL blocked by category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('block-url', 'block-continue')\\r\\n| summarize URLCount=count() by RequestURL\\r\\n| top 5 by URLCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"Top 5 blocked URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| summarize ProtocolCount=count() by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 URLs, by application protocols\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 URLs by application protocols\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize URLCount=count() by RequestURL\\r\\n| top 5 by URLCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RequestURL\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"URLCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| summarize ActionCount=count() by DeviceAction\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"URL threat event summary\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActionCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"URL threat event summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction contains 'block'\\r\\n| extend PAReferer= extract(';PanOSReferer=(.*?);',1,AdditionalExtensions)\\r\\n| where PAReferer !=''\\r\\n| summarize RefererCount= count() by PAReferer\\r\\n| top 5 by RefererCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 referrers for blocked URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"Top 5 referrers for blocked URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize CategoryCount=count() by DeviceCustomString2\\r\\n| project-rename CategoryName= DeviceCustomString2\\r\\n| top 5 by CategoryCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs, by category\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CategoryName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed URLs, by category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction !contains 'block'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed URLs by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| summarize ActionCount=count() by DeviceAction, TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Web filter ativity, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActionCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Web filter ativity by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize IPCount=count() by SourceIP\\r\\n| top 5 by IPCount  desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed web traffic source IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IPCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed web traffic source IP addresses\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Wildfire\"},\"name\":\"text - 24\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'wildfire'\\r\\n| summarize ActionCount=count() by DeviceAction, TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Wildfire events, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Wildfire events, by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceActions = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| project DeviceAction, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"DeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Wildfire activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"grayBlue\",\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"sortBy\":[{\"itemKey\":\"DeviceAction\",\"sortOrder\":1}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Top 5 Wildfire activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceCustomString2\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceCustomString2)\\r\\n on DeviceCustomString2\\r\\n| project-away DeviceCustomString21, TimeGenerated\\r\\n| extend DeviceCustomString2s = DeviceCustomString2\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceCustomString2 = 'All', DeviceCustomString2s = '*' \\r\\n)\\r\\n| project DeviceCustomString2, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceCustomString2\",\"exportParameterName\":\"DeviceString\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Wildfire verdicts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"grayBlue\",\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"sortBy\":[{\"itemKey\":\"DeviceAction\",\"sortOrder\":1}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceCustomString2\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Top 5 Wildfire verdicts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'wildfire'\\r\\n| where '{DeviceAction}' == \\\"All\\\" or DeviceAction=='{DeviceAction}'\\r\\n| where '{DeviceString}' == \\\"All\\\" or DeviceCustomString2=='{DeviceString}'\\r\\n| project TimeGenerated, ReceiptTime, LogSeverity, DeviceAction, ['URL Category'] =DeviceCustomString2, DestinationPort, DestinationIP, Message, SourcePort, SourceIP, DestinationUserID, RequestURL\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Wildfire events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"Wildfire events\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## General statistics\"},\"name\":\"text - 30\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID  =~ 'file'\\r\\n| where DeviceAction contains 'deny'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied files, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 denied files by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID  =~ 'file'\\r\\n| where DeviceAction !contains 'deny'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed files, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed files by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Palo Alto File Category By Action Summary\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS' \\r\\n| where DeviceVendor =~ 'Palo Alto Networks' \\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID =~ 'file' \\r\\n| extend PACategory= coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract(';cat=(.*?)($|;)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize CategoryCount=count() by PACategory\\r\\n| sort by CategoryCount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Summary of Palo Alto file categories, by activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"PACategory\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}}]}},\"customWidth\":\"33\",\"name\":\"Summary of Palo Alto file categories by activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'file'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceActions = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| project DeviceAction, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\\r\\n\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"SelectedDA\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Summary of file type activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Summary of file type activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'file'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where '{SelectedDA}' == \\\"All\\\" or DeviceAction == '{SelectedDA}'\\r\\n| summarize ActionCount=count() by DeviceAction, bin(TimeGenerated, {TimeRange:grain})\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Compare allowed and denied files, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"Compare allowed and denied files by time\"}],\"fromTemplateId\":\"sentinel-PaloAltoOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                        "sourceId": "[variables('workspaceResourceId')]",
                        "version": "1.0"
                      },
                      "type": "Microsoft.Insights/workbooks"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_workbookContentId1')]",
                        "description": "@{workbookKey=PaloAltoOverviewWorkbook; logoFileName=paloalto_logo.svg; description=Gain insights and comprehensive monitoring into Palo Alto firewalls by analyzing traffic and activities.\nThis workbook correlates all Palo Alto data with threat events to identify suspicious entities and relationships.\nYou can learn about trends across user and data traffic, and drill down into Palo Alto Wildfire and filter results.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.2.0; title=Palo Alto overview; templateRelativePath=PaloAltoOverview.json; subtitle=; provider=Microsoft}.description",
                        "kind": "Workbook",
                        "parentId": "[variables('workbookId1')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('workbookVersion1')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Workbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('workbookTemplateSpecName2')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Workbook with template",
                "displayName": "PaloAlto-PAN-OS workbook template"
              },
              "tags": {
                "hidden-sentinelContentType": "Workbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName2'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('workbookTemplateSpecName2'),'/',variables('workbookVersion2'))]",
              "properties": {
                "description": "PaloAltoNetworkThreatWorkbook Workbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('workbookVersion2')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2021-08-01",
                      "kind": "shared",
                      "location": "[parameters('workspace-location')]",
                      "metadata": {
                        "description": "Gain insights into Palo Alto network activities by analyzing threat events.\nYou can extract meaningful security information by correlating data between threats, applications, and time.\nThis workbook makes it easy to track malware, vulnerability, and virus log events."
                      },
                      "name": "[variables('workbookContentId2')]",
                      "properties": {
                        "category": "sentinel",
                        "displayName": "[parameters('workbook2-name')]",
                        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Palo Alto network threat\\n\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"d0ccb5c6-8a07-4b7e-9abf-38fa4dcc0baf\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":43200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file';\\r\\ndata\\r\\n| summarize Count = count() by DeviceEventClassID\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceEventClassID)\\r\\n on DeviceEventClassID\\r\\n| project-away DeviceEventClassID1, TimeGenerated\\r\\n| extend DeviceEventClassIDs = DeviceEventClassID\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceEventClassID = 'All', DeviceEventClassIDs = '*' \\r\\n)\\r\\n| project DeviceEventClassID, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"DeviceEventClassID\",\"exportParameterName\":\"SelectedSubtype\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Threats, by subtypes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Threats by subtypes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire';\\r\\ndata\\r\\n| summarize Count = count() by DeviceCustomString2\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceCustomString2)\\r\\n on DeviceCustomString2\\r\\n| project-away DeviceCustomString21, TimeGenerated\\r\\n| extend DeviceCustomString2s = DeviceCustomString2\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceCustomString2 = 'All', DeviceCustomString2s = '*' \\r\\n)\\r\\n| project DeviceCustomString2, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"DeviceCustomString2\",\"exportParameterName\":\"SelectedWildfire\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"WildFire verdicts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceCustomString2\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"WildFire verdicts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and LogSeverity != 'url' and LogSeverity != 'file';\\r\\ndata\\r\\n| summarize Count = count() by LogSeverity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by LogSeverity)\\r\\n on LogSeverity\\r\\n| project-away LogSeverity1, TimeGenerated\\r\\n| extend LogSeveritys = LogSeverity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend LogSeverity = 'All', LogSeveritys = '*' \\r\\n)\\r\\n| project LogSeverity, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"LogSeverity\",\"exportParameterName\":\"SelectedSeverity\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Threats severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"lightBlue\",\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Threats severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| summarize count() by bin(TimeGenerated, 1h), DeviceEventClassID\\r\\n| render timechart\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat subtypes over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"37.5\",\"name\":\"Threat subtypes over time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| summarize count() by bin(TimeGenerated, 1h), LogSeverity\\r\\n| render timechart\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat severity over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"37.5\",\"name\":\"Threat severity over time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity;\\r\\ndata\\r\\n| summarize Count = count() by ApplicationProtocol\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ApplicationProtocol)\\r\\n on ApplicationProtocol\\r\\n| project-away ApplicationProtocol1, TimeGenerated\\r\\n| extend ApplicationProtocols = ApplicationProtocol\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend ApplicationProtocol = 'All', ApplicationProtocols = '*' \\r\\n)\\r\\n| project ApplicationProtocol, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threats, by application\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Threats by application\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| project TimeGenerated, ReceiptTime, LogSeverity, DeviceAction, ['URL Category'] =DeviceCustomString2, DestinationPort, DestinationIP, Message, SourcePort, SourceIP, DestinationUserID, RequestURL\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"All Threat Events\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where DeviceEventClassID =~ 'vulnerability' \\r\\n| extend ThreatId = coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract('cat=([^;]+)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize Amount=count() by ThreatId, LogSeverity\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top vulnerability events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ThreatId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"Top vulnerability events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| search DeviceEventClassID:'*virus*'\\r\\n| summarize Amount=count() by RequestURL, DeviceEventClassID, DestinationIP, SourceIP, ApplicationProtocol\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Virus and malware events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RequestURL\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"SourceUserID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"Virus and malware events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n//| where DeviceEventClassID =~ 'correlation' \\r\\n| extend ThreatId = coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract('cat=([^;]+)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| extend ThreatCategory = extract('PanOSThreatCategory=([^;]+)',1, AdditionalExtensions)\\r\\n| summarize Amount=count() by ThreatId, ThreatCategory, LogSeverity\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top correlation events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ThreatId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ThreatCategory\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"name\":\"Top correlation events\"}],\"fromTemplateId\":\"sentinel-PaloAltoNetworkThreat\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                        "sourceId": "[variables('workspaceResourceId')]",
                        "version": "1.0"
                      },
                      "type": "Microsoft.Insights/workbooks"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_workbookContentId2')]",
                        "description": "@{workbookKey=PaloAltoNetworkThreatWorkbook; logoFileName=paloalto_logo.svg; description=Gain insights into Palo Alto network activities by analyzing threat events.\nYou can extract meaningful security information by correlating data between threats, applications, and time.\nThis workbook makes it easy to track malware, vulnerability, and virus log events.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.0; title=Palo Alto Network Threat; templateRelativePath=PaloAltoNetworkThreat.json; subtitle=; provider=Palo Alto Networks}.description",
                        "kind": "Workbook",
                        "parentId": "[variables('workbookId2')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('workbookVersion2')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Workbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('analyticRuleTemplateSpecName1')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Analytics Rule 1 with template",
                "displayName": "PaloAlto-PAN-OS Analytics Rule template"
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName1'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('analyticRuleTemplateSpecName1'),'/',variables('analyticRuleVersion1'))]",
              "properties": {
                "description": "PaloAlto-UnusualThreatSignatures_AnalyticalRules Analytics Rule with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('analyticRuleVersion1')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2022-04-01-preview",
                      "kind": "Scheduled",
                      "location": "[parameters('workspace-location')]",
                      "name": "[variables('AnalyticRulecontentId1')]",
                      "properties": {
                        "description": "Identifies Palo Alto Threat signatures from unusual IP addresses which are not historically seen. \nThis detection is also leveraged and required for MDE and PAN Fusion scenario\nhttps://docs.microsoft.com/Azure/sentinel/fusion-scenario-reference#network-request-to-tor-anonymization-service-followed-by-anomalous-traffic-flagged-by-palo-alto-networks-firewall",
                        "displayName": "Palo Alto Threat signatures from Unusual IP addresses",
                        "enabled": false,
                        "entityMappings": [
                          {
                            "entityType": "IP",
                            "fieldMappings": [
                              {
                                "columnName": "SourceIP",
                                "identifier": "Address"
                              }
                            ]
                          }
                        ],
                        "query": "let starttime = 7d;\nlet endtime = 1d;\nlet timeframe = 1h;\nlet HistThreshold = 25; \nlet CurrThreshold = 10; \nlet HistoricalThreats = CommonSecurityLog\n| where isnotempty(SourceIP)\n| where TimeGenerated between (startofday(ago(starttime))..startofday(ago(endtime)))\n| where DeviceVendor =~ \"Palo Alto Networks\"\n| where Activity =~ \"THREAT\" and SimplifiedDeviceAction =~ \"alert\" \n| where DeviceEventClassID in ('spyware', 'scan', 'file', 'vulnerability', 'flood', 'packet', 'virus','wildfire', 'wildfire-virus')\n| summarize TotalEvents = count(), ThreatTypes = make_set(DeviceEventClassID), DestinationIpList = make_set(DestinationIP), FirstSeen = min(TimeGenerated) , LastSeen = max(TimeGenerated) by SourceIP, DeviceAction, DeviceVendor;\nlet CurrentHourThreats =  CommonSecurityLog\n| where isnotempty(SourceIP)\n| where TimeGenerated > ago(timeframe)\n| where DeviceVendor =~ \"Palo Alto Networks\"\n| where Activity =~ \"THREAT\" and SimplifiedDeviceAction =~ \"alert\" \n| where DeviceEventClassID in ('spyware', 'scan', 'file', 'vulnerability', 'flood', 'packet', 'virus','wildfire', 'wildfire-virus')\n| summarize TotalEvents = count(), ThreatTypes = make_set(DeviceEventClassID), DestinationIpList = make_set(DestinationIP), FirstSeen = min(TimeGenerated) , LastSeen = max(TimeGenerated) by SourceIP, DeviceAction, DeviceProduct, DeviceVendor;\nCurrentHourThreats \n| where TotalEvents < CurrThreshold\n| join kind = leftanti (HistoricalThreats \n| where TotalEvents > HistThreshold) on SourceIP\n",
                        "queryFrequency": "PT1H",
                        "queryPeriod": "P7D",
                        "requiredDataConnectors": [
                          {
                            "connectorId": "PaloAltoNetworks",
                            "dataTypes": [
                              "CommonSecurityLog"
                            ]
                          }
                        ],
                        "severity": "Medium",
                        "status": "Available",
                        "suppressionDuration": "PT1H",
                        "suppressionEnabled": false,
                        "tactics": [
                          "Discovery",
                          "Exfiltration",
                          "CommandAndControl"
                        ],
                        "triggerOperator": "GreaterThan",
                        "triggerThreshold": 0
                      },
                      "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_analyticRulecontentId1')]",
                        "description": "PaloAlto-PAN-OS Analytics Rule 1",
                        "kind": "AnalyticsRule",
                        "parentId": "[variables('analyticRuleId1')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('analyticRuleVersion1')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('analyticRuleTemplateSpecName2')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Analytics Rule 2 with template",
                "displayName": "PaloAlto-PAN-OS Analytics Rule template"
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName2'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('analyticRuleTemplateSpecName2'),'/',variables('analyticRuleVersion2'))]",
              "properties": {
                "description": "FileHashEntity_Covid19_CommonSecurityLog_AnalyticalRules Analytics Rule with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('analyticRuleVersion2')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2022-04-01-preview",
                      "kind": "Scheduled",
                      "location": "[parameters('workspace-location')]",
                      "name": "[variables('AnalyticRulecontentId2')]",
                      "properties": {
                        "description": "Identifies a match in CommonSecurityLog Event data from any FileHash published in the Microsoft COVID-19 Threat Intel Feed - as described at https://www.microsoft.com/security/blog/2020/05/14/open-sourcing-covid-threat-intelligence/",
                        "displayName": "Microsoft COVID-19 file hash indicator matches",
                        "enabled": false,
                        "entityMappings": [
                          {
                            "entityType": "Account",
                            "fieldMappings": [
                              {
                                "columnName": "AccountCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "Host",
                            "fieldMappings": [
                              {
                                "columnName": "HostCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "IP",
                            "fieldMappings": [
                              {
                                "columnName": "IPCustomEntity",
                                "identifier": "Address"
                              }
                            ]
                          },
                          {
                            "entityType": "FileHash",
                            "fieldMappings": [
                              {
                                "columnName": "FileHashValue",
                                "identifier": "Value"
                              },
                              {
                                "columnName": "FileHashType",
                                "identifier": "Algorithm"
                              }
                            ]
                          }
                        ],
                        "query": "\nlet dt_lookBack = 1h;\nlet covidIndicators = (externaldata(TimeGenerated:datetime, FileHashValue:string, FileHashType: string, TlpLevel: string, Product: string, ThreatType: string, Description: string )\n[@\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/Microsoft.Covid19.Indicators.csv\"] with (format=\"csv\"));\nlet fileHashIndicators = covidIndicators\n| where isnotempty(FileHashValue);\n// Handle matches against both lower case and uppercase versions of the hash:\n(fileHashIndicators | extend FileHashValue = tolower(FileHashValue)\n| union (fileHashIndicators | extend FileHashValue = toupper(FileHashValue)))\n// using innerunique to keep perf fast and result set low, we only need one match to indicate potential malicious activity that needs to be investigated\n|  join kind=innerunique (\n   CommonSecurityLog | where TimeGenerated >= ago(dt_lookBack) \n   | where isnotempty(FileHash)\n   | extend CommonSecurityLog_TimeGenerated = TimeGenerated\n   )\non $left.FileHashValue == $right.FileHash\n| summarize CommonSecurityLog_TimeGenerated = arg_max(CommonSecurityLog_TimeGenerated, *) by FileHashValue\n| project CommonSecurityLog_TimeGenerated, FileHashValue, FileHashType, Description, ThreatType,  \nSourceIP, SourcePort, DestinationIP, DestinationPort, SourceUserID, SourceUserName, DeviceName, DeviceAction, \nRequestURL, DestinationUserName, DestinationUserID, ApplicationProtocol, Activity\n| extend timestamp = CommonSecurityLog_TimeGenerated, IPCustomEntity = SourceIP, HostCustomEntity = DeviceName, AccountCustomEntity = SourceUserName\n",
                        "queryFrequency": "PT1H",
                        "queryPeriod": "P14D",
                        "requiredDataConnectors": [
                          {
                            "connectorId": "PaloAltoNetworks",
                            "dataTypes": [
                              "CommonSecurityLog"
                            ]
                          }
                        ],
                        "severity": "Medium",
                        "status": "Available",
                        "suppressionDuration": "PT1H",
                        "suppressionEnabled": false,
                        "tactics": [
                          "Impact"
                        ],
                        "triggerOperator": "GreaterThan",
                        "triggerThreshold": 0
                      },
                      "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_analyticRulecontentId2')]",
                        "description": "PaloAlto-PAN-OS Analytics Rule 2",
                        "kind": "AnalyticsRule",
                        "parentId": "[variables('analyticRuleId2')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('analyticRuleVersion2')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('analyticRuleTemplateSpecName3')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Analytics Rule 3 with template",
                "displayName": "PaloAlto-PAN-OS Analytics Rule template"
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName3'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('analyticRuleTemplateSpecName3'),'/',variables('analyticRuleVersion3'))]",
              "properties": {
                "description": "PaloAlto-NetworkBeaconing_AnalyticalRules Analytics Rule with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('analyticRuleVersion3')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2022-04-01-preview",
                      "kind": "Scheduled",
                      "location": "[parameters('workspace-location')]",
                      "name": "[variables('AnalyticRulecontentId3')]",
                      "properties": {
                        "description": "Identifies beaconing patterns from Palo Alto Network traffic logs based on recurrent timedelta patterns. \nThe query leverages various KQL functions to calculate time deltas and then compares it with total events observed in a day to find percentage of beaconing. \nThis outbound beaconing pattern to untrusted public networks should be investigated for any malware callbacks or data exfiltration attempts.\nReference Blog:\nhttp://www.austintaylor.io/detect/beaconing/intrusion/detection/system/command/control/flare/elastic/stack/2017/06/10/detect-beaconing-with-flare-elasticsearch-and-intrusion-detection-systems/\nhttps://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/detect-network-beaconing-via-intra-request-time-delta-patterns/ba-p/779586",
                        "displayName": "Palo Alto - potential beaconing detected",
                        "enabled": false,
                        "entityMappings": [
                          {
                            "entityType": "Account",
                            "fieldMappings": [
                              {
                                "columnName": "AccountCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "Host",
                            "fieldMappings": [
                              {
                                "columnName": "HostCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "IP",
                            "fieldMappings": [
                              {
                                "columnName": "IPCustomEntity",
                                "identifier": "Address"
                              }
                            ]
                          }
                        ],
                        "query": "\nlet starttime = 2d;\nlet endtime = 1d;\nlet TimeDeltaThreshold = 25;\nlet TotalEventsThreshold = 30;\nlet MostFrequentTimeDeltaThreshold = 25;\nlet PercentBeaconThreshold = 80;\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\" and Activity == \"TRAFFIC\"\n| where TimeGenerated between (startofday(ago(starttime))..startofday(ago(endtime)))\n| where ipv4_is_private(DestinationIP)== false\n| project TimeGenerated, DeviceName, SourceUserID, SourceIP, SourcePort, DestinationIP, DestinationPort, ReceivedBytes, SentBytes\n| sort by SourceIP asc,TimeGenerated asc, DestinationIP asc, DestinationPort asc\n| serialize\n| extend nextTimeGenerated = next(TimeGenerated, 1), nextSourceIP = next(SourceIP, 1)\n| extend TimeDeltainSeconds = datetime_diff('second',nextTimeGenerated,TimeGenerated)\n| where SourceIP == nextSourceIP\n//Whitelisting criteria/ threshold criteria\n| where TimeDeltainSeconds > TimeDeltaThreshold \n| summarize count(), sum(ReceivedBytes), sum(SentBytes)\nby TimeDeltainSeconds, bin(TimeGenerated, 1h), DeviceName, SourceUserID, SourceIP, DestinationIP, DestinationPort\n| summarize (MostFrequentTimeDeltaCount, MostFrequentTimeDeltainSeconds) = arg_max(count_, TimeDeltainSeconds), TotalEvents=sum(count_), TotalSentBytes = sum(sum_SentBytes), TotalReceivedBytes = sum(sum_ReceivedBytes) \nby bin(TimeGenerated, 1h), DeviceName, SourceUserID, SourceIP, DestinationIP, DestinationPort\n| where TotalEvents > TotalEventsThreshold and MostFrequentTimeDeltaCount > MostFrequentTimeDeltaThreshold\n| extend BeaconPercent = MostFrequentTimeDeltaCount/toreal(TotalEvents) * 100\n| where BeaconPercent > PercentBeaconThreshold\n| extend timestamp = TimeGenerated, IPCustomEntity = DestinationIP, AccountCustomEntity = SourceUserID, HostCustomEntity = DeviceName \n",
                        "queryFrequency": "P1D",
                        "queryPeriod": "P2D",
                        "requiredDataConnectors": [
                          {
                            "connectorId": "PaloAltoNetworks",
                            "dataTypes": [
                              "CommonSecurityLog"
                            ]
                          }
                        ],
                        "severity": "Low",
                        "status": "Available",
                        "suppressionDuration": "PT1H",
                        "suppressionEnabled": false,
                        "tactics": [
                          "CommandAndControl"
                        ],
                        "triggerOperator": "GreaterThan",
                        "triggerThreshold": 0
                      },
                      "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_analyticRulecontentId3')]",
                        "description": "PaloAlto-PAN-OS Analytics Rule 3",
                        "kind": "AnalyticsRule",
                        "parentId": "[variables('analyticRuleId3')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('analyticRuleVersion3')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('analyticRuleTemplateSpecName4')]",
              "properties": {
                "description": "PaloAlto-PAN-OS Analytics Rule 4 with template",
                "displayName": "PaloAlto-PAN-OS Analytics Rule template"
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('analyticRuleTemplateSpecName4'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('analyticRuleTemplateSpecName4'),'/',variables('analyticRuleVersion4'))]",
              "properties": {
                "description": "PaloAlto-PortScanning_AnalyticalRules Analytics Rule with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('analyticRuleVersion4')]",
                  "parameters": {},
                  "resources": [
                    {
                      "apiVersion": "2022-04-01-preview",
                      "kind": "Scheduled",
                      "location": "[parameters('workspace-location')]",
                      "name": "[variables('AnalyticRulecontentId4')]",
                      "properties": {
                        "description": "Identifies a list of internal Source IPs (10.x.x.x Hosts) that have triggered 10 or more non-graceful tcp server resets from one or more Destination IPs which \nresults in an \"ApplicationProtocol = incomplete\" designation. The server resets coupled with an \"Incomplete\" ApplicationProtocol designation can be an indication \nof internal to external port scanning or probing attack. \nReferences: https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClUvCAK and\nhttps://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClTaCAK",
                        "displayName": "Palo Alto - possible internal to external port scanning",
                        "enabled": false,
                        "entityMappings": [
                          {
                            "entityType": "Account",
                            "fieldMappings": [
                              {
                                "columnName": "AccountCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "Host",
                            "fieldMappings": [
                              {
                                "columnName": "HostCustomEntity",
                                "identifier": "FullName"
                              }
                            ]
                          },
                          {
                            "entityType": "IP",
                            "fieldMappings": [
                              {
                                "columnName": "IPCustomEntity",
                                "identifier": "Address"
                              }
                            ]
                          }
                        ],
                        "query": "\nCommonSecurityLog\n| where isnotempty(DestinationPort) and DeviceAction !in (\"reset-both\", \"deny\") \n// filter out common usage ports. Add ports that are legitimate for your environment\n| where DestinationPort !in (\"443\", \"53\", \"389\", \"80\", \"0\", \"880\", \"8888\", \"8080\")\n| where ApplicationProtocol == \"incomplete\" \n// filter out IANA ephemeral or negotiated ports as per https://en.wikipedia.org/wiki/Ephemeral_port\n| where DestinationPort !between (toint(49512) .. toint(65535)) \n| where Computer != \"\" \n| where DestinationIP !startswith \"10.\"\n| extend Reason = coalesce(\n                              column_ifexists(\"Reason\", \"\"), \n                              extract(\"reason=(.+?)(;|$)\", 1, AdditionalExtensions),\n                              \"\"\n                          )\n// Filter out any graceful reset reasons of AGED OUT which occurs when a TCP session closes with a FIN due to aging out. \n| where Reason !has \"aged-out\" \n// Filter out any TCP FIN which occurs when a TCP FIN is used to gracefully close half or both sides of a connection.\n| where Reason !has \"tcp-fin\" \n// Uncomment one of the following where clauses to trigger on specific TCP reset reasons\n// See Palo Alto article for details - https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClUvCAK\n// TCP RST-server - Occurs when the server sends a TCP reset to the client\n// | where AdditionalExtensions has \"reason=tcp-rst-from-server\"  \n// TCP RST-client - Occurs when the client sends a TCP reset to the server\n// | where AdditionalExtensions has \"reason=tcp-rst-from-client\"  \n// Already performed\n//| extend reason = tostring(split(AdditionalExtensions, \";\")[3])\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), count() by DeviceName, SourceUserID, SourceIP, ApplicationProtocol, Reason, DestinationPort, Protocol, DeviceVendor, DeviceProduct, DeviceAction, DestinationIP\n| where count_ >= 10\n| summarize StartTimeUtc = min(StartTimeUtc), EndTimeUtc = max(EndTimeUtc), makeset(DestinationIP), totalcount = sum(count_) by DeviceName, SourceUserID, SourceIP, ApplicationProtocol, Reason, DestinationPort, Protocol, DeviceVendor, DeviceProduct, DeviceAction\n| extend timestamp = StartTimeUtc, IPCustomEntity = SourceIP, AccountCustomEntity = SourceUserID, HostCustomEntity = DeviceName \n",
                        "queryFrequency": "PT1H",
                        "queryPeriod": "PT1H",
                        "requiredDataConnectors": [
                          {
                            "connectorId": "PaloAltoNetworks",
                            "dataTypes": [
                              "CommonSecurityLog"
                            ]
                          }
                        ],
                        "severity": "Low",
                        "status": "Available",
                        "suppressionDuration": "PT1H",
                        "suppressionEnabled": false,
                        "tactics": [
                          "Discovery"
                        ],
                        "triggerOperator": "GreaterThan",
                        "triggerThreshold": 0
                      },
                      "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_analyticRulecontentId4')]",
                        "description": "PaloAlto-PAN-OS Analytics Rule 4",
                        "kind": "AnalyticsRule",
                        "parentId": "[variables('analyticRuleId4')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('analyticRuleVersion4')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {}
                }
              },
              "tags": {
                "hidden-sentinelContentType": "AnalyticsRule",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName1')]",
              "properties": {
                "description": "PaloAltoCustomConnector",
                "displayName": "PaloAltoCustomConnector"
              },
              "tags": {
                "hidden-sentinelContentType": "LogicAppsCustomConnector",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
              "properties": {
                "description": "PaloAltoCustomConnector Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion1')]",
                  "metadata": {
                    "comments": "This PaloAlto custom connector uses PAN-OS API to perform different actions on the PAN-OS VM",
                    "lastUpdateTime": "2022-08-29T14:44:14.274Z",
                    "releaseNotes": {
                      "notes": [
                        "Initial version"
                      ],
                      "title": "[variables('blanks')]",
                      "version": "1.0"
                    }
                  },
                  "parameters": {
                    "PaloAlto_PAN-OS_Rest_API_CustomConnector_Name": {
                      "defaultValue": "PAN-OSRestApiCustomConnector",
                      "metadata": {
                        "description": "Name of the PaloAlto REST API Connector"
                      },
                      "type": "String"
                    },
                    "PaloAlto_PAN-OS_XML_API_CustomConnector_Name": {
                      "defaultValue": "PAN-OSXmlApiCustomConnector",
                      "metadata": {
                        "description": "Name of the PaloAlto XML API Connector"
                      },
                      "type": "String"
                    },
                    "Service_EndPoint": {
                      "defaultValue": "https://{yourPaloAltoDomain}",
                      "metadata": {
                        "description": "enter the PaloAlto endpoint (ex: https://{yourPaloAltoDomain})"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
                      "properties": {
                        "backendService": {
                          "serviceUrl": "[[parameters('Service_EndPoint')]"
                        },
                        "brandColor": "#FFFFFF",
                        "connectionParameters": {
                          "api_key": {
                            "type": "securestring",
                            "uiDefinition": {
                              "constraints": {
                                "clearText": false,
                                "required": "true",
                                "tabIndex": 2
                              },
                              "description": "The API Key for this api",
                              "displayName": "API Key",
                              "tooltip": "Provide your API Key"
                            }
                          }
                        },
                        "description": "This is the PaloAlto Custom Connector",
                        "displayName": "[[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
                        "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                        "swagger": {
                          "basePath": "/",
                          "host": "$substring([parameters('Service EndPoint')],8 )",
                          "info": {
                            "description": "[variables('blanks')]",
                            "title": "Default title",
                            "version": "1.0"
                          },
                          "paths": {
                            "/restapi/v10.0/Objects/AddressGroups": {
                              "get": {
                                "description": "List address groups",
                                "operationId": "[[variables('_operationId-Listaddressgroups')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "filter by address group name",
                                    "in": "query",
                                    "name": "name",
                                    "required": false,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "properties": {
                                            "@count": {
                                              "description": "count of address object groups present in PAN-OS VM",
                                              "title": "@count",
                                              "type": "string"
                                            },
                                            "@total-count": {
                                              "description": "total count of address object groups present in PAN-OS VM",
                                              "title": "@total-count",
                                              "type": "string"
                                            },
                                            "entry": {
                                              "description": "entry",
                                              "items": {
                                                "properties": {
                                                  "@location": {
                                                    "description": "location of address object group",
                                                    "title": "@location",
                                                    "type": "string"
                                                  },
                                                  "@name": {
                                                    "description": "Enter the name of address object group",
                                                    "title": "@name",
                                                    "type": "string"
                                                  },
                                                  "@vsys": {
                                                    "description": "vys location name of address object group",
                                                    "title": "@vsys",
                                                    "type": "string"
                                                  },
                                                  "static": {
                                                    "description": "static",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "List address groups",
                                "x-ms-visibility": "important"
                              },
                              "post": {
                                "description": "Creates an address object group",
                                "operationId": "[[variables('_operationId-Createaddressobjectgroup')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of security policy rule",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of address object group",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "static": {
                                              "description": "static",
                                              "properties": {
                                                "member": {
                                                  "description": "Enter the whole array of members i.e existing and also new ones",
                                                  "title": "member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "static"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "statuscode",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "status message",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Create an address object group",
                                "x-ms-visibility": "important"
                              },
                              "put": {
                                "description": "Update the address object group",
                                "operationId": "[[variables('_operationId-Updateanaddressobjectgroup')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of the address object group",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of address object group",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "static": {
                                              "description": "static",
                                              "properties": {
                                                "member": {
                                                  "description": "Enter the whole array of members i.e existing and also new ones",
                                                  "title": "member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "static"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "statuscode",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "status message",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Update an address object group",
                                "x-ms-visibility": "important"
                              }
                            },
                            "/restapi/v10.0/Objects/Addresses": {
                              "get": {
                                "description": "List address objects",
                                "operationId": "[[variables('_operationId-Listaddressobjects')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "filter by address object name",
                                    "in": "query",
                                    "name": "name",
                                    "required": false,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "properties": {
                                            "@count": {
                                              "description": "count of address objects present in PAN-OS",
                                              "title": "@count",
                                              "type": "string"
                                            },
                                            "@total-count": {
                                              "description": "total count of address objects present in PAN-OS VM",
                                              "title": "@total-count",
                                              "type": "string"
                                            },
                                            "entry": {
                                              "description": "entry",
                                              "items": {
                                                "properties": {
                                                  "@location": {
                                                    "description": "location of PAN-OS VM. default value is vsys",
                                                    "title": "@location",
                                                    "type": "string"
                                                  },
                                                  "@name": {
                                                    "description": "Enter the name of the address object",
                                                    "title": "@name",
                                                    "type": "string"
                                                  },
                                                  "@vsys": {
                                                    "description": "vsys location name of address object. default value is vsys1",
                                                    "title": "@vsys",
                                                    "type": "string"
                                                  },
                                                  "description": {
                                                    "description": "description of address object",
                                                    "title": "description",
                                                    "type": "string"
                                                  },
                                                  "fqdn": {
                                                    "description": "URL address of address object",
                                                    "title": "fqdn",
                                                    "type": "string"
                                                  },
                                                  "ip-netmask": {
                                                    "description": "Ip address of address object",
                                                    "title": "ip-netmask",
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "List address objects",
                                "x-ms-visibility": "important"
                              },
                              "post": {
                                "description": "creates address object",
                                "operationId": "[[variables('_operationId-Createanaddressobject')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of address object",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "enum": [
                                      "ip-netmask",
                                      "fqdn"
                                    ],
                                    "in": "query",
                                    "name": "address type",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of address object",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "description": {
                                              "description": "Enter the description",
                                              "title": "description",
                                              "type": "string"
                                            },
                                            "fqdn": {
                                              "description": "Enter the URL ex:url.com",
                                              "title": "fqdn",
                                              "type": "string",
                                              "x-ms-visibility": "advanced"
                                            },
                                            "ip-netmask": {
                                              "description": "Enter the IP address ex:1.1.1.1",
                                              "title": "ip-netmask",
                                              "type": "string",
                                              "x-ms-visibility": "advanced"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "description"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "success or failure msg",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Create an address object",
                                "x-ms-visibility": "important"
                              },
                              "put": {
                                "description": "Updates an address objects parameters.",
                                "operationId": "[[variables('_operationId-Updateaddressobject')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of address object",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  },
                                  {
                                    "enum": [
                                      "ip-netmask",
                                      "fqdn"
                                    ],
                                    "in": "query",
                                    "name": "address type",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of address object",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "description": {
                                              "description": "Enter the description",
                                              "title": "description",
                                              "type": "string"
                                            },
                                            "fqdn": {
                                              "description": "Enter the URL for ex:url.com",
                                              "title": "fqdn",
                                              "type": "string",
                                              "x-ms-visibility": "advanced"
                                            },
                                            "ip-netmask": {
                                              "description": "Enter the IP address for ex: 1.1.1.1",
                                              "title": "ip-netmask",
                                              "type": "string",
                                              "x-ms-visibility": "advanced"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "description"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "status message",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Update an address object",
                                "x-ms-visibility": "important"
                              }
                            },
                            "/restapi/v10.0/Objects/CustomURLCategories": {
                              "get": {
                                "description": "List custom url categories",
                                "operationId": "[[variables('_operationId-Listcustomurlcategories')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "filter by custom url category name",
                                    "in": "query",
                                    "name": "name",
                                    "required": false,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "properties": {
                                            "@count": {
                                              "description": "count of the list of URL filtering category info",
                                              "title": "@count",
                                              "type": "string"
                                            },
                                            "@total-count": {
                                              "description": "total count of URL filtering category info present in PAN-OS",
                                              "title": "@total-count",
                                              "type": "string"
                                            },
                                            "entry": {
                                              "description": "entry",
                                              "items": {
                                                "properties": {
                                                  "@location": {
                                                    "description": "location of the URL filtering category info. default value is vsys",
                                                    "title": "@location",
                                                    "type": "string"
                                                  },
                                                  "@name": {
                                                    "description": "name of URL filtering category information",
                                                    "title": "@name",
                                                    "type": "string"
                                                  },
                                                  "@vsys": {
                                                    "description": "vsys location name of URL filtering category info. default value is vsys1",
                                                    "title": "@vsys",
                                                    "type": "string"
                                                  },
                                                  "description": {
                                                    "description": "description of URL filtering category information",
                                                    "title": "description",
                                                    "type": "string"
                                                  },
                                                  "list": {
                                                    "description": "list",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "type": {
                                                    "description": "type of URL filtering category info",
                                                    "title": "type",
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "List custom url categories",
                                "x-ms-visibility": "important"
                              }
                            },
                            "/restapi/v10.0/Objects/URLFilteringSecurityProfiles": {
                              "get": {
                                "description": "List url filtering security profiles",
                                "operationId": "[[variables('_operationId-Listurlfilteringsecurityprofiles')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "filter by name of URL filtering security profile",
                                    "in": "query",
                                    "name": "name",
                                    "required": false,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "properties": {
                                            "@count": {
                                              "description": "count of url filtering security profile information",
                                              "title": "@count",
                                              "type": "string"
                                            },
                                            "@total-count": {
                                              "description": "total count of url filtering security profile information",
                                              "title": "@total-count",
                                              "type": "string"
                                            },
                                            "entry": {
                                              "description": "entry",
                                              "items": {
                                                "properties": {
                                                  "@location": {
                                                    "description": "location of URL filtering security profile",
                                                    "title": "@location",
                                                    "type": "string"
                                                  },
                                                  "@name": {
                                                    "description": "Enter the name of URL filtering category security profile",
                                                    "title": "@name",
                                                    "type": "string"
                                                  },
                                                  "@vsys": {
                                                    "description": "@vsys",
                                                    "type": "string"
                                                  },
                                                  "credential-enforcement": {
                                                    "description": "credential-enforcement",
                                                    "properties": {
                                                      "log-severity": {
                                                        "description": "log-severity of filtering security category info",
                                                        "title": "log-severity",
                                                        "type": "string"
                                                      },
                                                      "mode": {
                                                        "description": "mode",
                                                        "properties": {
                                                          "disabled": {
                                                            "description": "disabled",
                                                            "type": "object"
                                                          }
                                                        },
                                                        "type": "object"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "description": {
                                                    "description": "description of url filtering security info",
                                                    "title": "description",
                                                    "type": "string"
                                                  },
                                                  "log-http-hdr-user-agent": {
                                                    "description": "log-http-hdr-user-agent",
                                                    "title": "log-http-hdr-user-agent",
                                                    "type": "string"
                                                  },
                                                  "mlav-engine-urlbased-enabled": {
                                                    "description": "mlav-engine-urlbased-enabled",
                                                    "properties": {
                                                      "entry": {
                                                        "description": "entry",
                                                        "items": {
                                                          "properties": {
                                                            "@name": {
                                                              "description": "Enter the name of URL filtering category security profile",
                                                              "type": "string"
                                                            },
                                                            "mlav-policy-action": {
                                                              "description": "mlav-policy-action",
                                                              "type": "string"
                                                            }
                                                          },
                                                          "type": "object"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "List url filtering security profiles",
                                "x-ms-visibility": "important"
                              },
                              "put": {
                                "description": "Update an url filtering security profile",
                                "operationId": "[[variables('_operationId-Updateanurlfilteringsecurityprofile')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of URL filtering category security profile",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of URL filtering category security profile",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "alert": {
                                              "description": "alert",
                                              "properties": {
                                                "member": {
                                                  "description": "Categories to alert on, Array of strings",
                                                  "title": "alert member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "allow": {
                                              "description": "allow",
                                              "properties": {
                                                "member": {
                                                  "description": "categories to allow, Array of strings",
                                                  "title": "allow member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "block": {
                                              "description": "block",
                                              "properties": {
                                                "member": {
                                                  "description": "Categories to block, Array of strings",
                                                  "title": "block member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "continue": {
                                              "description": "continue",
                                              "properties": {
                                                "member": {
                                                  "description": "Categories to continue, Array of strings",
                                                  "title": "continue member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "credential-enforcement": {
                                              "description": "credential-enforcement",
                                              "properties": {
                                                "alert": {
                                                  "description": "alert",
                                                  "properties": {
                                                    "member": {
                                                      "description": "Categories to alert on credential match",
                                                      "title": "credential-enforcement alert member",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "allow": {
                                                  "description": "allow",
                                                  "properties": {
                                                    "member": {
                                                      "description": "Categories to allow and bypass credential enforcement",
                                                      "title": "credential-enforcement allow member",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "block": {
                                                  "description": "block",
                                                  "properties": {
                                                    "member": {
                                                      "description": "Categories to block on credential matchmember",
                                                      "title": "credential-enforcement allow member",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "continue": {
                                                  "description": "continue",
                                                  "properties": {
                                                    "member": {
                                                      "description": "Categories to block/continue on credential match",
                                                      "title": "credential-enforcement continue member",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "log-severity": {
                                                  "default": "any",
                                                  "description": "Log severity when credential matched",
                                                  "title": "credential-enforcement log severity",
                                                  "type": "string"
                                                },
                                                "mode": {
                                                  "description": "mode",
                                                  "properties": {
                                                    "disabled": {
                                                      "description": "disabled (object) or ip-user (object) or domain-credentials (object) or group-mapping (object)",
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "required": [
                                                "mode",
                                                "log-severity"
                                              ],
                                              "type": "object"
                                            },
                                            "description": {
                                              "description": "Enter the description",
                                              "title": "description",
                                              "type": "string"
                                            },
                                            "enable-container-page": {
                                              "default": true,
                                              "description": "Enter the enable-container-page",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "enable-container-page",
                                              "type": "string"
                                            },
                                            "http-header-insertion": {
                                              "description": "http-header-insertion",
                                              "properties": {
                                                "entry": {
                                                  "description": "entry",
                                                  "properties": {
                                                    "@name": {
                                                      "description": "Enter the http-header-insertion entry name",
                                                      "title": "http-header-insertion entry name",
                                                      "type": "string"
                                                    },
                                                    "type": {
                                                      "description": "type",
                                                      "properties": {
                                                        "entry": {
                                                          "description": "entry",
                                                          "properties": {
                                                            "@name": {
                                                              "description": "Enter the http-header-insertion type entry name",
                                                              "title": "http-header-insertion type entry name",
                                                              "type": "string"
                                                            },
                                                            "domains": {
                                                              "description": "domains",
                                                              "properties": {
                                                                "member": {
                                                                  "description": "Enter the http-header-insertion entry type entry domains member",
                                                                  "title": "http-header-insertion entry type entry domains member",
                                                                  "type": "string"
                                                                }
                                                              },
                                                              "required": [
                                                                "member"
                                                              ],
                                                              "type": "object"
                                                            },
                                                            "headers": {
                                                              "description": "headers",
                                                              "properties": {
                                                                "entry": {
                                                                  "description": "entry",
                                                                  "properties": {
                                                                    "@name": {
                                                                      "description": "Enter the http-header-insertion entry type entry headers entry name",
                                                                      "title": "http-header-insertion entry type entry headers entry name",
                                                                      "type": "string"
                                                                    },
                                                                    "header": {
                                                                      "description": "Enter the http-header-insertion entry type entry headers entry header",
                                                                      "title": "http-header-insertion entry type entry headers entry header",
                                                                      "type": "string"
                                                                    },
                                                                    "log": {
                                                                      "default": false,
                                                                      "description": "Enter the http-header-insertion entry type entry headers entry log",
                                                                      "enum": [
                                                                        true,
                                                                        false
                                                                      ],
                                                                      "title": "http-header-insertion entry type entry headers entry log",
                                                                      "type": "string"
                                                                    },
                                                                    "value": {
                                                                      "description": "Enter the http-header-insertion entry type entry headers entry value",
                                                                      "title": "http-header-insertion entry type entry headers entry value",
                                                                      "type": "string"
                                                                    }
                                                                  },
                                                                  "required": [
                                                                    "name",
                                                                    "header",
                                                                    "value",
                                                                    "log"
                                                                  ],
                                                                  "type": "object"
                                                                }
                                                              },
                                                              "required": [
                                                                "entry"
                                                              ],
                                                              "type": "object"
                                                            }
                                                          },
                                                          "type": "object"
                                                        }
                                                      },
                                                      "required": [
                                                        "entry"
                                                      ],
                                                      "type": "object"
                                                    }
                                                  },
                                                  "required": [
                                                    "@name",
                                                    "type",
                                                    "domains"
                                                  ],
                                                  "type": "object"
                                                }
                                              },
                                              "required": [
                                                "entry"
                                              ],
                                              "type": "object"
                                            },
                                            "log-container-page-only": {
                                              "default": true,
                                              "description": "Log container page only",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "log-container-page-only",
                                              "type": "string"
                                            },
                                            "log-http-hdr-referer": {
                                              "description": "Log HTTP Header Referer field",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "log-http-hdr-referer",
                                              "type": "string"
                                            },
                                            "log-http-hdr-user-agent": {
                                              "default": false,
                                              "description": "Log HTTP Header User-Agent field",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "log-http-hdr-user-agent",
                                              "type": "string"
                                            },
                                            "log-http-hdr-xff": {
                                              "description": "Log HTTP Header X-Forwarded-For field",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "log-http-hdr-xff",
                                              "type": "string"
                                            },
                                            "mlav-category-exception": {
                                              "description": "mlav-category-exception",
                                              "properties": {
                                                "member": {
                                                  "description": "Enter the mlav-category-exception member",
                                                  "title": "mlav-category-exception member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "mlav-engine-urlbased-enabled": {
                                              "description": "mlav-engine-urlbased-enabled",
                                              "properties": {
                                                "entry": {
                                                  "description": "entry",
                                                  "properties": {
                                                    "@name": {
                                                      "description": "Enter the mlav-engine-urlbased-enabled entry name",
                                                      "title": "mlav-engine-urlbased-enabled entry name",
                                                      "type": "string"
                                                    },
                                                    "mlav-policy-action": {
                                                      "description": "Enter the mlav-engine-urlbased-enabled mlav-policy-action",
                                                      "enum": [
                                                        "block",
                                                        "alert",
                                                        "allow"
                                                      ],
                                                      "title": "mlav-engine-urlbased-enabled mlav-policy-action",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "required": [
                                                    "@name",
                                                    "mlav-policy-action"
                                                  ],
                                                  "type": "object"
                                                }
                                              },
                                              "required": [
                                                "entry"
                                              ],
                                              "type": "object"
                                            },
                                            "override": {
                                              "description": "override",
                                              "properties": {
                                                "member": {
                                                  "description": "Categories to admin override, Array of strings",
                                                  "title": "override member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "safe-search-enforcement": {
                                              "default": false,
                                              "description": "Safe-Search will be enforced if it is set",
                                              "enum": [
                                                true,
                                                false
                                              ],
                                              "title": "safe-search-enforcement",
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "allow",
                                            "alert",
                                            "continue",
                                            "block",
                                            "credential-enforcement",
                                            "description",
                                            "enable-container-page",
                                            "http-header-insertion",
                                            "log-container-page-only",
                                            "log-http-hdr-user-agent",
                                            "mlav-category-exception",
                                            "mlav-engine-urlbased-enabled",
                                            "override",
                                            "safe-search-enforcement",
                                            "log-http-hdr-xff",
                                            "log-http-hdr-referer"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "status msg",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Update an url filtering security profile",
                                "x-ms-visibility": "important"
                              }
                            },
                            "/restapi/v10.0/Policies/SecurityRules": {
                              "get": {
                                "description": "List of all the security rules",
                                "operationId": "[[variables('_operationId-Listsecurityrules')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "filter the security rule by name",
                                    "in": "query",
                                    "name": "name",
                                    "required": false,
                                    "type": "string",
                                    "x-ms-summary": "name"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "defines the status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "defines the status",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "properties": {
                                            "@count": {
                                              "description": "the count of security policy rules in PAN-OS VM",
                                              "title": "@count",
                                              "type": "string"
                                            },
                                            "@total-count": {
                                              "description": "the total count of security policy rules in PAN-OS VM",
                                              "title": "@total-count",
                                              "type": "string"
                                            },
                                            "entry": {
                                              "description": "entry",
                                              "items": {
                                                "properties": {
                                                  "@location": {
                                                    "description": "the location where the security policy rule is being located at. default value is \"vsys\"",
                                                    "title": "@location",
                                                    "type": "string"
                                                  },
                                                  "@name": {
                                                    "description": "the name of the security policy rule",
                                                    "title": "@name",
                                                    "type": "string"
                                                  },
                                                  "@uuid": {
                                                    "description": "the unique id of the security policy rule",
                                                    "title": "@uuid",
                                                    "type": "string"
                                                  },
                                                  "@vsys": {
                                                    "description": "the vsys name of the location. default value is \"vsys1\"",
                                                    "title": "@vsys",
                                                    "type": "string"
                                                  },
                                                  "action": {
                                                    "description": "action allowed on security policy rule.",
                                                    "title": "action",
                                                    "type": "string"
                                                  },
                                                  "application": {
                                                    "description": "application",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "category": {
                                                    "description": "category",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "destination": {
                                                    "description": "destination",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "destination-hip": {
                                                    "description": "destination-hip",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "from": {
                                                    "description": "from",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "hip-profiles": {
                                                    "description": "hip-profiles",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "service": {
                                                    "description": "service",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "source": {
                                                    "description": "source",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "source-hip": {
                                                    "description": "source-hip",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "source-user": {
                                                    "description": "source-user",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "to": {
                                                    "description": "to",
                                                    "properties": {
                                                      "member": {
                                                        "description": "member",
                                                        "items": {
                                                          "type": "string"
                                                        },
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  }
                                                },
                                                "type": "object"
                                              },
                                              "type": "array"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "List security rules",
                                "x-ms-visibility": "important"
                              },
                              "post": {
                                "description": "Creates a new policy rule",
                                "operationId": "[[variables('_operationId-Createsecuritypolicyrule')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of security policy rule",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of security policy rule",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "action": {
                                              "default": "allow",
                                              "description": "enter the action ex: allow",
                                              "enum": [
                                                "deny",
                                                "allow",
                                                "drop",
                                                "reset-client",
                                                "reset-server",
                                                "reset-both"
                                              ],
                                              "title": "action",
                                              "type": "string"
                                            },
                                            "application": {
                                              "description": "application",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the application member, Array of strings",
                                                  "title": "application member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "category": {
                                              "description": "category",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the category member, Array of strings",
                                                  "title": "category member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "destination": {
                                              "description": "destination",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                                  "title": "destination member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "from": {
                                              "description": "from",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the from member,Array of strings",
                                                  "title": "from member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "hip-profiles": {
                                              "description": "hip-profiles",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the hip-profiles member, Array of strings",
                                                  "title": "hip-profiles member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "service": {
                                              "description": "service",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the service member, Array of strings",
                                                  "title": "service member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "source": {
                                              "description": "source",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                                  "title": "source member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "source-user": {
                                              "description": "source-user",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source-user member, Array of strings",
                                                  "title": "source-user member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "to": {
                                              "description": "to",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the to member, Array of strings",
                                                  "title": "to member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "action",
                                            "application",
                                            "category",
                                            "destination",
                                            "from",
                                            "hip-profiles",
                                            "service",
                                            "source",
                                            "to"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "statuscode",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "status message",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Create a security policy rule",
                                "x-ms-visibility": "important"
                              },
                              "put": {
                                "description": "update address object to existing Security Policy Rule",
                                "operationId": "[[variables('_operationId-Updatesecuritypolicyrule')]",
                                "parameters": [
                                  {
                                    "default": "vsys",
                                    "description": "Enter the location",
                                    "in": "query",
                                    "name": "location",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "vsys1",
                                    "description": "Enter the vsys location name",
                                    "in": "query",
                                    "name": "vsys",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "description": "Enter the name of security policy rule",
                                    "in": "query",
                                    "name": "name",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "in": "body",
                                    "name": "body",
                                    "required": true,
                                    "schema": {
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the name of security policy rule",
                                              "title": "name",
                                              "type": "string"
                                            },
                                            "action": {
                                              "default": "allow",
                                              "description": "enter the action ex: allow",
                                              "enum": [
                                                "deny",
                                                "allow",
                                                "drop",
                                                "reset-client",
                                                "reset-server",
                                                "reset-both"
                                              ],
                                              "title": "action",
                                              "type": "string"
                                            },
                                            "application": {
                                              "description": "application",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the application member, Array of strings",
                                                  "title": "application member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "category": {
                                              "description": "category",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the category member, Array of strings",
                                                  "title": "category member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "destination": {
                                              "description": "destination",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                                  "title": "destination member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "from": {
                                              "description": "from",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the from member,Array of strings",
                                                  "title": "from member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "hip-profiles": {
                                              "description": "hip-profiles",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the hip-profiles member, Array of strings",
                                                  "title": "hip-profiles member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "service": {
                                              "description": "service",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the service member, Array of strings",
                                                  "title": "service member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "source": {
                                              "description": "source",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                                  "title": "source member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            },
                                            "source-user": {
                                              "description": "source-user",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the source-user member, Array of strings",
                                                  "title": "source-user member",
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "to": {
                                              "description": "to",
                                              "properties": {
                                                "member": {
                                                  "default": "any",
                                                  "description": "Enter the to member, Array of strings",
                                                  "title": "to member",
                                                  "type": "string"
                                                }
                                              },
                                              "required": [
                                                "member"
                                              ],
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "action",
                                            "application",
                                            "category",
                                            "destination",
                                            "from",
                                            "hip-profiles",
                                            "service",
                                            "source",
                                            "to"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    }
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "msg": {
                                          "description": "the status msg if success or failure",
                                          "title": "msg",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Update security policy rule",
                                "x-ms-visibility": "important"
                              }
                            }
                          },
                          "schemes": [
                            "https"
                          ],
                          "security": [
                            {}
                          ],
                          "securityDefinitions": {
                            "API Key": {
                              "in": "header",
                              "name": "X-PAN-KEY",
                              "type": "apiKey"
                            }
                          },
                          "swagger": "2.0"
                        }
                      },
                      "type": "Microsoft.Web/customApis"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
                      "properties": {
                        "backendService": {
                          "serviceUrl": "[[parameters('Service_EndPoint')]"
                        },
                        "brandColor": "#FFFFFF",
                        "connectionParameters": {
                          "api_key": {
                            "type": "securestring",
                            "uiDefinition": {
                              "constraints": {
                                "clearText": false,
                                "required": "true",
                                "tabIndex": 2
                              },
                              "description": "The API Key for this api",
                              "displayName": "API Key",
                              "tooltip": "Provide your API Key"
                            }
                          }
                        },
                        "description": "This is the PaloAlto Custom Connector",
                        "displayName": "[[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
                        "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                        "swagger": {
                          "basePath": "/",
                          "host": "$substring([parameters('Service EndPoint')],8 )",
                          "info": {
                            "description": "[variables('blanks')]",
                            "title": "Default title",
                            "version": "1.0"
                          },
                          "paths": {
                            "/api": {
                              "get": {
                                "description": "Quert XML API for PCAPs and Device Info",
                                "operationId": "[[variables('_operationId-Queryxmlapi')]",
                                "parameters": [
                                  {
                                    "in": "query",
                                    "name": "type",
                                    "required": true,
                                    "type": "string"
                                  },
                                  {
                                    "default": "threat-pcap",
                                    "in": "query",
                                    "name": "category",
                                    "required": false,
                                    "type": "string"
                                  },
                                  {
                                    "in": "query",
                                    "name": "pcap-id",
                                    "required": false,
                                    "type": "integer"
                                  },
                                  {
                                    "in": "query",
                                    "name": "search-time",
                                    "required": false,
                                    "type": "string"
                                  },
                                  {
                                    "in": "query",
                                    "name": "sessionId",
                                    "required": false,
                                    "type": "integer"
                                  },
                                  {
                                    "in": "query",
                                    "name": "device_name",
                                    "required": false,
                                    "type": "string"
                                  },
                                  {
                                    "default": "<show><system><info></info></system></show>",
                                    "in": "query",
                                    "name": "cmd",
                                    "required": false,
                                    "type": "string"
                                  }
                                ],
                                "responses": {
                                  "default": {
                                    "description": "default",
                                    "schema": {
                                      "properties": {
                                        "@code": {
                                          "description": "status code",
                                          "title": "@code",
                                          "type": "string"
                                        },
                                        "@status": {
                                          "description": "status if success or failure",
                                          "title": "@status",
                                          "type": "string"
                                        },
                                        "result": {
                                          "description": "result",
                                          "type": "object"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  }
                                },
                                "summary": "Query Palo Alto XML API",
                                "x-ms-visibility": "important"
                              }
                            }
                          },
                          "responses": {
                            "default": {
                              "description": "default"
                            }
                          },
                          "schemes": [
                            "https"
                          ],
                          "security": [
                            {}
                          ],
                          "securityDefinitions": {
                            "API Key": {
                              "in": "query",
                              "name": "X-PAN-KEY",
                              "type": "apiKey"
                            }
                          },
                          "swagger": "2.0"
                        }
                      },
                      "type": "Microsoft.Web/customApis"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId1')]",
                        "kind": "LogicAppsCustomConnector",
                        "parentId": "[[variables('playbookId')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion1')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "_operationId-Createaddressobjectgroup": "[[variables('operationId-Createaddressobjectgroup')]",
                    "_operationId-Createanaddressobject": "[[variables('operationId-Createanaddressobject')]",
                    "_operationId-Createsecuritypolicyrule": "[[variables('operationId-Createsecuritypolicyrule')]",
                    "_operationId-Listaddressgroups": "[[variables('operationId-Listaddressgroups')]",
                    "_operationId-Listaddressobjects": "[[variables('operationId-Listaddressobjects')]",
                    "_operationId-Listcustomurlcategories": "[[variables('operationId-Listcustomurlcategories')]",
                    "_operationId-Listsecurityrules": "[[variables('operationId-Listsecurityrules')]",
                    "_operationId-Listurlfilteringsecurityprofiles": "[[variables('operationId-Listurlfilteringsecurityprofiles')]",
                    "_operationId-Queryxmlapi": "[[variables('operationId-Queryxmlapi')]",
                    "_operationId-Updateaddressobject": "[[variables('operationId-Updateaddressobject')]",
                    "_operationId-Updateanaddressobjectgroup": "[[variables('operationId-Updateanaddressobjectgroup')]",
                    "_operationId-Updateanurlfilteringsecurityprofile": "[[variables('operationId-Updateanurlfilteringsecurityprofile')]",
                    "_operationId-Updatesecuritypolicyrule": "[[variables('operationId-Updatesecuritypolicyrule')]",
                    "operationId-Createaddressobjectgroup": "Createaddressobjectgroup",
                    "operationId-Createanaddressobject": "Createanaddressobject",
                    "operationId-Createsecuritypolicyrule": "Createsecuritypolicyrule",
                    "operationId-Listaddressgroups": "Listaddressgroups",
                    "operationId-Listaddressobjects": "Listaddressobjects",
                    "operationId-Listcustomurlcategories": "Listcustomurlcategories",
                    "operationId-Listsecurityrules": "Listsecurityrules",
                    "operationId-Listurlfilteringsecurityprofiles": "Listurlfilteringsecurityprofiles",
                    "operationId-Queryxmlapi": "Queryxmlapi",
                    "operationId-Updateaddressobject": "Updateaddressobject",
                    "operationId-Updateanaddressobjectgroup": "Updateanaddressobjectgroup",
                    "operationId-Updateanurlfilteringsecurityprofile": "Updateanurlfilteringsecurityprofile",
                    "operationId-Updatesecuritypolicyrule": "Updatesecuritypolicyrule",
                    "playbookContentId": "PaloAltoCustomConnector",
                    "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name'))]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "LogicAppsCustomConnector",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName2')]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetSystemInfo playbook",
                "displayName": "PaloAlto-PAN-OS-GetSystemInfo playbook"
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetSystemInfo Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion2')]",
                  "metadata": {
                    "description": "This playbook allows us to get System Info of a Palo Alto device for a Sentinel alert.",
                    "entities": [
                      "Ip"
                    ],
                    "lastUpdateTime": "2022-07-25T00:00:00Z",
                    "mainSteps": [
                      "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the System Info for the device in the alert. \n\n 3. Creates a Sentinel Incident and updates it with the system info."
                    ],
                    "postDeployment": [
                      "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
                    ],
                    "prerequisites": [
                      "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents."
                    ],
                    "releaseNotes": [
                      {
                        "notes": [
                          "Initial version"
                        ],
                        "title": "Get System Info - Palo Alto PAN-OS XML API",
                        "version": "1.0.0"
                      }
                    ],
                    "tags": [
                      "Remediation",
                      "Response from teams"
                    ],
                    "title": "Get System Info - Palo Alto PAN-OS XML API"
                  },
                  "parameters": {
                    "CustomConnectorName": {
                      "defaultValue": "PAN-OSXmlApiCustomConnector",
                      "metadata": {
                        "description": "Name of the custom connector which interacts with PAN-OS"
                      },
                      "type": "String"
                    },
                    "LogAnalyticsResourceGroup": {
                      "metadata": {
                        "description": "Name of the cLog Analytics Resource group for logging"
                      },
                      "type": "string"
                    },
                    "LogAnalyticsResourceName": {
                      "metadata": {
                        "description": "Name of the Log Analytics instance for logging"
                      },
                      "type": "string"
                    },
                    "PlaybookName": {
                      "defaultValue": "PaloAlto-PAN-OS-GetSystemInfo",
                      "metadata": {
                        "description": "Name of the Logic App/Playbook"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2016-06-01",
                      "kind": "V1",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureSentinelConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-1')]"
                        },
                        "displayName": "[[parameters('PlaybookName')]",
                        "parameterValueType": "Alternative"
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('PaloAltoConnectorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-2')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureMonitorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-3')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2017-07-01",
                      "identity": {
                        "type": "SystemAssigned"
                      },
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PlaybookName')]",
                      "properties": {
                        "definition": {
                          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                          "actions": {
                            "For_each": {
                              "actions": {
                                "If_incident_is_a_Palo_Alto_incident": {
                                  "actions": {
                                    "Add_comment_to_incident_(V3)": {
                                      "inputs": {
                                        "body": {
                                          "incidentArmId": "@triggerBody()?['object']?['id']",
                                          "message": "<p>@{body('Query_Palo_Alto_XML_API')}</p>"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/Incidents/Comment"
                                      },
                                      "runAfter": {
                                        "Query_Palo_Alto_XML_API": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection"
                                    },
                                    "Query_Palo_Alto_XML_API": {
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                          }
                                        },
                                        "method": "get",
                                        "path": "/api/",
                                        "queries": {
                                          "cmd": "<show><system><info></info></system></show>",
                                          "device_name": "@{items('For_each')['MonitoringDeviceName']}",
                                          "type": "op"
                                        }
                                      },
                                      "type": "ApiConnection"
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "contains": [
                                          "@items('For_each')['AlertSource']",
                                          "@string('PaloAlto')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "foreach": "@body('Run_query_and_list_results')?['value']",
                              "runAfter": {
                                "Run_query_and_list_results": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Run_query_and_list_results": {
                              "inputs": {
                                "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/queryData",
                                "queries": {
                                  "resourcegroups": "[[parameters('LogAnalyticsResourceGroup')]",
                                  "resourcename": "[[parameters('LogAnalyticsResourceName')]",
                                  "resourcetype": "Log Analytics Workspace",
                                  "subscriptions": "[[variables('subscriptionId')]",
                                  "timerange": "Set in query"
                                }
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "contentVersion": "1.0.0.0",
                          "parameters": {
                            "$connections": {
                              "type": "Object"
                            }
                          },
                          "triggers": {
                            "Microsoft_Sentinel_incident": {
                              "inputs": {
                                "body": {
                                  "callback_url": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "path": "/subscribe"
                              },
                              "type": "ApiConnectionWebhook"
                            }
                          }
                        },
                        "parameters": {
                          "$connections": {
                            "value": {
                              "azuremonitorlogs": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                                "connectionName": "azuremonitorlogs",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                              },
                              "azuresentinel": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                                "connectionName": "azuresentinel",
                                "connectionProperties": {
                                  "authentication": {
                                    "type": "ManagedServiceIdentity"
                                  }
                                },
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                              },
                              "paloaltoconnector": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                                "connectionName": "paloaltoconnector",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                                "resourceGroup": "', resourceGroup().name, '"
                              }
                            }
                          }
                        },
                        "state": "Enabled"
                      },
                      "tags": {
                        "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
                      },
                      "type": "Microsoft.Logic/workflows"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId2')]",
                        "dependencies": {
                          "criteria": [
                            {
                              "contentId": "[variables('_PaloAltoCustomConnector')]",
                              "kind": "LogicAppsCustomConnector",
                              "version": "[variables('playbookVersion1')]"
                            }
                          ]
                        },
                        "kind": "Playbook",
                        "parentId": "[variables('playbookId2')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion2')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "AzureMonitorConnectionName": "[[concat('azuremonitor-', parameters('PlaybookName'))]",
                    "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
                    "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
                    "_connection-1": "[[variables('connection-1')]",
                    "_connection-2": "[[variables('connection-2')]",
                    "_connection-3": "[[variables('connection-3')]",
                    "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                    "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                    "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
                    "subscriptionId": "[[subscription().subscriptionId]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName3')]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetThreatPcap playbook",
                "displayName": "PaloAlto-PAN-OS-GetThreatPcap playbook"
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetThreatPcap Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion3')]",
                  "metadata": {
                    "description": "This playbook allows us to get a threat PCAP for a given PCAP ID.",
                    "entities": [
                      "Ip"
                    ],
                    "lastUpdateTime": "2022-07-25T00:00:00Z",
                    "mainSteps": [
                      "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the PCAP from the device. \n\n 3. Puts the PCAP in Blob Storage \n\n 4. Creates a Sentinel Incident and updates it with a link to the blob."
                    ],
                    "postDeployment": [
                      "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
                    ],
                    "prerequisites": [
                      "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents with a threat PCAP where the PCAP ID is not null or zero."
                    ],
                    "releaseNotes": [
                      {
                        "notes": [
                          "Initial version"
                        ],
                        "title": "Get Threat PCAP - Palo Alto PAN-OS XML API",
                        "version": "1.0.0"
                      }
                    ],
                    "tags": [
                      "Remediation",
                      "Response from teams"
                    ],
                    "title": "Get Threat PCAP - Palo Alto PAN-OS XML API"
                  },
                  "parameters": {
                    "CustomConnectorName": {
                      "defaultValue": "PAN-OSXmlApiCustomConnector",
                      "metadata": {
                        "description": "Name of the custom connector which interacts with PAN-OS"
                      },
                      "type": "String"
                    },
                    "LogAnalyticsResourceGroup": {
                      "metadata": {
                        "description": "Name of the cLog Analytics Resource group for logging"
                      },
                      "type": "string"
                    },
                    "LogAnalyticsResourceName": {
                      "metadata": {
                        "description": "Name of the log analytics instance for logging"
                      },
                      "type": "string"
                    },
                    "PlaybookName": {
                      "defaultValue": "PaloAlto-PAN-OS-GetThreatPcap",
                      "metadata": {
                        "description": "Name of the Logic App/Playbook"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2021-04-01",
                      "kind": "StorageV2",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureStorageName')]",
                      "properties": {
                        "accessTier": "Hot",
                        "allowBlobPublicAccess": "false",
                        "allowSharedKeyAccess": "true",
                        "minimumTlsVersion": "TLS1_2",
                        "networkAcls": {
                          "bypass": "AzureServices",
                          "defaultAction": "Allow"
                        },
                        "supportsHttpsTrafficOnly": "true"
                      },
                      "sku": {
                        "name": "Standard_LRS",
                        "tier": "Standard"
                      },
                      "type": "Microsoft.Storage/storageAccounts"
                    },
                    {
                      "apiVersion": "2021-02-01",
                      "dependsOn": [
                        "[[concat('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
                      ],
                      "name": "[[concat(variables('AzureStorageName'), '/default')]",
                      "properties": {
                        "deleteRetentionPolicy": {
                          "enabled": "false"
                        }
                      },
                      "type": "Microsoft.Storage/storageAccounts/blobServices"
                    },
                    {
                      "apiVersion": "2019-06-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Storage/storageAccounts/blobServices', variables('AzureStorageName'), 'default')]",
                        "[[resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName'))]"
                      ],
                      "name": "[[concat(variables('AzureStorageName'), '/default/', variables('ContainerName'))]",
                      "properties": {
                        "publicAccess": "None"
                      },
                      "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
                      ],
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureBlobConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-4')]"
                        },
                        "displayName": "[[variables('AzureBlobConnectionName')]",
                        "parameterValues": {
                          "accessKey": "[[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName')), '2021-09-01').keys[0].value]",
                          "accountName": "[[variables('AzureStorageName')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "kind": "V1",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureSentinelConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-5')]"
                        },
                        "displayName": "[[parameters('PlaybookName')]",
                        "parameterValueType": "Alternative"
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('PaloAltoConnectorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-6')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureMonitorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-7')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2017-07-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
                      ],
                      "identity": {
                        "type": "SystemAssigned"
                      },
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PlaybookName')]",
                      "properties": {
                        "definition": {
                          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                          "actions": {
                            "For_each": {
                              "actions": {
                                "If_incident_is_a_Palo_Alto_incident": {
                                  "actions": {
                                    "If_PCAP_ID_Exists": {
                                      "actions": {
                                        "Add_comment_to_incident_(V3)": {
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p>@{body('Create_blob_(V2)')?['Path']}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          },
                                          "runAfter": {
                                            "Create_blob_(V2)": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection"
                                        },
                                        "Create_blob_(V2)": {
                                          "inputs": {
                                            "body": "@body('Query_Palo_Alto_XML_API')",
                                            "headers": {
                                              "ReadFileMetadataFromServer": true
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azureblob']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('defendpaloaltopcapsdev'))}/files",
                                            "queries": {
                                              "folderPath": "pcapblobs-palo-alto",
                                              "name": "@{concat(string('paloalto',items('For_each')['PcapID']), string(items('For_each')['TimeGenerated']), '.pcap')}",
                                              "queryParametersSingleEncoded": true
                                            }
                                          },
                                          "runAfter": {
                                            "Query_Palo_Alto_XML_API": [
                                              "Succeeded"
                                            ]
                                          },
                                          "runtimeConfiguration": {
                                            "contentTransfer": {
                                              "transferMode": "Chunked"
                                            }
                                          },
                                          "type": "ApiConnection"
                                        },
                                        "Query_Palo_Alto_XML_API": {
                                          "inputs": {
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                              }
                                            },
                                            "method": "get",
                                            "path": "/api/",
                                            "queries": {
                                              "category": "threat-pcap",
                                              "device_name": "@items('For_each')['MonitoringDeviceName']",
                                              "pcap-id": "@items('For_each')['PcapID']",
                                              "search-time": "@{items('For_each')['TimeGenerated']}",
                                              "sessionId": "@items('For_each')['SessionID']",
                                              "type": "export"
                                            }
                                          },
                                          "type": "ApiConnection"
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@items('For_each')['PcapID']",
                                                "@null"
                                              ]
                                            }
                                          },
                                          {
                                            "not": {
                                              "equals": [
                                                "@items('For_each')['PcapID']",
                                                0
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "contains": [
                                          "@items('For_each')['AlertSource']",
                                          "@string('PaloAlto')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "foreach": "@body('Run_query_and_list_results')?['value']",
                              "runAfter": {
                                "Run_query_and_list_results": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Run_query_and_list_results": {
                              "inputs": {
                                "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/queryData",
                                "queries": {
                                  "resourcegroups": "[[parameters('LogAnalyticsResourceGroup')]",
                                  "resourcename": "[[parameters('LogAnalyticsResourceName')]",
                                  "resourcetype": "Log Analytics Workspace",
                                  "subscriptions": "[[variables('subscriptionId')]",
                                  "timerange": "Set in query"
                                }
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "contentVersion": "1.0.0.0",
                          "parameters": {
                            "$connections": {
                              "type": "Object"
                            }
                          },
                          "triggers": {
                            "incident": {
                              "inputs": {
                                "body": {
                                  "callback_url": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "path": "/incident-creation"
                              },
                              "type": "ApiConnectionWebhook"
                            }
                          }
                        },
                        "parameters": {
                          "$connections": {
                            "value": {
                              "azureblob": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                                "connectionName": "[[variables('AzureBlobConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureblob')]"
                              },
                              "azuremonitorlogs": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                                "connectionName": "[[variables('AzureMonitorConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                              },
                              "azuresentinel": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                                "connectionName": "[[variables('AzureSentinelConnectionName')]",
                                "connectionProperties": {
                                  "authentication": {
                                    "type": "ManagedServiceIdentity"
                                  }
                                },
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                              },
                              "paloaltoconnector": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                                "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                                "resourceGroup": "', resourceGroup().name, '"
                              }
                            }
                          }
                        },
                        "state": "Enabled"
                      },
                      "tags": {
                        "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
                      },
                      "type": "Microsoft.Logic/workflows"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId3')]",
                        "dependencies": {
                          "criteria": [
                            {
                              "contentId": "[variables('_PaloAltoCustomConnector')]",
                              "kind": "LogicAppsCustomConnector",
                              "version": "[variables('playbookVersion1')]"
                            }
                          ]
                        },
                        "kind": "Playbook",
                        "parentId": "[variables('playbookId3')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion3')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "AzureBlobConnectionName": "[[concat('azureblob-', parameters('PlaybookName'))]",
                    "AzureMonitorConnectionName": "[[concat('azuremonitor-', parameters('PlaybookName'))]",
                    "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
                    "AzureStorageName": "panosthreatpcapssa",
                    "ContainerName": "panosthreatpcaps",
                    "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
                    "_connection-4": "[[variables('connection-4')]",
                    "_connection-5": "[[variables('connection-5')]",
                    "_connection-6": "[[variables('connection-6')]",
                    "_connection-7": "[[variables('connection-7')]",
                    "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureblob')]",
                    "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                    "connection-6": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                    "connection-7": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
                    "subscriptionId": "[[subscription().subscriptionId]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName4')]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetURLCategoryInfo playbook",
                "displayName": "PaloAlto-PAN-OS-GetURLCategoryInfo playbook"
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName4'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName4'),'/',variables('playbookVersion4'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS-GetURLCategoryInfo Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion4')]",
                  "metadata": {
                    "comments": "This playbook uses the PaloAlto connector to automatically enrich incidents generated by Sentinel for address object details and URL filtering category information from PAN-OS",
                    "description": " When a new sentinal incident is created, this playbook gets triggered and performs below actions:",
                    "lastUpdateTime": "2022-07-25T00:00:00Z",
                    "mainSteps": [
                      "1. Fetches the address group details and URL filtering category information from PAN-OS \n\n 2. Updates all the collected information in incident \n\n ![PaloAlto-PAN-OS-GetURLCategoryInfo](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-GetURLCategoryInfo/designerscreenshot.PNG?raw=true)"
                    ],
                    "postDeployment": [
                      "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for PAN-OS API Connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky user account \n\n 2. Configure the automation rules to trigger this playbook"
                    ],
                    "prerequisites": [
                      "1. PAN-OS Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation)"
                    ],
                    "releaseNotes": [
                      {
                        "notes": [
                          "Initial version"
                        ],
                        "title": "PaloAlto-PAN-OS-GetURLCategoryInfo",
                        "version": "1.0.0"
                      }
                    ],
                    "title": "PaloAlto-PAN-OS-GetURLCategoryInfo"
                  },
                  "parameters": {
                    "CustomConnectorName": {
                      "defaultValue": "PAN-OSRestApiCustomConnector",
                      "type": "string"
                    },
                    "PlaybookName": {
                      "defaultValue": "PaloAlto-PAN-OS-GetURLCategoryInfo",
                      "metadata": {
                        "description": "Name of the Logic App/Playbook"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('PaloAltoConnectorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-1')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureSentinelConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-2')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2017-07-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
                      ],
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PlaybookName')]",
                      "properties": {
                        "definition": {
                          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                          "actions": {
                            "Entities_-_Get_URLs": {
                              "inputs": {
                                "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/entities/url"
                              },
                              "type": "ApiConnection"
                            },
                            "For_each_malicious_URL": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><strong>PAN-OS Playbook has collected the following information : </strong><br>\n<br>\nGot List of address objects and also got URL filtering category Information:<br>\n<br>\n<strong>Details of address objects:</strong><br>\n<br>\n<strong>name</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@name']}<br>\n<strong>location </strong>: &nbsp;@{outputs('Compose_body_of_address_object')?['@location']}<br>\n<strong>vsys</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@vsys']}<br>\n<strong>description</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['description']}<br>\n<strong>fqdn</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['fqdn']}<br>\n<br>\n<strong>Details of URL filtering category information:<br>\n</strong><br>\n@{body('Create_HTML_table_for_URL_category_information')}<br>\n</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Create_HTML_table_for_URL_category_information": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Compose_body_of_address_object": {
                                  "description": "This composes the body of address object where URL is a member",
                                  "inputs": "@body('Filter_URL_from_list_of_address_objects')?[0]",
                                  "runAfter": {
                                    "Filter_URL_from_list_of_address_objects": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose"
                                },
                                "Create_HTML_table_for_URL_category_information": {
                                  "description": "This creates HTML table for the URL filtering category information",
                                  "inputs": {
                                    "columns": [
                                      {
                                        "header": "name",
                                        "value": "@item()?['@name']"
                                      },
                                      {
                                        "header": "location",
                                        "value": "@item()?['@location']"
                                      },
                                      {
                                        "header": "vsys",
                                        "value": "@item()?['@vsys']"
                                      },
                                      {
                                        "header": "description",
                                        "value": "@item()?['description']"
                                      }
                                    ],
                                    "format": "HTML",
                                    "from": "@body('List_custom_url_categories')?['result']?['entry']"
                                  },
                                  "runAfter": {
                                    "Compose_body_of_address_object": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table"
                                },
                                "Filter_URL_from_list_of_address_objects": {
                                  "description": "This filters the URL from the list of address objects",
                                  "inputs": {
                                    "from": "@body('List_address_objects')?['result']?['entry']",
                                    "where": "@contains(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                                  },
                                  "type": "Query"
                                }
                              },
                              "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                              "runAfter": {
                                "List_custom_url_categories": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "List_address_objects": {
                              "description": "This Lists all the address objects present in the PAN-OS",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Objects/Addresses",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "Entities_-_Get_URLs": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "List_custom_url_categories": {
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Objects/CustomURLCategories",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "List_address_objects": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "contentVersion": "1.0.0.0",
                          "parameters": {
                            "$connections": {
                              "type": "Object"
                            }
                          },
                          "triggers": {
                            "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                              "inputs": {
                                "body": {
                                  "callback_url": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "path": "/incident-creation"
                              },
                              "type": "ApiConnectionWebhook"
                            }
                          }
                        },
                        "parameters": {
                          "$connections": {
                            "value": {
                              "PaloAltoConnector": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                                "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, parameters('CustomConnectorName'))]"
                              },
                              "azuresentinel": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                                "connectionName": "[[variables('AzureSentinelConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                              }
                            }
                          }
                        },
                        "state": "Enabled"
                      },
                      "tags": {
                        "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
                      },
                      "type": "Microsoft.Logic/workflows"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId4')]",
                        "dependencies": {
                          "criteria": [
                            {
                              "contentId": "[variables('_PaloAltoCustomConnector')]",
                              "kind": "LogicAppsCustomConnector",
                              "version": "[variables('playbookVersion1')]"
                            }
                          ]
                        },
                        "kind": "Playbook",
                        "parentId": "[variables('playbookId4')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion4')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
                    "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
                    "_connection-1": "[[variables('connection-1')]",
                    "_connection-2": "[[variables('connection-2')]",
                    "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                    "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName5')]",
              "properties": {
                "description": "PaloAlto-PAN-OS-BlockIP playbook",
                "displayName": "PaloAlto-PAN-OS-BlockIP playbook"
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName5'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName5'),'/',variables('playbookVersion5'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS-BlockIP Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion5')]",
                  "metadata": {
                    "comments": "This playbook uses the PaloAlto connector to take necessary actions on IP address like Block IP/Unblock IP from predefined address group and also gives an option to close the incident.",
                    "description": "This playbook allows blocking/unblocking IPs in PaloAlto, using **Address Object Groups**. This allows to make changes on predefined address group, which is attached to predefined security policy rule.",
                    "entities": [
                      "Ip"
                    ],
                    "lastUpdateTime": "2022-07-22T00:00:00Z",
                    "mainSteps": [
                      "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, IP address, list of existing security policy rules in which IP is a member of and provides an option to Block/Unblock IP Address to predefined address group or Ignore. \n\n 2. The SOC can take action on risky IP based on the information provided in the adaptive card. \n\n ![PaloAlto-PAN-OS-BlockIP](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/designerscreenshot.PNG?raw=true) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky IP for taking actions like block/unblock/ignore:** \n\n ![Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/AdaptiveCardtoBlockorUnblock.PNG?raw=true) \n\n **This is the consolidate adaptive card about the summary of actions taken on IP and the incident configuration:** \n\n ![Consolidated Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/SummarizedAdaptiveCard.PNG?raw=true)"
                    ],
                    "postDeployment": [
                      "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
                    ],
                    "prerequisites": [
                      "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://docs.paloaltonetworks.com/pan-os/10-1/pan-os-panorama-api/get-started-with-the-pan-os-xml-api/get-your-api-key) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
                    ],
                    "releaseNotes": [
                      {
                        "notes": [
                          "Initial version"
                        ],
                        "title": "PaloAlto-PAN-OS-BlockIP",
                        "version": "1.0.0"
                      }
                    ],
                    "tags": [
                      "Remediation",
                      "Response from teams"
                    ],
                    "title": "PaloAlto-PAN-OS-BlockIP"
                  },
                  "parameters": {
                    "Address Group": {
                      "defaultValue": "AddressGroup",
                      "metadata": {
                        "description": "Address Group"
                      },
                      "type": "String"
                    },
                    "CustomConnectorName": {
                      "defaultValue": "PAN-OSRestApiCustomConnector",
                      "type": "string"
                    },
                    "PlaybookName": {
                      "defaultValue": "PaloAlto-PAN-OS-BlockIP",
                      "metadata": {
                        "description": "Name of the Logic App/Playbook"
                      },
                      "type": "String"
                    },
                    "Teams ChannelId": {
                      "defaultValue": "TeamChannelId",
                      "metadata": {
                        "description": "Team ChannelId"
                      },
                      "type": "String"
                    },
                    "Teams GroupId": {
                      "defaultValue": "TeamgroupId",
                      "metadata": {
                        "description": "GroupId of the Team channel"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('PaloAltoConnectorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-1')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureSentinelConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-2')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('TeamsConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-3')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2017-07-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
                      ],
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PlaybookName')]",
                      "properties": {
                        "definition": {
                          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                          "actions": {
                            "Compose_product_name": {
                              "description": "compose to select the incident alert product name",
                              "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                              "runAfter": {
                                "Select_alert_product_names": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose"
                            },
                            "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('IPAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "type": "ApiConnection"
                                },
                                "Update_incident": {
                                  "inputs": {
                                    "body": {
                                      "classification": {
                                        "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}"
                                      },
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentSeverity']}",
                                      "status": "Closed"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "put",
                                    "path": "/Incidents"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "description": "This decides the action taken on the summarized adaptive card",
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                                      "Change incident configuration"
                                    ]
                                  }
                                ]
                              },
                              "runAfter": {
                                "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                                  "Succeeded"
                                ]
                              },
                              "type": "If"
                            },
                            "Entities_-_Get_IPs": {
                              "inputs": {
                                "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/entities/ip"
                              },
                              "type": "ApiConnection"
                            },
                            "For_each_malicious_IP": {
                              "actions": {
                                "Condition_based_on_user_inputs_from_the_adaptive_card": {
                                  "actions": {
                                    "Condition__to_check_if_user_chosen_Block_IP": {
                                      "actions": {
                                        "Create_an_address_object": {
                                          "description": "This creates a new address object for the malicious IP",
                                          "inputs": {
                                            "body": {
                                              "entry": {
                                                "@@name": "@items('For_each_malicious_IP')?['Address']",
                                                "description": "@items('For_each_malicious_IP')?['Address']",
                                                "ip-netmask": "@items('For_each_malicious_IP')?['Address']"
                                              }
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/restapi/v10.0/Objects/Addresses",
                                            "queries": {
                                              "address type": "ip-netmask",
                                              "location": "vsys",
                                              "name": "@items('For_each_malicious_IP')?['Address']",
                                              "vsys": "vsys1"
                                            }
                                          },
                                          "type": "ApiConnection"
                                        }
                                      },
                                      "description": "This check if user chooses Block IP",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                              "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                            ]
                                          },
                                          {
                                            "equals": [
                                              "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                              0
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Condition_to_check_the_edit_an_address_object_group_status": {
                                      "actions": {
                                        "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                          "actions": {
                                            "Append_success_status_Blocked_IP_status_to_summary_card": {
                                              "description": "append action taken to summarize on the adaptive card",
                                              "inputs": {
                                                "name": "IPAddressAction",
                                                "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                              },
                                              "type": "AppendToArrayVariable"
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_success_status_UnBlocked_IP_status_to_summary_card": {
                                                "description": "append action taken to summarize on the adaptive card",
                                                "inputs": {
                                                  "name": "IPAddressAction",
                                                  "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  UnBlocked  by      \n                                  removing from @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                                },
                                                "type": "AppendToArrayVariable"
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "equals": [
                                                  "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                                  "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_failure_status_to_summary_card": {
                                            "description": "append action taken to summarize on the adaptive card",
                                            "inputs": {
                                              "name": "IPAddressAction",
                                              "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status         :  Failure"
                                            },
                                            "type": "AppendToArrayVariable"
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@body('Update_an_address_object_group')?['@status']",
                                              "success"
                                            ]
                                          }
                                        ]
                                      },
                                      "runAfter": {
                                        "Update_an_address_object_group": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Update_an_address_object_group": {
                                      "inputs": {
                                        "body": {
                                          "entry": {
                                            "@@name": "[[parameters('Address Group')]",
                                            "static": {
                                              "member": "@variables('AddressGroupMembers')"
                                            }
                                          }
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                          }
                                        },
                                        "method": "put",
                                        "path": "/restapi/v10.0/Objects/AddressGroups",
                                        "queries": {
                                          "location": "vsys",
                                          "name": "[[parameters('Address Group')]",
                                          "vsys": "vsys1"
                                        }
                                      },
                                      "runAfter": {
                                        "Condition__to_check_if_user_chosen_Block_IP": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection"
                                    }
                                  },
                                  "description": "condition to check the submit action is block / unblock or Ignore",
                                  "else": {
                                    "actions": {
                                      "Append_to_array_variable_Ip_address_action_chosen": {
                                        "description": "This appends the action taken on IP to the list of existing actions",
                                        "inputs": {
                                          "name": "IPAddressAction",
                                          "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                            "Ignore"
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": {
                                  "actions": {
                                    "Condition_to_check_if_Ip_already_present_in_predefined_address_group": {
                                      "actions": {
                                        "Append_address_group_text": {
                                          "description": "append address group text to adaptive card dynamically",
                                          "inputs": {
                                            "name": "AdaptiveCardBody",
                                            "value": {
                                              "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                              "type": "TextBlock",
                                              "wrap": true
                                            }
                                          },
                                          "type": "AppendToArrayVariable"
                                        },
                                        "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": {
                                          "description": "This filters the IP address from predefined address group to unreference/unblock IP",
                                          "inputs": {
                                            "from": "@variables('AddressGroupMembers')",
                                            "where": "@not(equals(item(), items('For_each_malicious_IP')?['Address']))"
                                          },
                                          "runAfter": {
                                            "Set_dynamic_action_name": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Query"
                                        },
                                        "Set_dynamic_action_name": {
                                          "description": "variable to set action name dynamically",
                                          "inputs": {
                                            "name": "ActionName",
                                            "value": "UnBlock IP"
                                          },
                                          "runAfter": {
                                            "Append_address_group_text": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable"
                                        },
                                        "unreference_IP_address_from_the_existing_group_members": {
                                          "description": "unreference IP address from the group members and update",
                                          "inputs": {
                                            "name": "AddressGroupMembers",
                                            "value": "@body('Filter_array_IP_address_from_the_list_of_address_objects_to_unreference')"
                                          },
                                          "runAfter": {
                                            "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable"
                                        }
                                      },
                                      "description": "condition to check the malicious IP address is present in the predefined address group and the IP is part of static member",
                                      "else": {
                                        "actions": {
                                          "Append_IP_address_to_the_address_group_members": {
                                            "description": "append IP address to the address group members",
                                            "inputs": {
                                              "name": "AddressGroupMembers",
                                              "value": "@items('For_each_malicious_IP')?['Address']"
                                            },
                                            "runAfter": {
                                              "Append_address_group_text_to_adaptive_card_body": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "AppendToArrayVariable"
                                          },
                                          "Append_address_group_text_to_adaptive_card_body": {
                                            "description": "append address group text to adaptive card dynamically",
                                            "inputs": {
                                              "name": "AdaptiveCardBody",
                                              "value": {
                                                "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                                "type": "TextBlock",
                                                "wrap": true
                                              }
                                            },
                                            "type": "AppendToArrayVariable"
                                          },
                                          "Set_dynamic_action_name_to_variable_Action_name": {
                                            "description": "set action name dynamically",
                                            "inputs": {
                                              "name": "ActionName",
                                              "value": "Block IP"
                                            },
                                            "runAfter": {
                                              "Append_IP_address_to_the_address_group_members": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "SetVariable"
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "contains": [
                                              "@variables('AddressGroupMembers')",
                                              "@items('For_each_malicious_IP')?['Address']"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "description": "This checks if Ip is a member of any of the list of address objects",
                                  "else": {
                                    "actions": {
                                      "Append_IP_to_array_of_address_group_members": {
                                        "description": "append the Malicious IP address to the existing group members to block / unblock from the predefined address group",
                                        "inputs": {
                                          "name": "AddressGroupMembers",
                                          "value": "@items('For_each_malicious_IP')?['Address']"
                                        },
                                        "runAfter": {
                                          "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": {
                                        "description": "This appends the text to display If Ip is not a member of security policy rules",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {
                                            "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                            "type": "TextBlock",
                                            "wrap": true
                                          }
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Set_variable_to_Block_Ip": {
                                        "description": "This sets the variable block IP",
                                        "inputs": {
                                          "name": "ActionName",
                                          "value": "Block IP"
                                        },
                                        "runAfter": {
                                          "Append_IP_to_array_of_address_group_members": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "SetVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": {
                                  "actions": {
                                    "Append_policy_text": {
                                      "description": "dynamic policy text based on security policies",
                                      "inputs": {
                                        "name": "AdaptiveCardBody",
                                        "value": {
                                          "text": "It is also member of the following security policy rules",
                                          "type": "TextBlock"
                                        }
                                      },
                                      "type": "AppendToArrayVariable"
                                    },
                                    "Append_security_policies": {
                                      "description": "append security policies which the IP address is exist",
                                      "inputs": {
                                        "name": "AdaptiveCardBody",
                                        "value": {
                                          "columns": [
                                            {
                                              "items": "@body('Select_security_policy_rules')",
                                              "type": "Column"
                                            }
                                          ],
                                          "type": "ColumnSet"
                                        }
                                      },
                                      "runAfter": {
                                        "Append_policy_text": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable"
                                    }
                                  },
                                  "description": "condition to check if the IP address is present in the existing security policy rules to conditionally apply the policy text and security policy rules",
                                  "else": {
                                    "actions": {
                                      "Append_policy_text_to_adaptive_card_body_variable": {
                                        "description": "dynamic policy text based on security policies",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {
                                            "text": "It is not a member of any other Policy Rules",
                                            "type": "TextBlock"
                                          }
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Append_security_policies_to_adaptive_card_body_variable": {
                                        "description": "append security policies which the IP address is exist",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {}
                                        },
                                        "runAfter": {
                                          "Append_policy_text_to_adaptive_card_body_variable": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(body('Select_security_policy_rules'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Select_security_policy_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Configured_address_group": {
                                  "description": "compose predefined address group",
                                  "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                                  "runAfter": {
                                    "Set_variable_address_group_members": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose"
                                },
                                "Filter_array_Ip_from_list_of_security_rules": {
                                  "description": "This filters all the security rules in which this Ip is a member",
                                  "inputs": {
                                    "from": "@body('List_security_rules')?['result']?['entry']",
                                    "where": "@contains(item()?['source']?['member'], items('For_each_malicious_IP')?['Address'])"
                                  },
                                  "runAfter": {
                                    "Configured_address_group": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "Filter_array_of_Ip_address_from_list_of_address_objects": {
                                  "description": "This filters the list of address objects in which this Ip is a member ",
                                  "inputs": {
                                    "from": "@body('List_address_objects')?['result']?['entry']",
                                    "where": "@equals(item()?['ip-netmask'], items('For_each_malicious_IP')?['Address'])"
                                  },
                                  "runAfter": {
                                    "Set_variable_adaptive_card_body": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "List_address_groups": {
                                  "description": "This gets complete list of address object groups present in the PAN-OS",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/restapi/v10.0/Objects/AddressGroups",
                                    "queries": {
                                      "location": "vsys",
                                      "name": "[[parameters('Address Group')]",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "runAfter": {
                                    "Filter_array_of_Ip_address_from_list_of_address_objects": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                                  "inputs": {
                                    "body": {
                                      "body": {
                                        "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                        "recipient": {
                                          "channelId": "[[parameters('Teams ChannelId')]"
                                        },
                                        "shouldUpdateCard": true
                                      },
                                      "notificationUrl": "@{listCallbackUrl()}"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                                    "queries": {
                                      "groupId": "[[parameters('Teams GroupId')]"
                                    }
                                  },
                                  "runAfter": {
                                    "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnectionWebhook"
                                },
                                "Select_security_policy_rules": {
                                  "description": "prepare columns list to show the security policy rules in the adaptive card if IP address is present",
                                  "inputs": {
                                    "from": "@body('Filter_array_Ip_from_list_of_security_rules')",
                                    "select": {
                                      "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                                      "type": "TextBlock",
                                      "weight": "bolder"
                                    }
                                  },
                                  "runAfter": {
                                    "Filter_array_Ip_from_list_of_security_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Select"
                                },
                                "Set_variable_adaptive_card_body": {
                                  "description": "variable to hold adaptive card body",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": [
                                      {
                                        "size": "Large",
                                        "text": "Suspicious IP - Microsoft Sentinel",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "Possible Comprised IP @{items('For_each_malicious_IP')?['Address']} detected by the provider  :  @{outputs('Compose_product_name')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "text": " @{triggerBody()?['object']?['properties']?['severity']} Incident @{triggerBody()?['object']?['properties']?['title']} ",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "Incident description",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "size": "Medium",
                                        "text": "Response in PAN-OS",
                                        "type": "TextBlock",
                                        "weight": "Bolder"
                                      },
                                      {
                                        "size": "Small",
                                        "style": "Person",
                                        "type": "Image",
                                        "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                                      }
                                    ]
                                  },
                                  "type": "SetVariable"
                                },
                                "Set_variable_address_group_members": {
                                  "description": "assign list of address group members",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                                  },
                                  "runAfter": {
                                    "List_address_groups": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                }
                              },
                              "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                              "runAfter": {
                                "List_security_rules": [
                                  "Succeeded"
                                ]
                              },
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 1
                                }
                              },
                              "type": "Foreach"
                            },
                            "Initialize_variable_IP_address_action": {
                              "description": "This holds the action taken on each IP ",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "IPAddressAction",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_address_group_members": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_action_name": {
                              "description": "variable to store action name to be displayed on adaptive card",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "ActionName",
                                    "type": "string"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Entities_-_Get_IPs": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_adaptive_card_body": {
                              "description": "variable to store adaptive card body json",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "AdaptiveCardBody",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_action_name": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_address_group_members": {
                              "description": "variable to store the list of address group members",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "AddressGroupMembers",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_adaptive_card_body": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "List_address_objects": {
                              "description": "This gets complete list of address object present in the PAN-OS",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Objects/Addresses",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "Compose_product_name": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "List_security_rules": {
                              "description": "This gets complete list of security policy rules present in the PAN-OS",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Policies/SecurityRules",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "List_address_objects": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                              "inputs": {
                                "body": {
                                  "body": {
                                    "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on IP's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n{\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                    "recipient": {
                                      "channelId": "[[parameters('Teams ChannelId')]"
                                    },
                                    "shouldUpdateCard": true
                                  },
                                  "notificationUrl": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['teams']['connectionId']"
                                  }
                                },
                                "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                                "queries": {
                                  "groupId": "[[parameters('Teams GroupId')]"
                                }
                              },
                              "runAfter": {
                                "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnectionWebhook"
                            },
                            "Select_alert_product_names": {
                              "description": "data operator to select the alert product name",
                              "inputs": {
                                "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                                "select": {
                                  "text": "@item()"
                                }
                              },
                              "runAfter": {
                                "Initialize_variable_IP_address_action": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Select"
                            },
                            "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": {
                              "description": "This is used to compose the list of actions taken by SOC on respective IP addresses",
                              "inputs": {
                                "from": "@variables('IPAddressAction')",
                                "select": {
                                  "text": "@item()",
                                  "type": "TextBlock"
                                }
                              },
                              "runAfter": {
                                "For_each_malicious_IP": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Select"
                            }
                          },
                          "contentVersion": "1.0.0.0",
                          "parameters": {
                            "$connections": {
                              "type": "Object"
                            }
                          },
                          "triggers": {
                            "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                              "inputs": {
                                "body": {
                                  "callback_url": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "path": "/incident-creation"
                              },
                              "type": "ApiConnectionWebhook"
                            }
                          }
                        },
                        "parameters": {
                          "$connections": {
                            "value": {
                              "PaloAltoConnector": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                                "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                                "resourceGroup": "', resourceGroup().name, '"
                              },
                              "azuresentinel": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                                "connectionName": "[[variables('AzureSentinelConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                              },
                              "teams": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                                "connectionName": "[[variables('TeamsConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                              }
                            }
                          }
                        },
                        "state": "Enabled"
                      },
                      "tags": {
                        "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
                      },
                      "type": "Microsoft.Logic/workflows"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId5')]",
                        "dependencies": {
                          "criteria": [
                            {
                              "contentId": "[variables('_PaloAltoCustomConnector')]",
                              "kind": "LogicAppsCustomConnector",
                              "version": "[variables('playbookVersion1')]"
                            }
                          ]
                        },
                        "kind": "Playbook",
                        "parentId": "[variables('playbookId5')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion5')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
                    "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
                    "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
                    "_connection-1": "[[variables('connection-1')]",
                    "_connection-2": "[[variables('connection-2')]",
                    "_connection-3": "[[variables('connection-3')]",
                    "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                    "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                    "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2021-05-01",
              "location": "[parameters('workspace-location')]",
              "name": "[variables('playbookTemplateSpecName6')]",
              "properties": {
                "description": "PaloAlto-PAN-OS-BlockURL playbook",
                "displayName": "PaloAlto-PAN-OS-BlockURL playbook"
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs"
            },
            {
              "apiVersion": "2021-05-01",
              "dependsOn": [
                "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName6'))]"
              ],
              "location": "[parameters('workspace-location')]",
              "name": "[concat(variables('playbookTemplateSpecName6'),'/',variables('playbookVersion6'))]",
              "properties": {
                "description": "PaloAlto-PAN-OS-BlockURL Playbook with template version 2.0.0",
                "mainTemplate": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "[variables('playbookVersion6')]",
                  "metadata": {
                    "comments": "This playbook uses the PaloAlto connector to take necessary actions on URL address like Block URL/Unblock URL from predefined address group and also gives an option to close the incident.",
                    "description": "This playbook allows blocking/unblocking URLs in PaloAlto, using **predefined address group**. This allows to make changes on predefined address group, which is attached to security policy rule.",
                    "entities": [
                      "Url"
                    ],
                    "lastUpdateTime": "2022-07-22T00:00:00Z",
                    "mainSteps": [
                      "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, URL address, list of existing security policy rules in which URL is a member of and provides an option to Block/Unblock URL Address by adding/removing it to/from the predefined address group. \n\n 2. The SOC can act on risky URL based on the information provided in the adaptive card, or ignore. \n\n ![PaloAlto-PAN-OS-BlockURL](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/designerscreenshot.PNG?raw=true) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky URL for taking actions like block/unblock/ignore ::** \n\n ![Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/AdaptiveCardtoBlockorUnblock.PNG?raw=true) \n\n **This is the consolidate adaptive card about the summary of actions taken on URL and the incident configuration ::** \n\n ![Consolidated Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/SummarizedAdaptiveCard.PNG?raw=true)"
                    ],
                    "postDeployment": [
                      "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky URL \n\n 2. Configure the automation rules to trigger this playbook"
                    ],
                    "prerequisites": [
                      "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
                    ],
                    "releaseNotes": [
                      {
                        "notes": [
                          "Initial version"
                        ],
                        "title": "PaloAlto-PAN-OS-BlockURL",
                        "version": "1.0.0"
                      }
                    ],
                    "tags": [
                      "Remediation",
                      "Response from teams"
                    ],
                    "title": "PaloAlto-PAN-OS-BlockURL"
                  },
                  "parameters": {
                    "Address Group": {
                      "defaultValue": "AddressGroup",
                      "metadata": {
                        "description": "Address Group"
                      },
                      "type": "String"
                    },
                    "CustomConnectorName": {
                      "defaultValue": "PAN-OSRestApiCustomConnector",
                      "type": "string"
                    },
                    "PlaybookName": {
                      "defaultValue": "PaloAlto-PAN-OS-BlockURL",
                      "metadata": {
                        "description": "Name of the Logic App/Playbook"
                      },
                      "type": "String"
                    },
                    "Teams ChannelId": {
                      "defaultValue": "TeamChannelId",
                      "metadata": {
                        "description": "Team ChannelId"
                      },
                      "type": "String"
                    },
                    "Teams GroupId": {
                      "defaultValue": "TeamgroupId",
                      "metadata": {
                        "description": "GroupId of the Team channel"
                      },
                      "type": "String"
                    }
                  },
                  "resources": [
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('PaloAltoConnectorConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-1')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('AzureSentinelConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-2')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2016-06-01",
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[variables('TeamsConnectionName')]",
                      "properties": {
                        "api": {
                          "id": "[[variables('_connection-3')]"
                        }
                      },
                      "type": "Microsoft.Web/connections"
                    },
                    {
                      "apiVersion": "2017-07-01",
                      "dependsOn": [
                        "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
                      ],
                      "location": "[[variables('workspace-location-inline')]",
                      "name": "[[parameters('PlaybookName')]",
                      "properties": {
                        "definition": {
                          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                          "actions": {
                            "Compose_product_name": {
                              "description": "compose to select the incident alert product name",
                              "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                              "runAfter": {
                                "Select_alert_product_names": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose"
                            },
                            "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('URLAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "type": "ApiConnection"
                                },
                                "Update_incident": {
                                  "inputs": {
                                    "body": {
                                      "classification": {
                                        "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}"
                                      },
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentSeverity']}",
                                      "status": "Closed"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "put",
                                    "path": "/Incidents"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "description": "This decides the action taken on the summarized adaptive card",
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                                      "Change incident configuration"
                                    ]
                                  }
                                ]
                              },
                              "runAfter": {
                                "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                                  "Succeeded"
                                ]
                              },
                              "type": "If"
                            },
                            "Entities_-_Get_URLs": {
                              "inputs": {
                                "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/entities/url"
                              },
                              "type": "ApiConnection"
                            },
                            "For_each_malicious_URL": {
                              "actions": {
                                "Condition_based_on_user_inputs_from_the_adaptive_card": {
                                  "actions": {
                                    "Condition__to_check_if_user_chosen_Block": {
                                      "actions": {
                                        "Create_an_address_object": {
                                          "description": "This creates a new address object for the malicious URL",
                                          "inputs": {
                                            "body": {
                                              "entry": [
                                                {
                                                  "@@name": "@items('For_each_malicious_URL')?['Url']",
                                                  "description": "@items('For_each_malicious_URL')?['Url']",
                                                  "fqdn": "@items('For_each_malicious_URL')?['Url']"
                                                }
                                              ]
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/restapi/v10.0/Objects/Addresses",
                                            "queries": {
                                              "address type": "[variables('blanks')]",
                                              "location": "vsys",
                                              "name": "@items('For_each_malicious_URL')?['Url']",
                                              "vsys": "vsys1"
                                            }
                                          },
                                          "type": "ApiConnection"
                                        }
                                      },
                                      "description": "This check if user chooses Block URL",
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                              "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                            ]
                                          },
                                          {
                                            "equals": [
                                              "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                              0
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Condition_to_check_the_edit_an_address_object_group_status": {
                                      "actions": {
                                        "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                          "actions": {
                                            "Append_success_status_Blocked_URL_status_to_summary_card": {
                                              "description": "append action taken to summarize on the adaptive card",
                                              "inputs": {
                                                "name": "URLAddressAction",
                                                "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                              },
                                              "type": "AppendToArrayVariable"
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_success_status_UnBlocked_URL_status_to_summary_card": {
                                                "description": "append action taken to summarize on the adaptive card",
                                                "inputs": {
                                                  "name": "URLAddressAction",
                                                  "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  UnBlocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                                },
                                                "type": "AppendToArrayVariable"
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "equals": [
                                                  "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                                  "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_failure_status_to_summary_card": {
                                            "description": "append action taken to summarize on the adaptive card",
                                            "inputs": {
                                              "name": "URLAddressAction",
                                              "value": "URL Address : @{items('For_each_malicious_URL')?['Url']}  ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Failure"
                                            },
                                            "type": "AppendToArrayVariable"
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "equals": [
                                              "@body('Update_an_address_object_group')?['@status']",
                                              "success"
                                            ]
                                          }
                                        ]
                                      },
                                      "runAfter": {
                                        "Update_an_address_object_group": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Update_an_address_object_group": {
                                      "inputs": {
                                        "body": {
                                          "entry": {
                                            "@@name": "[[parameters('Address Group')]",
                                            "static": {
                                              "member": "@{variables('AddressGroupMembers')}"
                                            }
                                          }
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                          }
                                        },
                                        "method": "put",
                                        "path": "/restapi/v10.0/Objects/AddressGroups",
                                        "queries": {
                                          "location": "vsys",
                                          "name": "[[parameters('Address Group')]",
                                          "vsys": "vsys1"
                                        }
                                      },
                                      "runAfter": {
                                        "Condition__to_check_if_user_chosen_Block": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection"
                                    }
                                  },
                                  "description": "condition to check the submit action is block / unblock or Ignore",
                                  "else": {
                                    "actions": {
                                      "Append_to_array_variable_URL_address_action_chosen": {
                                        "description": "This appends the action taken on URL to the list of existing actions",
                                        "inputs": {
                                          "name": "URLAddressAction",
                                          "value": "URL Address : @{items('For_each_malicious_URL')?['Url']},  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                            "Ignore"
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": {
                                  "actions": {
                                    "Condition_to_check_if_URL_already_present_in_predefined_address_group": {
                                      "actions": {
                                        "Append_address_group_text": {
                                          "description": "append address group text to adaptive card dynamically",
                                          "inputs": {
                                            "name": "AdaptiveCardBody",
                                            "value": {
                                              "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                              "type": "TextBlock",
                                              "wrap": true
                                            }
                                          },
                                          "type": "AppendToArrayVariable"
                                        },
                                        "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": {
                                          "description": "This filters the URL address from predefined address group to unreference/unblock URL",
                                          "inputs": {
                                            "from": "@variables('AddressGroupMembers')",
                                            "where": "@not(equals(item(), items('For_each_malicious_URL')?['Url']))"
                                          },
                                          "runAfter": {
                                            "Set_dynamic_action_name": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Query"
                                        },
                                        "Set_dynamic_action_name": {
                                          "description": "variable to set action name dynamically",
                                          "inputs": {
                                            "name": "ActionName",
                                            "value": "UnBlock URL"
                                          },
                                          "runAfter": {
                                            "Append_address_group_text": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable"
                                        },
                                        "unreference_URL_address_from_the_existing_group_members": {
                                          "description": "unreference URL address from the group members and update",
                                          "inputs": {
                                            "name": "AddressGroupMembers",
                                            "value": "@body('Filter_array_URL_address_from_the_list_of_address_objects_to_unreference')"
                                          },
                                          "runAfter": {
                                            "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable"
                                        }
                                      },
                                      "description": "condition to check the malicious URL address is present in the predefined address group and the URL is part of static member",
                                      "else": {
                                        "actions": {
                                          "Append_URL_address_to_the_address_group_members": {
                                            "description": "append URL address to the address group members",
                                            "inputs": {
                                              "name": "AddressGroupMembers",
                                              "value": "@items('For_each_malicious_URL')?['Url']"
                                            },
                                            "runAfter": {
                                              "Append_address_group_text_to_adaptive_card_body": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "AppendToArrayVariable"
                                          },
                                          "Append_address_group_text_to_adaptive_card_body": {
                                            "description": "append address group text to adaptive card dynamically",
                                            "inputs": {
                                              "name": "AdaptiveCardBody",
                                              "value": {
                                                "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                                "type": "TextBlock",
                                                "wrap": true
                                              }
                                            },
                                            "type": "AppendToArrayVariable"
                                          },
                                          "Set_dynamic_action_name_to_variable_Action_name": {
                                            "description": "set action name dynamically",
                                            "inputs": {
                                              "name": "ActionName",
                                              "value": "Block URL"
                                            },
                                            "runAfter": {
                                              "Append_URL_address_to_the_address_group_members": [
                                                "Succeeded"
                                              ]
                                            },
                                            "type": "SetVariable"
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "contains": [
                                              "@variables('AddressGroupMembers')",
                                              "@items('For_each_malicious_URL')?['Url']"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "description": "This checks if URL is a member of any of the list of address objects",
                                  "else": {
                                    "actions": {
                                      "Append_URL_to_array_of_address_group_members": {
                                        "description": "append the Malicious URL address to the existing group members to block / unblock from the predefined address group",
                                        "inputs": {
                                          "name": "AddressGroupMembers",
                                          "value": "@items('For_each_malicious_URL')?['Url']"
                                        },
                                        "runAfter": {
                                          "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": {
                                        "description": "This appends the text to display If URL is not a member of security policy rules",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {
                                            "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                            "type": "TextBlock",
                                            "wrap": true
                                          }
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Set_variable_to_Block_URL": {
                                        "description": "This sets the variable block URL",
                                        "inputs": {
                                          "name": "ActionName",
                                          "value": "Block URL"
                                        },
                                        "runAfter": {
                                          "Append_URL_to_array_of_address_group_members": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "SetVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": {
                                  "actions": {
                                    "Append_policy_text": {
                                      "description": "dynamic policy text based on security policies",
                                      "inputs": {
                                        "name": "AdaptiveCardBody",
                                        "value": {
                                          "text": "It is also member of the following security policy rules",
                                          "type": "TextBlock"
                                        }
                                      },
                                      "type": "AppendToArrayVariable"
                                    },
                                    "Append_security_policies": {
                                      "description": "append security policies which the URL address is exist",
                                      "inputs": {
                                        "name": "AdaptiveCardBody",
                                        "value": {
                                          "columns": [
                                            {
                                              "items": "@body('Select_security_policy_rules')",
                                              "type": "Column"
                                            }
                                          ],
                                          "type": "ColumnSet"
                                        }
                                      },
                                      "runAfter": {
                                        "Append_policy_text": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable"
                                    }
                                  },
                                  "description": "condition to check if the URL address is present in the existing security policy rules to conditionally apply the policy text and security policy rules",
                                  "else": {
                                    "actions": {
                                      "Append_policy_text_to_adaptive_card_body_variable": {
                                        "description": "dynamic policy text based on security policies",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {
                                            "text": "It is not a member of any other Policy Rules",
                                            "type": "TextBlock"
                                          }
                                        },
                                        "type": "AppendToArrayVariable"
                                      },
                                      "Append_security_policies_to_adaptive_card_body_variable": {
                                        "description": "append security policies which the URL address is exist",
                                        "inputs": {
                                          "name": "AdaptiveCardBody",
                                          "value": {}
                                        },
                                        "runAfter": {
                                          "Append_policy_text_to_adaptive_card_body_variable": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(body('Select_security_policy_rules'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "runAfter": {
                                    "Select_security_policy_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Configured_address_group": {
                                  "description": "compose predefined address group",
                                  "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                                  "runAfter": {
                                    "Set_variable_address_group_members": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose"
                                },
                                "Filter_array_URL_from_list_of_security_rules": {
                                  "description": "This filters all the security rules in which this URL is a member",
                                  "inputs": {
                                    "from": "@body('List_security_rules')?['result']?['entry']",
                                    "where": "@contains(item()?['destination']?['member'], items('For_each_malicious_URL')?['Url'])"
                                  },
                                  "runAfter": {
                                    "Configured_address_group": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "Filter_array_of_URL_address_from_list_of_address_objects": {
                                  "description": "This filters the list of address objects in which this URL is a member ",
                                  "inputs": {
                                    "from": "@body('List_address_objects')?['result']?['entry']",
                                    "where": "@equals(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                                  },
                                  "runAfter": {
                                    "Set_variable_adaptive_card_body": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "List_address_groups": {
                                  "description": "This gets complete list of address object groups present in the PAN-OS",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/restapi/v10.0/Objects/AddressGroups",
                                    "queries": {
                                      "location": "vsys",
                                      "name": "[[parameters('Address Group')]",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "runAfter": {
                                    "Filter_array_of_URL_address_from_list_of_address_objects": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                                  "inputs": {
                                    "body": {
                                      "body": {
                                        "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                        "recipient": {
                                          "channelId": "[[parameters('Teams ChannelId')]"
                                        },
                                        "shouldUpdateCard": true
                                      },
                                      "notificationUrl": "@{listCallbackUrl()}"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['teams']['connectionId']"
                                      }
                                    },
                                    "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                                    "queries": {
                                      "groupId": "[[parameters('Teams GroupId')]"
                                    }
                                  },
                                  "runAfter": {
                                    "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnectionWebhook"
                                },
                                "Select_security_policy_rules": {
                                  "description": "prepare columns list to show the security policy rules in the adaptive card if URL address is present",
                                  "inputs": {
                                    "from": "@body('Filter_array_URL_from_list_of_security_rules')",
                                    "select": {
                                      "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                                      "type": "TextBlock",
                                      "weight": "bolder"
                                    }
                                  },
                                  "runAfter": {
                                    "Filter_array_URL_from_list_of_security_rules": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Select"
                                },
                                "Set_variable_adaptive_card_body": {
                                  "description": "variable to hold adaptive card body",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": [
                                      {
                                        "size": "Large",
                                        "text": "Suspicious URL - Microsoft Sentinel",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "Possible Comprised URL @{items('For_each_malicious_URL')?['Url']} detected by the provider : @{outputs('Compose_product_name')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "text": "@{triggerBody()?['object']?['properties']?['severity']}  Incident  @{triggerBody()?['object']?['properties']?['title']}",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "Incident description",
                                        "type": "TextBlock",
                                        "weight": "Bolder",
                                        "wrap": true
                                      },
                                      {
                                        "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                        "type": "TextBlock",
                                        "wrap": true
                                      },
                                      {
                                        "size": "Medium",
                                        "text": "Response in PAN-OS",
                                        "type": "TextBlock",
                                        "weight": "Bolder"
                                      },
                                      {
                                        "size": "Small",
                                        "style": "Person",
                                        "type": "Image",
                                        "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                                      }
                                    ]
                                  },
                                  "type": "SetVariable"
                                },
                                "Set_variable_address_group_members": {
                                  "description": "assign list of address group members",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                                  },
                                  "runAfter": {
                                    "List_address_groups": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                }
                              },
                              "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                              "runAfter": {
                                "List_security_rules": [
                                  "Succeeded"
                                ]
                              },
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 1
                                }
                              },
                              "type": "Foreach"
                            },
                            "Initialize_variable_URL_address_action": {
                              "description": "This holds the action taken on each URL ",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "URLAddressAction",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_address_group_members": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_action_name": {
                              "description": "variable to store action name to be displayed on adaptive card",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "ActionName",
                                    "type": "string"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Entities_-_Get_URLs": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_adaptive_card_body": {
                              "description": "variable to store adaptive card body json",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "AdaptiveCardBody",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_action_name": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "Initialize_variable_address_group_members": {
                              "description": "variable to store the list of address group members",
                              "inputs": {
                                "variables": [
                                  {
                                    "name": "AddressGroupMembers",
                                    "type": "array"
                                  }
                                ]
                              },
                              "runAfter": {
                                "Initialize_variable_adaptive_card_body": [
                                  "Succeeded"
                                ]
                              },
                              "type": "InitializeVariable"
                            },
                            "List_address_objects": {
                              "description": "This gets complete list of address object present in the PAN-OS",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Objects/Addresses",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "Compose_product_name": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "List_security_rules": {
                              "description": "This gets complete list of security policy rules present in the PAN-OS",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/restapi/v10.0/Policies/SecurityRules",
                                "queries": {
                                  "location": "vsys",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "List_address_objects": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                              "inputs": {
                                "body": {
                                  "body": {
                                    "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on URL's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n  {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                    "recipient": {
                                      "channelId": "[[parameters('Teams ChannelId')]"
                                    },
                                    "shouldUpdateCard": true
                                  },
                                  "notificationUrl": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['teams']['connectionId']"
                                  }
                                },
                                "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                                "queries": {
                                  "groupId": "[[parameters('Teams GroupId')]"
                                }
                              },
                              "runAfter": {
                                "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnectionWebhook"
                            },
                            "Select_alert_product_names": {
                              "description": "data operator to select the alert product name",
                              "inputs": {
                                "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                                "select": {
                                  "text": "@item()"
                                }
                              },
                              "runAfter": {
                                "Initialize_variable_URL_address_action": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Select"
                            },
                            "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": {
                              "description": "This is used to compose the list of actions taken by SOC on respective URL addresses",
                              "inputs": {
                                "from": "@variables('URLAddressAction')",
                                "select": {
                                  "text": "@item()",
                                  "type": "TextBlock"
                                }
                              },
                              "runAfter": {
                                "For_each_malicious_URL": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Select"
                            }
                          },
                          "contentVersion": "1.0.0.0",
                          "parameters": {
                            "$connections": {
                              "type": "Object"
                            }
                          },
                          "triggers": {
                            "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                              "inputs": {
                                "body": {
                                  "callback_url": "@{listCallbackUrl()}"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "path": "/incident-creation"
                              },
                              "type": "ApiConnectionWebhook"
                            }
                          }
                        },
                        "parameters": {
                          "$connections": {
                            "value": {
                              "PaloAltoConnector": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                                "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                                "resourceGroup": "', resourceGroup().name, '"
                              },
                              "azuresentinel": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                                "connectionName": "[[variables('AzureSentinelConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                              },
                              "teams": {
                                "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                                "connectionName": "[[variables('TeamsConnectionName')]",
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                              }
                            }
                          }
                        },
                        "state": "Enabled"
                      },
                      "tags": {
                        "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
                      },
                      "type": "Microsoft.Logic/workflows"
                    },
                    {
                      "apiVersion": "2022-01-01-preview",
                      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
                      "properties": {
                        "author": {
                          "email": "[variables('_email')]",
                          "name": "Microsoft"
                        },
                        "contentId": "[variables('_playbookContentId6')]",
                        "dependencies": {
                          "criteria": [
                            {
                              "contentId": "[variables('_PaloAltoCustomConnector')]",
                              "kind": "LogicAppsCustomConnector",
                              "version": "[variables('playbookVersion1')]"
                            }
                          ]
                        },
                        "kind": "Playbook",
                        "parentId": "[variables('playbookId6')]",
                        "source": {
                          "kind": "Solution",
                          "name": "PaloAlto-PAN-OS",
                          "sourceId": "[variables('_solutionId')]"
                        },
                        "support": {
                          "email": "support@microsoft.com",
                          "link": "https://support.microsoft.com",
                          "name": "Microsoft Corporation",
                          "tier": "Microsoft"
                        },
                        "version": "[variables('playbookVersion6')]"
                      },
                      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
                    }
                  ],
                  "variables": {
                    "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
                    "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
                    "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
                    "_connection-1": "[[variables('connection-1')]",
                    "_connection-2": "[[variables('connection-2')]",
                    "_connection-3": "[[variables('connection-3')]",
                    "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                    "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                    "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
                    "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
                    "workspace-name": "[parameters('workspace')]",
                    "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
                  }
                }
              },
              "tags": {
                "hidden-sentinelContentType": "Playbook",
                "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Resources/templateSpecs/versions"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "location": "[parameters('workspace-location')]",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]",
              "properties": {
                "author": {
                  "email": "[variables('_email')]",
                  "name": "Microsoft"
                },
                "categories": {
                  "domains": [
                    "Security  Automation (SOAR)",
                    "Security  Network"
                  ]
                },
                "contentId": "[variables('_solutionId')]",
                "contentSchemaVersion": "2.0.0",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "[variables('_dataConnectorContentId1')]",
                      "kind": "DataConnector",
                      "version": "[variables('dataConnectorVersion1')]"
                    },
                    {
                      "contentId": "[variables('_huntingQuerycontentId1')]",
                      "kind": "HuntingQuery",
                      "version": "[variables('huntingQueryVersion1')]"
                    },
                    {
                      "contentId": "[variables('_workbookContentId1')]",
                      "kind": "Workbook",
                      "version": "[variables('workbookVersion1')]"
                    },
                    {
                      "contentId": "[variables('_workbookContentId2')]",
                      "kind": "Workbook",
                      "version": "[variables('workbookVersion2')]"
                    },
                    {
                      "contentId": "[variables('analyticRulecontentId1')]",
                      "kind": "AnalyticsRule",
                      "version": "[variables('analyticRuleVersion1')]"
                    },
                    {
                      "contentId": "[variables('analyticRulecontentId2')]",
                      "kind": "AnalyticsRule",
                      "version": "[variables('analyticRuleVersion2')]"
                    },
                    {
                      "contentId": "[variables('analyticRulecontentId3')]",
                      "kind": "AnalyticsRule",
                      "version": "[variables('analyticRuleVersion3')]"
                    },
                    {
                      "contentId": "[variables('analyticRulecontentId4')]",
                      "kind": "AnalyticsRule",
                      "version": "[variables('analyticRuleVersion4')]"
                    },
                    {
                      "contentId": "[variables('_PaloAltoCustomConnector')]",
                      "kind": "LogicAppsCustomConnector",
                      "version": "[variables('playbookVersion1')]"
                    },
                    {
                      "contentId": "[variables('_PaloAlto-PAN-OS-GetSystemInfo')]",
                      "kind": "Playbook",
                      "version": "[variables('playbookVersion2')]"
                    },
                    {
                      "contentId": "[variables('_PaloAlto-PAN-OS-GetThreatPCAP')]",
                      "kind": "Playbook",
                      "version": "[variables('playbookVersion3')]"
                    },
                    {
                      "contentId": "[variables('_PaloAlto-PAN-OS-GetURLCategoryInfo')]",
                      "kind": "Playbook",
                      "version": "[variables('playbookVersion4')]"
                    },
                    {
                      "contentId": "[variables('_PaloAlto-PAN-OS-BlockIP')]",
                      "kind": "Playbook",
                      "version": "[variables('playbookVersion5')]"
                    },
                    {
                      "contentId": "[variables('_PaloAlto-PAN-OS-BlockURL')]",
                      "kind": "Playbook",
                      "version": "[variables('playbookVersion6')]"
                    }
                  ],
                  "operator": "AND"
                },
                "firstPublishDate": "2021-08-09",
                "kind": "Solution",
                "lastPublishDate": "2021-09-20",
                "parentId": "[variables('_solutionId')]",
                "providers": [
                  "Palo Alto Networks"
                ],
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "2.0.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "PaloAlto-PAN-OS-BlockIP": "PaloAlto-PAN-OS-BlockIP",
            "PaloAlto-PAN-OS-BlockURL": "PaloAlto-PAN-OS-BlockURL",
            "PaloAlto-PAN-OS-GetSystemInfo": "PaloAlto-PAN-OS-GetSystemInfo",
            "PaloAlto-PAN-OS-GetThreatPCAP": "PaloAlto-PAN-OS-GetThreatPCAP",
            "PaloAlto-PAN-OS-GetURLCategoryInfo": "PaloAlto-PAN-OS-GetURLCategoryInfo",
            "PaloAltoCustomConnector": "PaloAltoCustomConnector",
            "_PaloAlto-PAN-OS-BlockIP": "[variables('PaloAlto-PAN-OS-BlockIP')]",
            "_PaloAlto-PAN-OS-BlockURL": "[variables('PaloAlto-PAN-OS-BlockURL')]",
            "_PaloAlto-PAN-OS-GetSystemInfo": "[variables('PaloAlto-PAN-OS-GetSystemInfo')]",
            "_PaloAlto-PAN-OS-GetThreatPCAP": "[variables('PaloAlto-PAN-OS-GetThreatPCAP')]",
            "_PaloAlto-PAN-OS-GetURLCategoryInfo": "[variables('PaloAlto-PAN-OS-GetURLCategoryInfo')]",
            "_PaloAltoCustomConnector": "[variables('PaloAltoCustomConnector')]",
            "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
            "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
            "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
            "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
            "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
            "_dataConnectorId1": "[variables('dataConnectorId1')]",
            "_email": "[variables('email')]",
            "_huntingQuerycontentId1": "[variables('huntingQuerycontentId1')]",
            "_playbookContentId1": "[variables('playbookContentId1')]",
            "_playbookContentId2": "[variables('playbookContentId2')]",
            "_playbookContentId3": "[variables('playbookContentId3')]",
            "_playbookContentId4": "[variables('playbookContentId4')]",
            "_playbookContentId5": "[variables('playbookContentId5')]",
            "_playbookContentId6": "[variables('playbookContentId6')]",
            "_solutionId": "[variables('solutionId')]",
            "_uiConfigId1": "[variables('uiConfigId1')]",
            "_workbookContentId1": "[variables('workbookContentId1')]",
            "_workbookContentId2": "[variables('workbookContentId2')]",
            "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
            "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
            "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
            "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
            "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1')))]",
            "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2')))]",
            "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3')))]",
            "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4')))]",
            "analyticRuleVersion1": "1.0.0",
            "analyticRuleVersion2": "1.3.0",
            "analyticRuleVersion3": "1.0.1",
            "analyticRuleVersion4": "1.0.1",
            "analyticRulecontentId1": "89a86f70-615f-4a79-9621-6f68c50f365f",
            "analyticRulecontentId2": "2be4ef67-a93f-4d8a-981a-88158cb73abd",
            "analyticRulecontentId3": "f0be259a-34ac-4946-aa15-ca2b115d5feb",
            "analyticRulecontentId4": "5b72f527-e3f6-4a00-9908-8e4fee14da9f",
            "blanks": "[replace('b', 'b', '')]",
            "dataConnectorContentId1": "PaloAltoNetworks",
            "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
            "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
            "dataConnectorVersion1": "1.0.0",
            "email": "support@microsoft.com",
            "huntingQueryId1": "[resourceId('Microsoft.OperationalInsights/savedSearches', variables('_huntingQuerycontentId1'))]",
            "huntingQueryTemplateSpecName1": "[concat(parameters('workspace'),'-hq-',uniquestring(variables('_huntingQuerycontentId1')))]",
            "huntingQueryVersion1": "1.0.0",
            "huntingQuerycontentId1": "0a57accf-3548-4e38-a861-99687c958f59",
            "playbookContentId1": "PaloAltoCustomConnector",
            "playbookContentId2": "PaloAlto-PAN-OS-GetSystemInfo",
            "playbookContentId3": "PaloAlto-PAN-OS-GetThreatPCAP",
            "playbookContentId4": "PaloAlto-PAN-OS-GetURLCategoryInfo",
            "playbookContentId5": "PaloAlto-PAN-OS-BlockIP",
            "playbookContentId6": "PaloAlto-PAN-OS-BlockURL",
            "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
            "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
            "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
            "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
            "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
            "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
            "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
            "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
            "playbookTemplateSpecName4": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4')))]",
            "playbookTemplateSpecName5": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5')))]",
            "playbookTemplateSpecName6": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6')))]",
            "playbookVersion1": "1.0",
            "playbookVersion2": "1.0",
            "playbookVersion3": "1.0",
            "playbookVersion4": "1.0",
            "playbookVersion5": "1.0",
            "playbookVersion6": "1.0",
            "solutionId": "azuresentinel.azure-sentinel-solution-paloaltopanos",
            "uiConfigId1": "PaloAltoNetworks",
            "workbookContentId1": "PaloAltoOverviewWorkbook",
            "workbookContentId2": "PaloAltoNetworkThreatWorkbook",
            "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
            "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
            "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
            "workbookTemplateSpecName2": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2')))]",
            "workbookVersion1": "1.2.0",
            "workbookVersion2": "1.1.0",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockIP Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to take necessary actions on IP address like Block IP/Unblock IP from predefined address group and also gives an option to close the incident.",
            "description": "This playbook allows blocking/unblocking IPs in PaloAlto, using **Address Object Groups**. This allows to make changes on predefined address group, which is attached to predefined security policy rule.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-07-22T00:00:00Z",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, IP address, list of existing security policy rules in which IP is a member of and provides an option to Block/Unblock IP Address to predefined address group or Ignore. \n\n 2. The SOC can take action on risky IP based on the information provided in the adaptive card. \n\n ![PaloAlto-PAN-OS-BlockIP](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/designerscreenshot.PNG?raw=true) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky IP for taking actions like block/unblock/ignore:** \n\n ![Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/AdaptiveCardtoBlockorUnblock.PNG?raw=true) \n\n **This is the consolidate adaptive card about the summary of actions taken on IP and the incident configuration:** \n\n ![Consolidated Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockIP/SummarizedAdaptiveCard.PNG?raw=true)"
            ],
            "postDeployment": [
              "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://docs.paloaltonetworks.com/pan-os/10-1/pan-os-panorama-api/get-started-with-the-pan-os-xml-api/get-your-api-key) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "PaloAlto-PAN-OS-BlockIP",
                "version": "1.0.0"
              }
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "title": "PaloAlto-PAN-OS-BlockIP"
          },
          "parameters": {
            "Address Group": {
              "defaultValue": "AddressGroup",
              "metadata": {
                "description": "Address Group"
              },
              "type": "String"
            },
            "CustomConnectorName": {
              "defaultValue": "PAN-OSRestApiCustomConnector",
              "type": "string"
            },
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-BlockIP",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              },
              "type": "String"
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "metadata": {
                "description": "Team ChannelId"
              },
              "type": "String"
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "metadata": {
                "description": "GroupId of the Team channel"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('PaloAltoConnectorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('TeamsConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-3')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Compose_product_name": {
                      "description": "compose to select the incident alert product name",
                      "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                      "runAfter": {
                        "Select_alert_product_names": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('IPAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "type": "ApiConnection"
                        },
                        "Update_incident": {
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          },
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "description": "This decides the action taken on the summarized adaptive card",
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "Entities_-_Get_IPs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "type": "ApiConnection"
                    },
                    "For_each_malicious_IP": {
                      "actions": {
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Condition__to_check_if_user_chosen_Block_IP": {
                              "actions": {
                                "Create_an_address_object": {
                                  "description": "This creates a new address object for the malicious IP",
                                  "inputs": {
                                    "body": {
                                      "entry": {
                                        "@@name": "@items('For_each_malicious_IP')?['Address']",
                                        "description": "@items('For_each_malicious_IP')?['Address']",
                                        "ip-netmask": "@items('For_each_malicious_IP')?['Address']"
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/restapi/v10.0/Objects/Addresses",
                                    "queries": {
                                      "address type": "ip-netmask",
                                      "location": "vsys",
                                      "name": "@items('For_each_malicious_IP')?['Address']",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "description": "This check if user chooses Block IP",
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_to_check_the_edit_an_address_object_group_status": {
                              "actions": {
                                "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                  "actions": {
                                    "Append_success_status_Blocked_IP_status_to_summary_card": {
                                      "description": "append action taken to summarize on the adaptive card",
                                      "inputs": {
                                        "name": "IPAddressAction",
                                        "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                      },
                                      "type": "AppendToArrayVariable"
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_success_status_UnBlocked_IP_status_to_summary_card": {
                                        "description": "append action taken to summarize on the adaptive card",
                                        "inputs": {
                                          "name": "IPAddressAction",
                                          "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  UnBlocked  by      \n                                  removing from @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                          "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "else": {
                                "actions": {
                                  "Append_failure_status_to_summary_card": {
                                    "description": "append action taken to summarize on the adaptive card",
                                    "inputs": {
                                      "name": "IPAddressAction",
                                      "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status         :  Failure"
                                    },
                                    "type": "AppendToArrayVariable"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Update_an_address_object_group')?['@status']",
                                      "success"
                                    ]
                                  }
                                ]
                              },
                              "runAfter": {
                                "Update_an_address_object_group": [
                                  "Succeeded"
                                ]
                              },
                              "type": "If"
                            },
                            "Update_an_address_object_group": {
                              "inputs": {
                                "body": {
                                  "entry": {
                                    "@@name": "[parameters('Address Group')]",
                                    "static": {
                                      "member": "@variables('AddressGroupMembers')"
                                    }
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/restapi/v10.0/Objects/AddressGroups",
                                "queries": {
                                  "location": "vsys",
                                  "name": "[parameters('Address Group')]",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "Condition__to_check_if_user_chosen_Block_IP": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "description": "condition to check the submit action is block / unblock or Ignore",
                          "else": {
                            "actions": {
                              "Append_to_array_variable_Ip_address_action_chosen": {
                                "description": "This appends the action taken on IP to the list of existing actions",
                                "inputs": {
                                  "name": "IPAddressAction",
                                  "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                },
                                "type": "AppendToArrayVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_Ip_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_address_group_text": {
                                  "description": "append address group text to adaptive card dynamically",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": {
                                      "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "type": "AppendToArrayVariable"
                                },
                                "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": {
                                  "description": "This filters the IP address from predefined address group to unreference/unblock IP",
                                  "inputs": {
                                    "from": "@variables('AddressGroupMembers')",
                                    "where": "@not(equals(item(), items('For_each_malicious_IP')?['Address']))"
                                  },
                                  "runAfter": {
                                    "Set_dynamic_action_name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "Set_dynamic_action_name": {
                                  "description": "variable to set action name dynamically",
                                  "inputs": {
                                    "name": "ActionName",
                                    "value": "UnBlock IP"
                                  },
                                  "runAfter": {
                                    "Append_address_group_text": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                },
                                "unreference_IP_address_from_the_existing_group_members": {
                                  "description": "unreference IP address from the group members and update",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('Filter_array_IP_address_from_the_list_of_address_objects_to_unreference')"
                                  },
                                  "runAfter": {
                                    "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                }
                              },
                              "description": "condition to check the malicious IP address is present in the predefined address group and the IP is part of static member",
                              "else": {
                                "actions": {
                                  "Append_IP_address_to_the_address_group_members": {
                                    "description": "append IP address to the address group members",
                                    "inputs": {
                                      "name": "AddressGroupMembers",
                                      "value": "@items('For_each_malicious_IP')?['Address']"
                                    },
                                    "runAfter": {
                                      "Append_address_group_text_to_adaptive_card_body": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToArrayVariable"
                                  },
                                  "Append_address_group_text_to_adaptive_card_body": {
                                    "description": "append address group text to adaptive card dynamically",
                                    "inputs": {
                                      "name": "AdaptiveCardBody",
                                      "value": {
                                        "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "type": "AppendToArrayVariable"
                                  },
                                  "Set_dynamic_action_name_to_variable_Action_name": {
                                    "description": "set action name dynamically",
                                    "inputs": {
                                      "name": "ActionName",
                                      "value": "Block IP"
                                    },
                                    "runAfter": {
                                      "Append_IP_address_to_the_address_group_members": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('AddressGroupMembers')",
                                      "@items('For_each_malicious_IP')?['Address']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "description": "This checks if Ip is a member of any of the list of address objects",
                          "else": {
                            "actions": {
                              "Append_IP_to_array_of_address_group_members": {
                                "description": "append the Malicious IP address to the existing group members to block / unblock from the predefined address group",
                                "inputs": {
                                  "name": "AddressGroupMembers",
                                  "value": "@items('For_each_malicious_IP')?['Address']"
                                },
                                "runAfter": {
                                  "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": {
                                "description": "This appends the text to display If Ip is not a member of security policy rules",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Set_variable_to_Block_Ip": {
                                "description": "This sets the variable block IP",
                                "inputs": {
                                  "name": "ActionName",
                                  "value": "Block IP"
                                },
                                "runAfter": {
                                  "Append_IP_to_array_of_address_group_members": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": {
                          "actions": {
                            "Append_policy_text": {
                              "description": "dynamic policy text based on security policies",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "text": "It is also member of the following security policy rules",
                                  "type": "TextBlock"
                                }
                              },
                              "type": "AppendToArrayVariable"
                            },
                            "Append_security_policies": {
                              "description": "append security policies which the IP address is exist",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "columns": [
                                    {
                                      "items": "@body('Select_security_policy_rules')",
                                      "type": "Column"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              },
                              "runAfter": {
                                "Append_policy_text": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable"
                            }
                          },
                          "description": "condition to check if the IP address is present in the existing security policy rules to conditionally apply the policy text and security policy rules",
                          "else": {
                            "actions": {
                              "Append_policy_text_to_adaptive_card_body_variable": {
                                "description": "dynamic policy text based on security policies",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "It is not a member of any other Policy Rules",
                                    "type": "TextBlock"
                                  }
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Append_security_policies_to_adaptive_card_body_variable": {
                                "description": "append security policies which the IP address is exist",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {}
                                },
                                "runAfter": {
                                  "Append_policy_text_to_adaptive_card_body_variable": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Select_security_policy_rules'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Select_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Configured_address_group": {
                          "description": "compose predefined address group",
                          "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose"
                        },
                        "Filter_array_Ip_from_list_of_security_rules": {
                          "description": "This filters all the security rules in which this Ip is a member",
                          "inputs": {
                            "from": "@body('List_security_rules')?['result']?['entry']",
                            "where": "@contains(item()?['source']?['member'], items('For_each_malicious_IP')?['Address'])"
                          },
                          "runAfter": {
                            "Configured_address_group": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query"
                        },
                        "Filter_array_of_Ip_address_from_list_of_address_objects": {
                          "description": "This filters the list of address objects in which this Ip is a member ",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@equals(item()?['ip-netmask'], items('For_each_malicious_IP')?['Address'])"
                          },
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query"
                        },
                        "List_address_groups": {
                          "description": "This gets complete list of address object groups present in the PAN-OS",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/restapi/v10.0/Objects/AddressGroups",
                            "queries": {
                              "location": "vsys",
                              "name": "[parameters('Address Group')]",
                              "vsys": "vsys1"
                            }
                          },
                          "runAfter": {
                            "Filter_array_of_Ip_address_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "[parameters('Teams ChannelId')]"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "[parameters('Teams GroupId')]"
                            }
                          },
                          "runAfter": {
                            "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook"
                        },
                        "Select_security_policy_rules": {
                          "description": "prepare columns list to show the security policy rules in the adaptive card if IP address is present",
                          "inputs": {
                            "from": "@body('Filter_array_Ip_from_list_of_security_rules')",
                            "select": {
                              "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                              "type": "TextBlock",
                              "weight": "bolder"
                            }
                          },
                          "runAfter": {
                            "Filter_array_Ip_from_list_of_security_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "Select"
                        },
                        "Set_variable_adaptive_card_body": {
                          "description": "variable to hold adaptive card body",
                          "inputs": {
                            "name": "AdaptiveCardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious IP - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised IP @{items('For_each_malicious_IP')?['Address']} detected by the provider  :  @{outputs('Compose_product_name')}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": " @{triggerBody()?['object']?['properties']?['severity']} Incident @{triggerBody()?['object']?['properties']?['title']} ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in PAN-OS",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                              }
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_variable_address_group_members": {
                          "description": "assign list of address group members",
                          "inputs": {
                            "name": "AddressGroupMembers",
                            "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                          },
                          "runAfter": {
                            "List_address_groups": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "runAfter": {
                        "List_security_rules": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_IP_address_action": {
                      "description": "This holds the action taken on each IP ",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IPAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_action_name": {
                      "description": "variable to store action name to be displayed on adaptive card",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ActionName",
                            "type": "string"
                          }
                        ]
                      },
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "description": "variable to store adaptive card body json",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AdaptiveCardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_address_group_members": {
                      "description": "variable to store the list of address group members",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AddressGroupMembers",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "List_address_objects": {
                      "description": "This gets complete list of address object present in the PAN-OS",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "Compose_product_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "List_security_rules": {
                      "description": "This gets complete list of security policy rules present in the PAN-OS",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Policies/SecurityRules",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on IP's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n{\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[parameters('Teams ChannelId')]"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[parameters('Teams GroupId')]"
                        }
                      },
                      "runAfter": {
                        "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook"
                    },
                    "Select_alert_product_names": {
                      "description": "data operator to select the alert product name",
                      "inputs": {
                        "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                        "select": {
                          "text": "@item()"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_IP_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    },
                    "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": {
                      "description": "This is used to compose the list of actions taken by SOC on respective IP addresses",
                      "inputs": {
                        "from": "@variables('IPAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      },
                      "runAfter": {
                        "For_each_malicious_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[variables('TeamsConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-PaloAlto-PAN-OS-BlockIP",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAlto-PAN-OS-BlockIP",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "PaloAltoCustomConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/PaloAlto-PAN-OS-BlockIP",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[concat('teamsconnector-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "_connection-3": "[variables('connection-3')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-3": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "description": "When a new sentinel incident is created, this playbook gets triggered and performs the following actions:\n 1. Sends an adaptive card to the Teams channel where the analyst can choose an action to be taken.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-09-20T00:00:00Z",
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for other connections."
            ],
            "prerequisites": [
              "1. Prior to the deployment of this playbook, AbuseIPDB Connector needs to be deployed under the same subscription.",
              "2. Obtain AbuseIPDB API credentials.",
              "3. Obtain Teams group id and channel id."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "AbuseIPDB Report a IPs To AbuselPDB After Checking By User In MSTeams",
                "version": "1.0.0"
              }
            ],
            "title": " AbuseIPDB Report a IPs To AbuselPDB After Checking By User In MSTeams"
          },
          "parameters": {
            "MSTeamsChannelId": {
              "defaultValue": "<MSTeamsChannelId>",
              "metadata": {
                "description": "Value of the MSTeamsChannelId parameter in the AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams playbook. Id of the Teams Channel where the adaptive card will be posted."
              },
              "type": "String"
            },
            "MSTeamsGroupId": {
              "defaultValue": "<MSTeamsGroupId>",
              "metadata": {
                "description": "Value of the MSTeamsGroupId parameter in the AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams playbook. Id of the Teams Group where the adaptive card will be posted."
              },
              "type": "String"
            },
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              },
              "type": "string"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                },
                "displayName": "[variables('AzureSentinelConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('MSTeamsConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                },
                "displayName": "[variables('MSTeamsConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "kind": "V1",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AbuseIPDBConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-3')]"
                },
                "displayName": "[variables('AbuseIPDBConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Entities_-_Get_IPs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "type": "ApiConnection"
                    },
                    "For_each": {
                      "actions": {
                        "Condition": {
                          "actions": {
                            "REPORT_Endpoint": {
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/report",
                                "queries": {
                                  "categories": "@{body('Post_adaptive_card_and_wait_for_a_response')['data']['AbuseCategories']}",
                                  "comment": "@{body('Post_adaptive_card_and_wait_for_a_response')['data']['AbuseIPDBComment']}",
                                  "ip": "@items('For_each')?['Address']"
                                }
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')",
                                  "data"
                                ]
                              },
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')['data']",
                                  "AbuseCategories"
                                ]
                              },
                              {
                                "contains": [
                                  "@body('Post_adaptive_card_and_wait_for_a_response')['data']",
                                  "AbuseIPDBComment"
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Post_adaptive_card_and_wait_for_a_response": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Get_Adaptive_Card_Body": {
                          "inputs": {
                            "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                            "actions": [
                              {
                                "id": "btnSubmit",
                                "title": "Submit",
                                "type": "Action.Submit"
                              },
                              {
                                "id": "btnIgnore",
                                "title": "Ignore",
                                "type": "Action.Submit"
                              }
                            ],
                            "body": [
                              {
                                "size": "large",
                                "text": "Microsoft Sentinel - Report IP to AbuseIPDB",
                                "type": "TextBlock",
                                "weight": "bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "For more details check the incident:",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "id": "PollQuestionAction",
                                "text": "Select AbuseIPDB attack categories associated with this IP Address: @{items('For_each')?['Address']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "choices": [
                                  {
                                    "title": "DNS Compromise",
                                    "value": "1"
                                  },
                                  {
                                    "title": "DNS Poisoning",
                                    "value": "2"
                                  },
                                  {
                                    "title": "Fraud Orders",
                                    "value": "3"
                                  },
                                  {
                                    "title": "DDoS Attack",
                                    "value": "4"
                                  },
                                  {
                                    "title": "FTP Brute-Force",
                                    "value": "5"
                                  },
                                  {
                                    "title": "Ping of Death",
                                    "value": "6"
                                  },
                                  {
                                    "title": "Phishing",
                                    "value": "7"
                                  },
                                  {
                                    "title": "Fraud VoIP",
                                    "value": "8"
                                  },
                                  {
                                    "title": "Open Proxy",
                                    "value": "9"
                                  },
                                  {
                                    "title": "Web Spam",
                                    "value": "10"
                                  },
                                  {
                                    "title": "Email Spam",
                                    "value": "11"
                                  },
                                  {
                                    "title": "Blog Spam",
                                    "value": "12"
                                  },
                                  {
                                    "title": "VPN IP",
                                    "value": "13"
                                  },
                                  {
                                    "title": "Port Scan",
                                    "value": "14"
                                  },
                                  {
                                    "title": "Hacking",
                                    "value": "15"
                                  },
                                  {
                                    "title": "SQL Injection",
                                    "value": "16"
                                  },
                                  {
                                    "title": "Spoofing",
                                    "value": "17"
                                  },
                                  {
                                    "title": "Brute-Force",
                                    "value": "18"
                                  },
                                  {
                                    "title": "Bad Web Bot",
                                    "value": "19"
                                  },
                                  {
                                    "title": "Exploited Host",
                                    "value": "20"
                                  },
                                  {
                                    "title": "Web App Attack",
                                    "value": "21"
                                  },
                                  {
                                    "title": "SSH",
                                    "value": "22"
                                  },
                                  {
                                    "title": "IoT Targeted",
                                    "value": "23"
                                  }
                                ],
                                "id": "AbuseCategories",
                                "isMultiSelect": true,
                                "placeholder": "Attack categories",
                                "style": "compact",
                                "type": "Input.ChoiceSet"
                              },
                              {
                                "text": "Please add comment with relative information:",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "id": "AbuseIPDBComment",
                                "placeholder": "{AbuseIPDBComment}",
                                "type": "Input.Text"
                              }
                            ],
                            "type": "AdaptiveCard",
                            "version": "1.0"
                          },
                          "type": "Compose"
                        },
                        "Post_adaptive_card_and_wait_for_a_response": {
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "@{outputs('Get_Adaptive_Card_Body')}",
                                "recipient": {
                                  "channelId": "@variables('TeamsChannelId')",
                                  "groupId": "@variables('TeamsGroupId')"
                                },
                                "updateMessage": "Thanks for your response!"
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/v1.0/teams/conversation/gatherinput/poster/Flow bot/location/@{encodeURIComponent('Channel')}/$subscriptions"
                          },
                          "runAfter": {
                            "Get_Adaptive_Card_Body": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "runAfter": {
                        "Initialize_TeamsChannelId": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Get_Logo": {
                      "inputs": "<img src=\"https://www.abuseipdb.com/img/abuseipdb.png.pagespeed.ce.CI8T6WsXU7.png\"  width=\"152\" height=\"32\"> ",
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Initialize_TeamsChannelId": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "TeamsChannelId",
                            "type": "string",
                            "value": "[parameters('MSTeamsChannelId')]"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_TeamsGroupId": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_TeamsGroupId": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "TeamsGroupId",
                            "type": "string",
                            "value": "[parameters('MSTeamsGroupId')]"
                          }
                        ]
                      },
                      "runAfter": {
                        "Get_Logo": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "AbuseIPDBAPI": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "connectionName": "[variables('AbuseIPDBConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "id": "[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('MSTeamsConnectionName'))]",
                        "connectionName": "[variables('MSTeamsConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "AbuseIPDBAPIConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/AbuseIPDB-ReportaIPsToAbuselPDBAfterCheckingByUserInMSTeams",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "azuresentinel.azure-sentinel-solution-abuseipdb"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AbuseIPDBConnectionName": "[concat('abuseipdb-connection-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "MSTeamsConnectionName": "[concat('msteams-connection-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "_connection-3": "[variables('connection-3')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "connection-3": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAltoCustomConnector Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "comments": "This PaloAlto custom connector uses PAN-OS API to perform different actions on the PAN-OS VM",
            "lastUpdateTime": "2022-08-29T14:44:14.274Z",
            "releaseNotes": {
              "notes": [
                "Initial version"
              ],
              "title": "",
              "version": "1.0"
            }
          },
          "parameters": {
            "PaloAlto_PAN-OS_Rest_API_CustomConnector_Name": {
              "defaultValue": "PAN-OSRestApiCustomConnector",
              "metadata": {
                "description": "Name of the PaloAlto REST API Connector"
              },
              "type": "String"
            },
            "PaloAlto_PAN-OS_XML_API_CustomConnector_Name": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "metadata": {
                "description": "Name of the PaloAlto XML API Connector"
              },
              "type": "String"
            },
            "Service_EndPoint": {
              "defaultValue": "https://{yourPaloAltoDomain}",
              "metadata": {
                "description": "enter the PaloAlto endpoint (ex: https://{yourPaloAltoDomain})"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
              "properties": {
                "backendService": {
                  "serviceUrl": "[parameters('Service_EndPoint')]"
                },
                "brandColor": "#FFFFFF",
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "constraints": {
                        "clearText": false,
                        "required": "true",
                        "tabIndex": 2
                      },
                      "description": "The API Key for this api",
                      "displayName": "API Key",
                      "tooltip": "Provide your API Key"
                    }
                  }
                },
                "description": "This is the PaloAlto Custom Connector",
                "displayName": "[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                "swagger": {
                  "basePath": "/",
                  "host": "$substring([parameters('Service EndPoint')],8 )",
                  "info": {
                    "description": "",
                    "title": "Default title",
                    "version": "1.0"
                  },
                  "paths": {
                    "/restapi/v10.0/Objects/AddressGroups": {
                      "get": {
                        "description": "List address groups",
                        "operationId": "[variables('_operationId-Listaddressgroups')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "filter by address group name",
                            "in": "query",
                            "name": "name",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "name"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "properties": {
                                    "@count": {
                                      "description": "count of address object groups present in PAN-OS VM",
                                      "title": "@count",
                                      "type": "string"
                                    },
                                    "@total-count": {
                                      "description": "total count of address object groups present in PAN-OS VM",
                                      "title": "@total-count",
                                      "type": "string"
                                    },
                                    "entry": {
                                      "description": "entry",
                                      "items": {
                                        "properties": {
                                          "@location": {
                                            "description": "location of address object group",
                                            "title": "@location",
                                            "type": "string"
                                          },
                                          "@name": {
                                            "description": "Enter the name of address object group",
                                            "title": "@name",
                                            "type": "string"
                                          },
                                          "@vsys": {
                                            "description": "vys location name of address object group",
                                            "title": "@vsys",
                                            "type": "string"
                                          },
                                          "static": {
                                            "description": "static",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "List address groups",
                        "x-ms-visibility": "important"
                      },
                      "post": {
                        "description": "Creates an address object group",
                        "operationId": "[variables('_operationId-Createaddressobjectgroup')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of security policy rule",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of address object group",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "static": {
                                      "description": "static",
                                      "properties": {
                                        "member": {
                                          "description": "Enter the whole array of members i.e existing and also new ones",
                                          "title": "member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "static"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "statuscode",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "status message",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Create an address object group",
                        "x-ms-visibility": "important"
                      },
                      "put": {
                        "description": "Update the address object group",
                        "operationId": "[variables('_operationId-Updateanaddressobjectgroup')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of the address object group",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of address object group",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "static": {
                                      "description": "static",
                                      "properties": {
                                        "member": {
                                          "description": "Enter the whole array of members i.e existing and also new ones",
                                          "title": "member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "static"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "statuscode",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "status message",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Update an address object group",
                        "x-ms-visibility": "important"
                      }
                    },
                    "/restapi/v10.0/Objects/Addresses": {
                      "get": {
                        "description": "List address objects",
                        "operationId": "[variables('_operationId-Listaddressobjects')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "filter by address object name",
                            "in": "query",
                            "name": "name",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "name"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "properties": {
                                    "@count": {
                                      "description": "count of address objects present in PAN-OS",
                                      "title": "@count",
                                      "type": "string"
                                    },
                                    "@total-count": {
                                      "description": "total count of address objects present in PAN-OS VM",
                                      "title": "@total-count",
                                      "type": "string"
                                    },
                                    "entry": {
                                      "description": "entry",
                                      "items": {
                                        "properties": {
                                          "@location": {
                                            "description": "location of PAN-OS VM. default value is vsys",
                                            "title": "@location",
                                            "type": "string"
                                          },
                                          "@name": {
                                            "description": "Enter the name of the address object",
                                            "title": "@name",
                                            "type": "string"
                                          },
                                          "@vsys": {
                                            "description": "vsys location name of address object. default value is vsys1",
                                            "title": "@vsys",
                                            "type": "string"
                                          },
                                          "description": {
                                            "description": "description of address object",
                                            "title": "description",
                                            "type": "string"
                                          },
                                          "fqdn": {
                                            "description": "URL address of address object",
                                            "title": "fqdn",
                                            "type": "string"
                                          },
                                          "ip-netmask": {
                                            "description": "Ip address of address object",
                                            "title": "ip-netmask",
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "List address objects",
                        "x-ms-visibility": "important"
                      },
                      "post": {
                        "description": "creates address object",
                        "operationId": "[variables('_operationId-Createanaddressobject')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of address object",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "enum": [
                              "ip-netmask",
                              "fqdn"
                            ],
                            "in": "query",
                            "name": "address type",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of address object",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "description": {
                                      "description": "Enter the description",
                                      "title": "description",
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "description": "Enter the URL ex:url.com",
                                      "title": "fqdn",
                                      "type": "string",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "ip-netmask": {
                                      "description": "Enter the IP address ex:1.1.1.1",
                                      "title": "ip-netmask",
                                      "type": "string",
                                      "x-ms-visibility": "advanced"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "description"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "success or failure msg",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Create an address object",
                        "x-ms-visibility": "important"
                      },
                      "put": {
                        "description": "Updates an address objects parameters.",
                        "operationId": "[variables('_operationId-Updateaddressobject')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of address object",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string",
                            "x-ms-summary": "name"
                          },
                          {
                            "enum": [
                              "ip-netmask",
                              "fqdn"
                            ],
                            "in": "query",
                            "name": "address type",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of address object",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "description": {
                                      "description": "Enter the description",
                                      "title": "description",
                                      "type": "string"
                                    },
                                    "fqdn": {
                                      "description": "Enter the URL for ex:url.com",
                                      "title": "fqdn",
                                      "type": "string",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "ip-netmask": {
                                      "description": "Enter the IP address for ex: 1.1.1.1",
                                      "title": "ip-netmask",
                                      "type": "string",
                                      "x-ms-visibility": "advanced"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "description"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "status message",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Update an address object",
                        "x-ms-visibility": "important"
                      }
                    },
                    "/restapi/v10.0/Objects/CustomURLCategories": {
                      "get": {
                        "description": "List custom url categories",
                        "operationId": "[variables('_operationId-Listcustomurlcategories')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "filter by custom url category name",
                            "in": "query",
                            "name": "name",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "name"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "properties": {
                                    "@count": {
                                      "description": "count of the list of URL filtering category info",
                                      "title": "@count",
                                      "type": "string"
                                    },
                                    "@total-count": {
                                      "description": "total count of URL filtering category info present in PAN-OS",
                                      "title": "@total-count",
                                      "type": "string"
                                    },
                                    "entry": {
                                      "description": "entry",
                                      "items": {
                                        "properties": {
                                          "@location": {
                                            "description": "location of the URL filtering category info. default value is vsys",
                                            "title": "@location",
                                            "type": "string"
                                          },
                                          "@name": {
                                            "description": "name of URL filtering category information",
                                            "title": "@name",
                                            "type": "string"
                                          },
                                          "@vsys": {
                                            "description": "vsys location name of URL filtering category info. default value is vsys1",
                                            "title": "@vsys",
                                            "type": "string"
                                          },
                                          "description": {
                                            "description": "description of URL filtering category information",
                                            "title": "description",
                                            "type": "string"
                                          },
                                          "list": {
                                            "description": "list",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "type": {
                                            "description": "type of URL filtering category info",
                                            "title": "type",
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "List custom url categories",
                        "x-ms-visibility": "important"
                      }
                    },
                    "/restapi/v10.0/Objects/URLFilteringSecurityProfiles": {
                      "get": {
                        "description": "List url filtering security profiles",
                        "operationId": "[variables('_operationId-Listurlfilteringsecurityprofiles')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "filter by name of URL filtering security profile",
                            "in": "query",
                            "name": "name",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "name"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "properties": {
                                    "@count": {
                                      "description": "count of url filtering security profile information",
                                      "title": "@count",
                                      "type": "string"
                                    },
                                    "@total-count": {
                                      "description": "total count of url filtering security profile information",
                                      "title": "@total-count",
                                      "type": "string"
                                    },
                                    "entry": {
                                      "description": "entry",
                                      "items": {
                                        "properties": {
                                          "@location": {
                                            "description": "location of URL filtering security profile",
                                            "title": "@location",
                                            "type": "string"
                                          },
                                          "@name": {
                                            "description": "Enter the name of URL filtering category security profile",
                                            "title": "@name",
                                            "type": "string"
                                          },
                                          "@vsys": {
                                            "description": "@vsys",
                                            "type": "string"
                                          },
                                          "credential-enforcement": {
                                            "description": "credential-enforcement",
                                            "properties": {
                                              "log-severity": {
                                                "description": "log-severity of filtering security category info",
                                                "title": "log-severity",
                                                "type": "string"
                                              },
                                              "mode": {
                                                "description": "mode",
                                                "properties": {
                                                  "disabled": {
                                                    "description": "disabled",
                                                    "type": "object"
                                                  }
                                                },
                                                "type": "object"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "description": {
                                            "description": "description of url filtering security info",
                                            "title": "description",
                                            "type": "string"
                                          },
                                          "log-http-hdr-user-agent": {
                                            "description": "log-http-hdr-user-agent",
                                            "title": "log-http-hdr-user-agent",
                                            "type": "string"
                                          },
                                          "mlav-engine-urlbased-enabled": {
                                            "description": "mlav-engine-urlbased-enabled",
                                            "properties": {
                                              "entry": {
                                                "description": "entry",
                                                "items": {
                                                  "properties": {
                                                    "@name": {
                                                      "description": "Enter the name of URL filtering category security profile",
                                                      "type": "string"
                                                    },
                                                    "mlav-policy-action": {
                                                      "description": "mlav-policy-action",
                                                      "type": "string"
                                                    }
                                                  },
                                                  "type": "object"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "List url filtering security profiles",
                        "x-ms-visibility": "important"
                      },
                      "put": {
                        "description": "Update an url filtering security profile",
                        "operationId": "[variables('_operationId-Updateanurlfilteringsecurityprofile')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of URL filtering category security profile",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of URL filtering category security profile",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "alert": {
                                      "description": "alert",
                                      "properties": {
                                        "member": {
                                          "description": "Categories to alert on, Array of strings",
                                          "title": "alert member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "allow": {
                                      "description": "allow",
                                      "properties": {
                                        "member": {
                                          "description": "categories to allow, Array of strings",
                                          "title": "allow member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "block": {
                                      "description": "block",
                                      "properties": {
                                        "member": {
                                          "description": "Categories to block, Array of strings",
                                          "title": "block member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "continue": {
                                      "description": "continue",
                                      "properties": {
                                        "member": {
                                          "description": "Categories to continue, Array of strings",
                                          "title": "continue member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "credential-enforcement": {
                                      "description": "credential-enforcement",
                                      "properties": {
                                        "alert": {
                                          "description": "alert",
                                          "properties": {
                                            "member": {
                                              "description": "Categories to alert on credential match",
                                              "title": "credential-enforcement alert member",
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "allow": {
                                          "description": "allow",
                                          "properties": {
                                            "member": {
                                              "description": "Categories to allow and bypass credential enforcement",
                                              "title": "credential-enforcement allow member",
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "block": {
                                          "description": "block",
                                          "properties": {
                                            "member": {
                                              "description": "Categories to block on credential matchmember",
                                              "title": "credential-enforcement allow member",
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "continue": {
                                          "description": "continue",
                                          "properties": {
                                            "member": {
                                              "description": "Categories to block/continue on credential match",
                                              "title": "credential-enforcement continue member",
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "log-severity": {
                                          "default": "any",
                                          "description": "Log severity when credential matched",
                                          "title": "credential-enforcement log severity",
                                          "type": "string"
                                        },
                                        "mode": {
                                          "description": "mode",
                                          "properties": {
                                            "disabled": {
                                              "description": "disabled (object) or ip-user (object) or domain-credentials (object) or group-mapping (object)",
                                              "type": "object"
                                            }
                                          },
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "mode",
                                        "log-severity"
                                      ],
                                      "type": "object"
                                    },
                                    "description": {
                                      "description": "Enter the description",
                                      "title": "description",
                                      "type": "string"
                                    },
                                    "enable-container-page": {
                                      "default": true,
                                      "description": "Enter the enable-container-page",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "enable-container-page",
                                      "type": "string"
                                    },
                                    "http-header-insertion": {
                                      "description": "http-header-insertion",
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the http-header-insertion entry name",
                                              "title": "http-header-insertion entry name",
                                              "type": "string"
                                            },
                                            "type": {
                                              "description": "type",
                                              "properties": {
                                                "entry": {
                                                  "description": "entry",
                                                  "properties": {
                                                    "@name": {
                                                      "description": "Enter the http-header-insertion type entry name",
                                                      "title": "http-header-insertion type entry name",
                                                      "type": "string"
                                                    },
                                                    "domains": {
                                                      "description": "domains",
                                                      "properties": {
                                                        "member": {
                                                          "description": "Enter the http-header-insertion entry type entry domains member",
                                                          "title": "http-header-insertion entry type entry domains member",
                                                          "type": "string"
                                                        }
                                                      },
                                                      "required": [
                                                        "member"
                                                      ],
                                                      "type": "object"
                                                    },
                                                    "headers": {
                                                      "description": "headers",
                                                      "properties": {
                                                        "entry": {
                                                          "description": "entry",
                                                          "properties": {
                                                            "@name": {
                                                              "description": "Enter the http-header-insertion entry type entry headers entry name",
                                                              "title": "http-header-insertion entry type entry headers entry name",
                                                              "type": "string"
                                                            },
                                                            "header": {
                                                              "description": "Enter the http-header-insertion entry type entry headers entry header",
                                                              "title": "http-header-insertion entry type entry headers entry header",
                                                              "type": "string"
                                                            },
                                                            "log": {
                                                              "default": false,
                                                              "description": "Enter the http-header-insertion entry type entry headers entry log",
                                                              "enum": [
                                                                true,
                                                                false
                                                              ],
                                                              "title": "http-header-insertion entry type entry headers entry log",
                                                              "type": "string"
                                                            },
                                                            "value": {
                                                              "description": "Enter the http-header-insertion entry type entry headers entry value",
                                                              "title": "http-header-insertion entry type entry headers entry value",
                                                              "type": "string"
                                                            }
                                                          },
                                                          "required": [
                                                            "name",
                                                            "header",
                                                            "value",
                                                            "log"
                                                          ],
                                                          "type": "object"
                                                        }
                                                      },
                                                      "required": [
                                                        "entry"
                                                      ],
                                                      "type": "object"
                                                    }
                                                  },
                                                  "type": "object"
                                                }
                                              },
                                              "required": [
                                                "entry"
                                              ],
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "type",
                                            "domains"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    },
                                    "log-container-page-only": {
                                      "default": true,
                                      "description": "Log container page only",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "log-container-page-only",
                                      "type": "string"
                                    },
                                    "log-http-hdr-referer": {
                                      "description": "Log HTTP Header Referer field",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "log-http-hdr-referer",
                                      "type": "string"
                                    },
                                    "log-http-hdr-user-agent": {
                                      "default": false,
                                      "description": "Log HTTP Header User-Agent field",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "log-http-hdr-user-agent",
                                      "type": "string"
                                    },
                                    "log-http-hdr-xff": {
                                      "description": "Log HTTP Header X-Forwarded-For field",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "log-http-hdr-xff",
                                      "type": "string"
                                    },
                                    "mlav-category-exception": {
                                      "description": "mlav-category-exception",
                                      "properties": {
                                        "member": {
                                          "description": "Enter the mlav-category-exception member",
                                          "title": "mlav-category-exception member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "mlav-engine-urlbased-enabled": {
                                      "description": "mlav-engine-urlbased-enabled",
                                      "properties": {
                                        "entry": {
                                          "description": "entry",
                                          "properties": {
                                            "@name": {
                                              "description": "Enter the mlav-engine-urlbased-enabled entry name",
                                              "title": "mlav-engine-urlbased-enabled entry name",
                                              "type": "string"
                                            },
                                            "mlav-policy-action": {
                                              "description": "Enter the mlav-engine-urlbased-enabled mlav-policy-action",
                                              "enum": [
                                                "block",
                                                "alert",
                                                "allow"
                                              ],
                                              "title": "mlav-engine-urlbased-enabled mlav-policy-action",
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "@name",
                                            "mlav-policy-action"
                                          ],
                                          "type": "object"
                                        }
                                      },
                                      "required": [
                                        "entry"
                                      ],
                                      "type": "object"
                                    },
                                    "override": {
                                      "description": "override",
                                      "properties": {
                                        "member": {
                                          "description": "Categories to admin override, Array of strings",
                                          "title": "override member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "safe-search-enforcement": {
                                      "default": false,
                                      "description": "Safe-Search will be enforced if it is set",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "title": "safe-search-enforcement",
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "allow",
                                    "alert",
                                    "continue",
                                    "block",
                                    "credential-enforcement",
                                    "description",
                                    "enable-container-page",
                                    "http-header-insertion",
                                    "log-container-page-only",
                                    "log-http-hdr-user-agent",
                                    "mlav-category-exception",
                                    "mlav-engine-urlbased-enabled",
                                    "override",
                                    "safe-search-enforcement",
                                    "log-http-hdr-xff",
                                    "log-http-hdr-referer"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "status msg",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Update an url filtering security profile",
                        "x-ms-visibility": "important"
                      }
                    },
                    "/restapi/v10.0/Policies/SecurityRules": {
                      "get": {
                        "description": "List of all the security rules",
                        "operationId": "[variables('_operationId-Listsecurityrules')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "filter the security rule by name",
                            "in": "query",
                            "name": "name",
                            "required": false,
                            "type": "string",
                            "x-ms-summary": "name"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "defines the status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "defines the status",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "properties": {
                                    "@count": {
                                      "description": "the count of security policy rules in PAN-OS VM",
                                      "title": "@count",
                                      "type": "string"
                                    },
                                    "@total-count": {
                                      "description": "the total count of security policy rules in PAN-OS VM",
                                      "title": "@total-count",
                                      "type": "string"
                                    },
                                    "entry": {
                                      "description": "entry",
                                      "items": {
                                        "properties": {
                                          "@location": {
                                            "description": "the location where the security policy rule is being located at. default value is \"vsys\"",
                                            "title": "@location",
                                            "type": "string"
                                          },
                                          "@name": {
                                            "description": "the name of the security policy rule",
                                            "title": "@name",
                                            "type": "string"
                                          },
                                          "@uuid": {
                                            "description": "the unique id of the security policy rule",
                                            "title": "@uuid",
                                            "type": "string"
                                          },
                                          "@vsys": {
                                            "description": "the vsys name of the location. default value is \"vsys1\"",
                                            "title": "@vsys",
                                            "type": "string"
                                          },
                                          "action": {
                                            "description": "action allowed on security policy rule.",
                                            "title": "action",
                                            "type": "string"
                                          },
                                          "application": {
                                            "description": "application",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "category": {
                                            "description": "category",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "destination": {
                                            "description": "destination",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "destination-hip": {
                                            "description": "destination-hip",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "from": {
                                            "description": "from",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "hip-profiles": {
                                            "description": "hip-profiles",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "service": {
                                            "description": "service",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "source": {
                                            "description": "source",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "source-hip": {
                                            "description": "source-hip",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "source-user": {
                                            "description": "source-user",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "to": {
                                            "description": "to",
                                            "properties": {
                                              "member": {
                                                "description": "member",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "List security rules",
                        "x-ms-visibility": "important"
                      },
                      "post": {
                        "description": "Creates a new policy rule",
                        "operationId": "[variables('_operationId-Createsecuritypolicyrule')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of security policy rule",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of security policy rule",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "action": {
                                      "default": "allow",
                                      "description": "enter the action ex: allow",
                                      "enum": [
                                        "deny",
                                        "allow",
                                        "drop",
                                        "reset-client",
                                        "reset-server",
                                        "reset-both"
                                      ],
                                      "title": "action",
                                      "type": "string"
                                    },
                                    "application": {
                                      "description": "application",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the application member, Array of strings",
                                          "title": "application member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "category": {
                                      "description": "category",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the category member, Array of strings",
                                          "title": "category member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "destination": {
                                      "description": "destination",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                          "title": "destination member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "from": {
                                      "description": "from",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the from member,Array of strings",
                                          "title": "from member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "hip-profiles": {
                                      "description": "hip-profiles",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the hip-profiles member, Array of strings",
                                          "title": "hip-profiles member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "service": {
                                      "description": "service",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the service member, Array of strings",
                                          "title": "service member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "source": {
                                      "description": "source",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                          "title": "source member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "source-user": {
                                      "description": "source-user",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source-user member, Array of strings",
                                          "title": "source-user member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "to": {
                                      "description": "to",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the to member, Array of strings",
                                          "title": "to member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "action",
                                    "application",
                                    "category",
                                    "destination",
                                    "from",
                                    "hip-profiles",
                                    "service",
                                    "source",
                                    "to"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "statuscode",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "status message",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Create a security policy rule",
                        "x-ms-visibility": "important"
                      },
                      "put": {
                        "description": "update address object to existing Security Policy Rule",
                        "operationId": "[variables('_operationId-Updatesecuritypolicyrule')]",
                        "parameters": [
                          {
                            "default": "vsys",
                            "description": "Enter the location",
                            "in": "query",
                            "name": "location",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "vsys1",
                            "description": "Enter the vsys location name",
                            "in": "query",
                            "name": "vsys",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Enter the name of security policy rule",
                            "in": "query",
                            "name": "name",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "in": "body",
                            "name": "body",
                            "required": true,
                            "schema": {
                              "properties": {
                                "entry": {
                                  "description": "entry",
                                  "properties": {
                                    "@name": {
                                      "description": "Enter the name of security policy rule",
                                      "title": "name",
                                      "type": "string"
                                    },
                                    "action": {
                                      "default": "allow",
                                      "description": "enter the action ex: allow",
                                      "enum": [
                                        "deny",
                                        "allow",
                                        "drop",
                                        "reset-client",
                                        "reset-server",
                                        "reset-both"
                                      ],
                                      "title": "action",
                                      "type": "string"
                                    },
                                    "application": {
                                      "description": "application",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the application member, Array of strings",
                                          "title": "application member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "category": {
                                      "description": "category",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the category member, Array of strings",
                                          "title": "category member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "destination": {
                                      "description": "destination",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                          "title": "destination member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "from": {
                                      "description": "from",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the from member,Array of strings",
                                          "title": "from member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "hip-profiles": {
                                      "description": "hip-profiles",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the hip-profiles member, Array of strings",
                                          "title": "hip-profiles member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "service": {
                                      "description": "service",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the service member, Array of strings",
                                          "title": "service member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "source": {
                                      "description": "source",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                          "title": "source member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    },
                                    "source-user": {
                                      "description": "source-user",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the source-user member, Array of strings",
                                          "title": "source-user member",
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "to": {
                                      "description": "to",
                                      "properties": {
                                        "member": {
                                          "default": "any",
                                          "description": "Enter the to member, Array of strings",
                                          "title": "to member",
                                          "type": "string"
                                        }
                                      },
                                      "required": [
                                        "member"
                                      ],
                                      "type": "object"
                                    }
                                  },
                                  "required": [
                                    "@name",
                                    "action",
                                    "application",
                                    "category",
                                    "destination",
                                    "from",
                                    "hip-profiles",
                                    "service",
                                    "source",
                                    "to"
                                  ],
                                  "type": "object"
                                }
                              },
                              "required": [
                                "entry"
                              ],
                              "type": "object"
                            }
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "msg": {
                                  "description": "the status msg if success or failure",
                                  "title": "msg",
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Update security policy rule",
                        "x-ms-visibility": "important"
                      }
                    }
                  },
                  "schemes": [
                    "https"
                  ],
                  "security": [
                    {}
                  ],
                  "securityDefinitions": {
                    "API Key": {
                      "in": "header",
                      "name": "X-PAN-KEY",
                      "type": "apiKey"
                    }
                  },
                  "swagger": "2.0"
                }
              },
              "type": "Microsoft.Web/customApis"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
              "properties": {
                "backendService": {
                  "serviceUrl": "[parameters('Service_EndPoint')]"
                },
                "brandColor": "#FFFFFF",
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "constraints": {
                        "clearText": false,
                        "required": "true",
                        "tabIndex": 2
                      },
                      "description": "The API Key for this api",
                      "displayName": "API Key",
                      "tooltip": "Provide your API Key"
                    }
                  }
                },
                "description": "This is the PaloAlto Custom Connector",
                "displayName": "[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                "swagger": {
                  "basePath": "/",
                  "host": "$substring([parameters('Service EndPoint')],8 )",
                  "info": {
                    "description": "",
                    "title": "Default title",
                    "version": "1.0"
                  },
                  "paths": {
                    "/api": {
                      "get": {
                        "description": "Quert XML API for PCAPs and Device Info",
                        "operationId": "[variables('_operationId-Queryxmlapi')]",
                        "parameters": [
                          {
                            "in": "query",
                            "name": "type",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "default": "threat-pcap",
                            "in": "query",
                            "name": "category",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "in": "query",
                            "name": "pcap-id",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "in": "query",
                            "name": "search-time",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "in": "query",
                            "name": "sessionId",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "in": "query",
                            "name": "device_name",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "default": "<show><system><info></info></system></show>",
                            "in": "query",
                            "name": "cmd",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "properties": {
                                "@code": {
                                  "description": "status code",
                                  "title": "@code",
                                  "type": "string"
                                },
                                "@status": {
                                  "description": "status if success or failure",
                                  "title": "@status",
                                  "type": "string"
                                },
                                "result": {
                                  "description": "result",
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "summary": "Query Palo Alto XML API",
                        "x-ms-visibility": "important"
                      }
                    }
                  },
                  "responses": {
                    "default": {
                      "description": "default"
                    }
                  },
                  "schemes": [
                    "https"
                  ],
                  "security": [
                    {}
                  ],
                  "securityDefinitions": {
                    "API Key": {
                      "in": "query",
                      "name": "X-PAN-KEY",
                      "type": "apiKey"
                    }
                  },
                  "swagger": "2.0"
                }
              },
              "type": "Microsoft.Web/customApis"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAltoCustomConnector",
                "kind": "LogicAppsCustomConnector",
                "parentId": "[variables('playbookId')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "_operationId-Createaddressobjectgroup": "[variables('operationId-Createaddressobjectgroup')]",
            "_operationId-Createanaddressobject": "[variables('operationId-Createanaddressobject')]",
            "_operationId-Createsecuritypolicyrule": "[variables('operationId-Createsecuritypolicyrule')]",
            "_operationId-Listaddressgroups": "[variables('operationId-Listaddressgroups')]",
            "_operationId-Listaddressobjects": "[variables('operationId-Listaddressobjects')]",
            "_operationId-Listcustomurlcategories": "[variables('operationId-Listcustomurlcategories')]",
            "_operationId-Listsecurityrules": "[variables('operationId-Listsecurityrules')]",
            "_operationId-Listurlfilteringsecurityprofiles": "[variables('operationId-Listurlfilteringsecurityprofiles')]",
            "_operationId-Queryxmlapi": "[variables('operationId-Queryxmlapi')]",
            "_operationId-Updateaddressobject": "[variables('operationId-Updateaddressobject')]",
            "_operationId-Updateanaddressobjectgroup": "[variables('operationId-Updateanaddressobjectgroup')]",
            "_operationId-Updateanurlfilteringsecurityprofile": "[variables('operationId-Updateanurlfilteringsecurityprofile')]",
            "_operationId-Updatesecuritypolicyrule": "[variables('operationId-Updatesecuritypolicyrule')]",
            "operationId-Createaddressobjectgroup": "Createaddressobjectgroup",
            "operationId-Createanaddressobject": "Createanaddressobject",
            "operationId-Createsecuritypolicyrule": "Createsecuritypolicyrule",
            "operationId-Listaddressgroups": "Listaddressgroups",
            "operationId-Listaddressobjects": "Listaddressobjects",
            "operationId-Listcustomurlcategories": "Listcustomurlcategories",
            "operationId-Listsecurityrules": "Listsecurityrules",
            "operationId-Listurlfilteringsecurityprofiles": "Listurlfilteringsecurityprofiles",
            "operationId-Queryxmlapi": "Queryxmlapi",
            "operationId-Updateaddressobject": "Updateaddressobject",
            "operationId-Updateanaddressobjectgroup": "Updateanaddressobjectgroup",
            "operationId-Updateanurlfilteringsecurityprofile": "Updateanurlfilteringsecurityprofile",
            "operationId-Updatesecuritypolicyrule": "Updatesecuritypolicyrule",
            "playbookContentId": "PaloAltoCustomConnector",
            "playbookId": "[resourceId('Microsoft.Web/customApis', parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name'))]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAlto-PAN-OS-GetSystemInfo Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "description": "This playbook allows us to get System Info of a Palo Alto device for a Sentinel alert.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the System Info for the device in the alert. \n\n 3. Creates a Sentinel Incident and updates it with the system info."
            ],
            "postDeployment": [
              "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "Get System Info - Palo Alto PAN-OS XML API",
                "version": "1.0.0"
              }
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "title": "Get System Info - Palo Alto PAN-OS XML API"
          },
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "metadata": {
                "description": "Name of the custom connector which interacts with PAN-OS"
              },
              "type": "String"
            },
            "LogAnalyticsResourceGroup": {
              "metadata": {
                "description": "Name of the cLog Analytics Resource group for logging"
              },
              "type": "string"
            },
            "LogAnalyticsResourceName": {
              "metadata": {
                "description": "Name of the Log Analytics instance for logging"
              },
              "type": "string"
            },
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetSystemInfo",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "kind": "V1",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                },
                "displayName": "[parameters('PlaybookName')]",
                "parameterValueType": "Alternative"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('PaloAltoConnectorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureMonitorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-3')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "identity": {
                "type": "SystemAssigned"
              },
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "If_incident_is_a_Palo_Alto_incident": {
                          "actions": {
                            "Add_comment_to_incident_(V3)": {
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                  "message": "<p>@{body('Query_Palo_Alto_XML_API')}</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              },
                              "runAfter": {
                                "Query_Palo_Alto_XML_API": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            },
                            "Query_Palo_Alto_XML_API": {
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/api/",
                                "queries": {
                                  "cmd": "<show><system><info></info></system></show>",
                                  "device_name": "@{items('For_each')['MonitoringDeviceName']}",
                                  "type": "op"
                                }
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@items('For_each')['AlertSource']",
                                  "@string('PaloAlto')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "foreach": "@body('Run_query_and_list_results')?['value']",
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Run_query_and_list_results": {
                      "inputs": {
                        "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "[parameters('LogAnalyticsResourceGroup')]",
                          "resourcename": "[parameters('LogAnalyticsResourceName')]",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "[variables('subscriptionId')]",
                          "timerange": "Set in query"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/subscribe"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                        "connectionName": "azuremonitorlogs",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "azuresentinel",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        },
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "paloaltoconnector": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "paloaltoconnector",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-PaloAlto-PAN-OS-GetSystemInfo",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAlto-PAN-OS-GetSystemInfo",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "PaloAltoCustomConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/PaloAlto-PAN-OS-GetSystemInfo",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AzureMonitorConnectionName": "[concat('azuremonitor-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "_connection-3": "[variables('connection-3')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "connection-3": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "subscriptionId": "[subscription().subscriptionId]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAlto-PAN-OS-GetURLCategoryInfo Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to automatically enrich incidents generated by Sentinel for address object details and URL filtering category information from PAN-OS",
            "description": " When a new sentinal incident is created, this playbook gets triggered and performs below actions:",
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "mainSteps": [
              "1. Fetches the address group details and URL filtering category information from PAN-OS \n\n 2. Updates all the collected information in incident \n\n ![PaloAlto-PAN-OS-GetURLCategoryInfo](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-GetURLCategoryInfo/designerscreenshot.PNG?raw=true)"
            ],
            "postDeployment": [
              "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for PAN-OS API Connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky user account \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "prerequisites": [
              "1. PAN-OS Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation)"
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "PaloAlto-PAN-OS-GetURLCategoryInfo",
                "version": "1.0.0"
              }
            ],
            "title": "PaloAlto-PAN-OS-GetURLCategoryInfo"
          },
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "PAN-OSRestApiCustomConnector",
              "type": "string"
            },
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetURLCategoryInfo",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('PaloAltoConnectorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Entities_-_Get_URLs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      },
                      "type": "ApiConnection"
                    },
                    "For_each_malicious_URL": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><strong>PAN-OS Playbook has collected the following information : </strong><br>\n<br>\nGot List of address objects and also got URL filtering category Information:<br>\n<br>\n<strong>Details of address objects:</strong><br>\n<br>\n<strong>name</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@name']}<br>\n<strong>location </strong>: &nbsp;@{outputs('Compose_body_of_address_object')?['@location']}<br>\n<strong>vsys</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@vsys']}<br>\n<strong>description</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['description']}<br>\n<strong>fqdn</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['fqdn']}<br>\n<br>\n<strong>Details of URL filtering category information:<br>\n</strong><br>\n@{body('Create_HTML_table_for_URL_category_information')}<br>\n</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "runAfter": {
                            "Create_HTML_table_for_URL_category_information": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        },
                        "Compose_body_of_address_object": {
                          "description": "This composes the body of address object where URL is a member",
                          "inputs": "@body('Filter_URL_from_list_of_address_objects')?[0]",
                          "runAfter": {
                            "Filter_URL_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose"
                        },
                        "Create_HTML_table_for_URL_category_information": {
                          "description": "This creates HTML table for the URL filtering category information",
                          "inputs": {
                            "columns": [
                              {
                                "header": "name",
                                "value": "@item()?['@name']"
                              },
                              {
                                "header": "location",
                                "value": "@item()?['@location']"
                              },
                              {
                                "header": "vsys",
                                "value": "@item()?['@vsys']"
                              },
                              {
                                "header": "description",
                                "value": "@item()?['description']"
                              }
                            ],
                            "format": "HTML",
                            "from": "@body('List_custom_url_categories')?['result']?['entry']"
                          },
                          "runAfter": {
                            "Compose_body_of_address_object": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table"
                        },
                        "Filter_URL_from_list_of_address_objects": {
                          "description": "This filters the URL from the list of address objects",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@contains(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "type": "Query"
                        }
                      },
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "runAfter": {
                        "List_custom_url_categories": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "List_address_objects": {
                      "description": "This Lists all the address objects present in the PAN-OS",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "List_custom_url_categories": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/CustomURLCategories",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, parameters('CustomConnectorName'))]"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-PaloAlto-PAN-OS-GetURLCategoryInfo",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAlto-PAN-OS-GetURLCategoryInfo",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "PaloAltoCustomConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/PaloAlto-PAN-OS-GetURLCategoryInfo",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "AbuseIPDB-BlacklistIpToThreatIntelligence Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "description": "By every day reccurence, this playbook gets triggered and performs the following actions:\n 1. Gets [list](https://docs.abuseipdb.com/#blacklist-endpoint) of the most reported IP addresses form the Blacklist Endpoint.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-09-20T00:00:00Z",
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for tiIndicators connector API Connection."
            ],
            "preDeployment": [
              "1. AbuseIPDB Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "prerequisites": [
              "1. AbuseIPDBAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "AbuseIPDB Blacklist Ip To Threat Intelligence",
                "version": "1.0.0"
              }
            ],
            "title": "AbuseIPDB Blacklist Ip To Threat Intelligence"
          },
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-BlacklistIpToThreatIntelligence",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              },
              "type": "string"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AbuseIPDBConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                },
                "displayName": "[variables('AbuseIPDBConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "kind": "V1",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('ThreatIntelligenceConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                },
                "displayName": "[variables('ThreatIntelligenceConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('ThreatIntelligenceConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "BLACKLIST_Endpoint": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/blacklist",
                        "queries": {
                          "confidenceMinimum": 25,
                          "limit": 10000
                        }
                      },
                      "type": "ApiConnection"
                    },
                    "Initialize_Results_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Results_Array",
                            "type": "array",
                            "value": "@body('Select')"
                          }
                        ]
                      },
                      "runAfter": {
                        "Select": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_Temp_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Temp_Array",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_Working_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_Working_Array": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Working_array",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_Results_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Select": {
                      "inputs": {
                        "from": "@body('BLACKLIST_Endpoint')?['data']",
                        "select": {
                          "action": "alert",
                          "confidence": "@item()['abuseConfidenceScore']",
                          "description": "AbuseIPDB BLACKLIST Indicator ",
                          "expirationDateTime": "@addDays(utcNow(),7)",
                          "lastReportedDateTime": "@item()['lastReportedAt']",
                          "networkDestinationIPv4": "@item()['ipAddress']",
                          "targetProduct": "Microsoft Sentinel",
                          "threatType": "WatchList",
                          "tlpLevel": "unknown"
                        }
                      },
                      "runAfter": {
                        "BLACKLIST_Endpoint": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    },
                    "Until": {
                      "actions": {
                        "Remove_Items_From_Results_Array": {
                          "inputs": {
                            "name": "Results_Array",
                            "value": "@variables('Temp_Array')"
                          },
                          "runAfter": {
                            "Set_Temp_Array": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_Temp_Array": {
                          "inputs": {
                            "name": "Temp_Array",
                            "value": "@skip(variables('Results_Array'),100)"
                          },
                          "runAfter": {
                            "Submit_multiple_tiIndicators": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_Working_Array": {
                          "inputs": {
                            "name": "Working_array",
                            "value": "@take(variables('Results_Array'), 100)"
                          },
                          "type": "SetVariable"
                        },
                        "Submit_multiple_tiIndicators": {
                          "inputs": {
                            "body": {
                              "value": "@variables('Working_array')"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['microsoftgraphsecurity']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/beta/security/tiIndicators/submitTiIndicators"
                          },
                          "runAfter": {
                            "Set_Working_Array": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "expression": "@equals(length(variables('Results_Array')), 0)",
                      "limit": {
                        "count": 5000,
                        "timeout": "PT1H"
                      },
                      "runAfter": {
                        "Initialize_Temp_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "Until"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "evaluatedRecurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "recurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "AbuseIPDBAPI": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "connectionName": "[variables('AbuseIPDBConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      },
                      "microsoftgraphsecurity": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('ThreatIntelligenceConnectionName'))]",
                        "connectionName": "[variables('ThreatIntelligenceConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/microsoftgraphsecurity')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-AbuseIPDB-BlacklistIpToThreatIntelligence",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "AbuseIPDB-BlacklistIpToThreatIntelligence",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "AbuseIPDBAPIConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/AbuseIPDB-BlacklistIpToThreatIntelligence",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "azuresentinel.azure-sentinel-solution-abuseipdb"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AbuseIPDBConnectionName": "[concat('abuseipdb-', parameters('PlaybookName'))]",
            "ThreatIntelligenceConnectionName": "[concat('ThreatIntelligence-connection-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/microsoftgraphsecurity')]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockURL Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to take necessary actions on URL address like Block URL/Unblock URL from predefined address group and also gives an option to close the incident.",
            "description": "This playbook allows blocking/unblocking URLs in PaloAlto, using **predefined address group**. This allows to make changes on predefined address group, which is attached to security policy rule.",
            "entities": [
              "Url"
            ],
            "lastUpdateTime": "2022-07-22T00:00:00Z",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, URL address, list of existing security policy rules in which URL is a member of and provides an option to Block/Unblock URL Address by adding/removing it to/from the predefined address group. \n\n 2. The SOC can act on risky URL based on the information provided in the adaptive card, or ignore. \n\n ![PaloAlto-PAN-OS-BlockURL](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/designerscreenshot.PNG?raw=true) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky URL for taking actions like block/unblock/ignore ::** \n\n ![Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/AdaptiveCardtoBlockorUnblock.PNG?raw=true) \n\n **This is the consolidate adaptive card about the summary of actions taken on URL and the incident configuration ::** \n\n ![Consolidated Adaptive Card example](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/PaloAlto-PAN-OS/Playbooks/PaloAlto-PAN-OS-BlockURL/SummarizedAdaptiveCard.PNG?raw=true)"
            ],
            "postDeployment": [
              "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky URL \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "PaloAlto-PAN-OS-BlockURL",
                "version": "1.0.0"
              }
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "title": "PaloAlto-PAN-OS-BlockURL"
          },
          "parameters": {
            "Address Group": {
              "defaultValue": "AddressGroup",
              "metadata": {
                "description": "Address Group"
              },
              "type": "String"
            },
            "CustomConnectorName": {
              "defaultValue": "PAN-OSRestApiCustomConnector",
              "type": "string"
            },
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-BlockURL",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              },
              "type": "String"
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "metadata": {
                "description": "Team ChannelId"
              },
              "type": "String"
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "metadata": {
                "description": "GroupId of the Team channel"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('PaloAltoConnectorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('TeamsConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-3')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Compose_product_name": {
                      "description": "compose to select the incident alert product name",
                      "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                      "runAfter": {
                        "Select_alert_product_names": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('URLAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          },
                          "type": "ApiConnection"
                        },
                        "Update_incident": {
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          },
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "description": "This decides the action taken on the summarized adaptive card",
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "Entities_-_Get_URLs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      },
                      "type": "ApiConnection"
                    },
                    "For_each_malicious_URL": {
                      "actions": {
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Condition__to_check_if_user_chosen_Block": {
                              "actions": {
                                "Create_an_address_object": {
                                  "description": "This creates a new address object for the malicious URL",
                                  "inputs": {
                                    "body": {
                                      "entry": [
                                        {
                                          "@@name": "@items('For_each_malicious_URL')?['Url']",
                                          "description": "@items('For_each_malicious_URL')?['Url']",
                                          "fqdn": "@items('For_each_malicious_URL')?['Url']"
                                        }
                                      ]
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/restapi/v10.0/Objects/Addresses",
                                    "queries": {
                                      "address type": "",
                                      "location": "vsys",
                                      "name": "@items('For_each_malicious_URL')?['Url']",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "description": "This check if user chooses Block URL",
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Condition_to_check_the_edit_an_address_object_group_status": {
                              "actions": {
                                "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                  "actions": {
                                    "Append_success_status_Blocked_URL_status_to_summary_card": {
                                      "description": "append action taken to summarize on the adaptive card",
                                      "inputs": {
                                        "name": "URLAddressAction",
                                        "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                      },
                                      "type": "AppendToArrayVariable"
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_success_status_UnBlocked_URL_status_to_summary_card": {
                                        "description": "append action taken to summarize on the adaptive card",
                                        "inputs": {
                                          "name": "URLAddressAction",
                                          "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  UnBlocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                        },
                                        "type": "AppendToArrayVariable"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                          "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "else": {
                                "actions": {
                                  "Append_failure_status_to_summary_card": {
                                    "description": "append action taken to summarize on the adaptive card",
                                    "inputs": {
                                      "name": "URLAddressAction",
                                      "value": "URL Address : @{items('For_each_malicious_URL')?['Url']}  ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Failure"
                                    },
                                    "type": "AppendToArrayVariable"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Update_an_address_object_group')?['@status']",
                                      "success"
                                    ]
                                  }
                                ]
                              },
                              "runAfter": {
                                "Update_an_address_object_group": [
                                  "Succeeded"
                                ]
                              },
                              "type": "If"
                            },
                            "Update_an_address_object_group": {
                              "inputs": {
                                "body": {
                                  "entry": {
                                    "@@name": "[parameters('Address Group')]",
                                    "static": {
                                      "member": "@{variables('AddressGroupMembers')}"
                                    }
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/restapi/v10.0/Objects/AddressGroups",
                                "queries": {
                                  "location": "vsys",
                                  "name": "[parameters('Address Group')]",
                                  "vsys": "vsys1"
                                }
                              },
                              "runAfter": {
                                "Condition__to_check_if_user_chosen_Block": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection"
                            }
                          },
                          "description": "condition to check the submit action is block / unblock or Ignore",
                          "else": {
                            "actions": {
                              "Append_to_array_variable_URL_address_action_chosen": {
                                "description": "This appends the action taken on URL to the list of existing actions",
                                "inputs": {
                                  "name": "URLAddressAction",
                                  "value": "URL Address : @{items('For_each_malicious_URL')?['Url']},  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                },
                                "type": "AppendToArrayVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_URL_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_address_group_text": {
                                  "description": "append address group text to adaptive card dynamically",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": {
                                      "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "type": "AppendToArrayVariable"
                                },
                                "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": {
                                  "description": "This filters the URL address from predefined address group to unreference/unblock URL",
                                  "inputs": {
                                    "from": "@variables('AddressGroupMembers')",
                                    "where": "@not(equals(item(), items('For_each_malicious_URL')?['Url']))"
                                  },
                                  "runAfter": {
                                    "Set_dynamic_action_name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query"
                                },
                                "Set_dynamic_action_name": {
                                  "description": "variable to set action name dynamically",
                                  "inputs": {
                                    "name": "ActionName",
                                    "value": "UnBlock URL"
                                  },
                                  "runAfter": {
                                    "Append_address_group_text": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                },
                                "unreference_URL_address_from_the_existing_group_members": {
                                  "description": "unreference URL address from the group members and update",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('Filter_array_URL_address_from_the_list_of_address_objects_to_unreference')"
                                  },
                                  "runAfter": {
                                    "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable"
                                }
                              },
                              "description": "condition to check the malicious URL address is present in the predefined address group and the URL is part of static member",
                              "else": {
                                "actions": {
                                  "Append_URL_address_to_the_address_group_members": {
                                    "description": "append URL address to the address group members",
                                    "inputs": {
                                      "name": "AddressGroupMembers",
                                      "value": "@items('For_each_malicious_URL')?['Url']"
                                    },
                                    "runAfter": {
                                      "Append_address_group_text_to_adaptive_card_body": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToArrayVariable"
                                  },
                                  "Append_address_group_text_to_adaptive_card_body": {
                                    "description": "append address group text to adaptive card dynamically",
                                    "inputs": {
                                      "name": "AdaptiveCardBody",
                                      "value": {
                                        "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "type": "AppendToArrayVariable"
                                  },
                                  "Set_dynamic_action_name_to_variable_Action_name": {
                                    "description": "set action name dynamically",
                                    "inputs": {
                                      "name": "ActionName",
                                      "value": "Block URL"
                                    },
                                    "runAfter": {
                                      "Append_URL_address_to_the_address_group_members": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('AddressGroupMembers')",
                                      "@items('For_each_malicious_URL')?['Url']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "description": "This checks if URL is a member of any of the list of address objects",
                          "else": {
                            "actions": {
                              "Append_URL_to_array_of_address_group_members": {
                                "description": "append the Malicious URL address to the existing group members to block / unblock from the predefined address group",
                                "inputs": {
                                  "name": "AddressGroupMembers",
                                  "value": "@items('For_each_malicious_URL')?['Url']"
                                },
                                "runAfter": {
                                  "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": {
                                "description": "This appends the text to display If URL is not a member of security policy rules",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Set_variable_to_Block_URL": {
                                "description": "This sets the variable block URL",
                                "inputs": {
                                  "name": "ActionName",
                                  "value": "Block URL"
                                },
                                "runAfter": {
                                  "Append_URL_to_array_of_address_group_members": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": {
                          "actions": {
                            "Append_policy_text": {
                              "description": "dynamic policy text based on security policies",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "text": "It is also member of the following security policy rules",
                                  "type": "TextBlock"
                                }
                              },
                              "type": "AppendToArrayVariable"
                            },
                            "Append_security_policies": {
                              "description": "append security policies which the URL address is exist",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "columns": [
                                    {
                                      "items": "@body('Select_security_policy_rules')",
                                      "type": "Column"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              },
                              "runAfter": {
                                "Append_policy_text": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable"
                            }
                          },
                          "description": "condition to check if the URL address is present in the existing security policy rules to conditionally apply the policy text and security policy rules",
                          "else": {
                            "actions": {
                              "Append_policy_text_to_adaptive_card_body_variable": {
                                "description": "dynamic policy text based on security policies",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "It is not a member of any other Policy Rules",
                                    "type": "TextBlock"
                                  }
                                },
                                "type": "AppendToArrayVariable"
                              },
                              "Append_security_policies_to_adaptive_card_body_variable": {
                                "description": "append security policies which the URL address is exist",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {}
                                },
                                "runAfter": {
                                  "Append_policy_text_to_adaptive_card_body_variable": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Select_security_policy_rules'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "runAfter": {
                            "Select_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "If"
                        },
                        "Configured_address_group": {
                          "description": "compose predefined address group",
                          "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose"
                        },
                        "Filter_array_URL_from_list_of_security_rules": {
                          "description": "This filters all the security rules in which this URL is a member",
                          "inputs": {
                            "from": "@body('List_security_rules')?['result']?['entry']",
                            "where": "@contains(item()?['destination']?['member'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "runAfter": {
                            "Configured_address_group": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query"
                        },
                        "Filter_array_of_URL_address_from_list_of_address_objects": {
                          "description": "This filters the list of address objects in which this URL is a member ",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@equals(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query"
                        },
                        "List_address_groups": {
                          "description": "This gets complete list of address object groups present in the PAN-OS",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/restapi/v10.0/Objects/AddressGroups",
                            "queries": {
                              "location": "vsys",
                              "name": "[parameters('Address Group')]",
                              "vsys": "vsys1"
                            }
                          },
                          "runAfter": {
                            "Filter_array_of_URL_address_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "[parameters('Teams ChannelId')]"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "[parameters('Teams GroupId')]"
                            }
                          },
                          "runAfter": {
                            "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook"
                        },
                        "Select_security_policy_rules": {
                          "description": "prepare columns list to show the security policy rules in the adaptive card if URL address is present",
                          "inputs": {
                            "from": "@body('Filter_array_URL_from_list_of_security_rules')",
                            "select": {
                              "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                              "type": "TextBlock",
                              "weight": "bolder"
                            }
                          },
                          "runAfter": {
                            "Filter_array_URL_from_list_of_security_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "Select"
                        },
                        "Set_variable_adaptive_card_body": {
                          "description": "variable to hold adaptive card body",
                          "inputs": {
                            "name": "AdaptiveCardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious URL - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised URL @{items('For_each_malicious_URL')?['Url']} detected by the provider : @{outputs('Compose_product_name')}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['severity']}  Incident  @{triggerBody()?['object']?['properties']?['title']}",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in PAN-OS",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                              }
                            ]
                          },
                          "type": "SetVariable"
                        },
                        "Set_variable_address_group_members": {
                          "description": "assign list of address group members",
                          "inputs": {
                            "name": "AddressGroupMembers",
                            "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                          },
                          "runAfter": {
                            "List_address_groups": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "runAfter": {
                        "List_security_rules": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable_URL_address_action": {
                      "description": "This holds the action taken on each URL ",
                      "inputs": {
                        "variables": [
                          {
                            "name": "URLAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_action_name": {
                      "description": "variable to store action name to be displayed on adaptive card",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ActionName",
                            "type": "string"
                          }
                        ]
                      },
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "description": "variable to store adaptive card body json",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AdaptiveCardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "Initialize_variable_address_group_members": {
                      "description": "variable to store the list of address group members",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AddressGroupMembers",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    },
                    "List_address_objects": {
                      "description": "This gets complete list of address object present in the PAN-OS",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "Compose_product_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "List_security_rules": {
                      "description": "This gets complete list of security policy rules present in the PAN-OS",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Policies/SecurityRules",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on URL's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n  {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[parameters('Teams ChannelId')]"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[parameters('Teams GroupId')]"
                        }
                      },
                      "runAfter": {
                        "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook"
                    },
                    "Select_alert_product_names": {
                      "description": "data operator to select the alert product name",
                      "inputs": {
                        "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                        "select": {
                          "text": "@item()"
                        }
                      },
                      "runAfter": {
                        "Initialize_variable_URL_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    },
                    "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": {
                      "description": "This is used to compose the list of actions taken by SOC on respective URL addresses",
                      "inputs": {
                        "from": "@variables('URLAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      },
                      "runAfter": {
                        "For_each_malicious_URL": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[variables('TeamsConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-PaloAlto-PAN-OS-BlockURL",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAlto-PAN-OS-BlockURL",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "PaloAltoCustomConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/PaloAlto-PAN-OS-BlockURL",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[concat('teamsconnector-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "_connection-3": "[variables('connection-3')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-3": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/teams')]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "AbuseIPDB-EnrichIncidentByIPInfo Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "description": "Once a new sentinal incident is created, this playbook gets triggered and performs the following actions:\n 1. [Gets Information](https://docs.abuseipdb.com/#check-endpoint) from AbuseIPDB by IP`s, provided in the alert custom entities. \n 2. Enriches the incident with the obtained info.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-09-20T00:00:00Z",
            "postDeployment": [
              "**a. Authorize connections**",
              "Once deployment is complete, authorize each connection.",
              "1. Open playbook which has been deployed.",
              "2. Click API connection on left side blade.",
              "3. Click the Microsoft Sentinel connection resource.",
              "4. Click edit API connection.",
              "5. Click Authorize.",
              "6. Sign in.",
              "7. Click Save.",
              "8. Repeat steps for other connections."
            ],
            "prerequisites": [
              "1. AbuseIPDBAPI Custom Connector has to be deployed prior to the deployment of this playbook under the same subscription."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "AbuseIPDB Enrich Incident By IP Info",
                "version": "1.0.0"
              }
            ],
            "title": "AbuseIPDB Enrich Incident By IP Info"
          },
          "parameters": {
            "PlaybookName": {
              "defaultValue": "AbuseIPDB-EnrichIncidentByIPInfo",
              "type": "String"
            },
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              },
              "type": "string"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-1')]"
                },
                "displayName": "[variables('AzureSentinelConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "kind": "V1",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AbuseIPDBConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-2')]"
                },
                "displayName": "[variables('AbuseIPDBConnectionName')]"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Add_comment_to_incident_(V3)": {
                      "inputs": {
                        "body": {
                          "incidentArmId": "@triggerBody()?['object']?['id']",
                          "message": "<p><span style=\"font-size: 14px\"><strong></strong></span><span style=\"font-size: 14px\"><strong>@{outputs('Get_Logo')}</strong></span><span style=\"font-size: 14px\"><strong><br>\nAbuseIPDB IP Checking Results:</strong></span><br>\n@{outputs('Compose')}</p>"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/Incidents/Comment"
                      },
                      "runAfter": {
                        "Compose": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    },
                    "Check_each_IP_in_AbuseIPDB": {
                      "actions": {
                        "Append_Result_to_Result_List": {
                          "inputs": {
                            "name": "Result List",
                            "value": {
                              "abuseConfidenceScore": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['abuseConfidenceScore']",
                              "hostnames": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['hostnames']",
                              "ipAddress": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['ipAddress']",
                              "ipVersion": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['ipVersion']",
                              "isPublic": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isPublic']",
                              "isWhitelisted": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isWhitelisted']",
                              "isp": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['isp']",
                              "lastReportedAt": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['lastReportedAt']",
                              "numDistinctUsers": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['numDistinctUsers']",
                              "totalReports": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['totalReports']",
                              "usageType": "@body('AuseIPDB_CHECK_Endpoint')?['data']?['usageType']"
                            }
                          },
                          "runAfter": {
                            "AuseIPDB_CHECK_Endpoint": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "AuseIPDB_CHECK_Endpoint": {
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['AbuseIPDBAPI']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/check",
                            "queries": {
                              "ipAddress": "@items('Check_each_IP_in_AbuseIPDB')?['Address']"
                            }
                          },
                          "type": "ApiConnection"
                        }
                      },
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "runAfter": {
                        "Initialize_Results_List": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Compose": {
                      "inputs": "@body('Create_HTML_table_with_Results')",
                      "runAfter": {
                        "Create_HTML_table_with_Results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Create_HTML_table_with_Results": {
                      "inputs": {
                        "format": "HTML",
                        "from": "@variables('Result List')"
                      },
                      "runAfter": {
                        "Check_each_IP_in_AbuseIPDB": [
                          "Succeeded"
                        ]
                      },
                      "type": "Table"
                    },
                    "Entities_-_Get_IPs": {
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      },
                      "type": "ApiConnection"
                    },
                    "Get_Logo": {
                      "inputs": "<img src=\"https://www.abuseipdb.com/img/abuseipdb.png.pagespeed.ce.CI8T6WsXU7.png\"  width=\"152\" height=\"32\"> ",
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Initialize_Results_List": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "Result List",
                            "type": "array"
                          }
                        ]
                      },
                      "runAfter": {
                        "Get_Logo": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "AbuseIPDBAPI": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AbuseIPDBConnectionName'))]",
                        "connectionName": "[variables('AbuseIPDBConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "id": "[concat('/subscriptions/',subscription().subscriptionId, '/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-AbuseIPDB-EnrichIncidentByIPInfo",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "AbuseIPDB-EnrichIncidentByIPInfo",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "AbuseIPDBAPIConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/AbuseIPDB-EnrichIncidentByIPInfo",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "azuresentinel.azure-sentinel-solution-abuseipdb"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AbuseIPDBConnectionName": "[concat('abuseipdb-connection-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "_connection-1": "[variables('connection-1')]",
            "_connection-2": "[variables('connection-2')]",
            "connection-1": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-2": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('customApis_AbuseIPDBAPI_name'))]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "PaloAlto-PAN-OS-GetThreatPcap Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "metadata": {
            "description": "This playbook allows us to get a threat PCAP for a given PCAP ID.",
            "entities": [
              "Ip"
            ],
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the PCAP from the device. \n\n 3. Puts the PCAP in Blob Storage \n\n 4. Creates a Sentinel Incident and updates it with a link to the blob."
            ],
            "postDeployment": [
              "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents with a threat PCAP where the PCAP ID is not null or zero."
            ],
            "releaseNotes": [
              {
                "notes": [
                  "Initial version"
                ],
                "title": "Get Threat PCAP - Palo Alto PAN-OS XML API",
                "version": "1.0.0"
              }
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "title": "Get Threat PCAP - Palo Alto PAN-OS XML API"
          },
          "parameters": {
            "CustomConnectorName": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "metadata": {
                "description": "Name of the custom connector which interacts with PAN-OS"
              },
              "type": "String"
            },
            "LogAnalyticsResourceGroup": {
              "metadata": {
                "description": "Name of the cLog Analytics Resource group for logging"
              },
              "type": "string"
            },
            "LogAnalyticsResourceName": {
              "metadata": {
                "description": "Name of the log analytics instance for logging"
              },
              "type": "string"
            },
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetThreatPcap",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              },
              "type": "String"
            }
          },
          "resources": [
            {
              "apiVersion": "2021-04-01",
              "kind": "StorageV2",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureStorageName')]",
              "properties": {
                "accessTier": "Hot",
                "allowBlobPublicAccess": "false",
                "allowSharedKeyAccess": "true",
                "minimumTlsVersion": "TLS1_2",
                "networkAcls": {
                  "bypass": "AzureServices",
                  "defaultAction": "Allow"
                },
                "supportsHttpsTrafficOnly": "true"
              },
              "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
              },
              "type": "Microsoft.Storage/storageAccounts"
            },
            {
              "apiVersion": "2021-02-01",
              "dependsOn": [
                "[concat('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
              ],
              "name": "[concat(variables('AzureStorageName'), '/default')]",
              "properties": {
                "deleteRetentionPolicy": {
                  "enabled": "false"
                }
              },
              "type": "Microsoft.Storage/storageAccounts/blobServices"
            },
            {
              "apiVersion": "2019-06-01",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts/blobServices', variables('AzureStorageName'), 'default')]",
                "[resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName'))]"
              ],
              "name": "[concat(variables('AzureStorageName'), '/default/', variables('ContainerName'))]",
              "properties": {
                "publicAccess": "None"
              },
              "type": "Microsoft.Storage/storageAccounts/blobServices/containers"
            },
            {
              "apiVersion": "2016-06-01",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
              ],
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureBlobConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-4')]"
                },
                "displayName": "[variables('AzureBlobConnectionName')]",
                "parameterValues": {
                  "accessKey": "[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName')), '2021-09-01').keys[0].value]",
                  "accountName": "[variables('AzureStorageName')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "kind": "V1",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureSentinelConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-5')]"
                },
                "displayName": "[parameters('PlaybookName')]",
                "parameterValueType": "Alternative"
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('PaloAltoConnectorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-6')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[variables('AzureMonitorConnectionName')]",
              "properties": {
                "api": {
                  "id": "[variables('_connection-7')]"
                }
              },
              "type": "Microsoft.Web/connections"
            },
            {
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('PlaybookName')]",
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "If_incident_is_a_Palo_Alto_incident": {
                          "actions": {
                            "If_PCAP_ID_Exists": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('Create_blob_(V2)')?['Path']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Create_blob_(V2)": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Create_blob_(V2)": {
                                  "inputs": {
                                    "body": "@body('Query_Palo_Alto_XML_API')",
                                    "headers": {
                                      "ReadFileMetadataFromServer": true
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azureblob']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('defendpaloaltopcapsdev'))}/files",
                                    "queries": {
                                      "folderPath": "pcapblobs-palo-alto",
                                      "name": "@{concat(string('paloalto',items('For_each')['PcapID']), string(items('For_each')['TimeGenerated']), '.pcap')}",
                                      "queryParametersSingleEncoded": true
                                    }
                                  },
                                  "runAfter": {
                                    "Query_Palo_Alto_XML_API": [
                                      "Succeeded"
                                    ]
                                  },
                                  "runtimeConfiguration": {
                                    "contentTransfer": {
                                      "transferMode": "Chunked"
                                    }
                                  },
                                  "type": "ApiConnection"
                                },
                                "Query_Palo_Alto_XML_API": {
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/api/",
                                    "queries": {
                                      "category": "threat-pcap",
                                      "device_name": "@items('For_each')['MonitoringDeviceName']",
                                      "pcap-id": "@items('For_each')['PcapID']",
                                      "search-time": "@{items('For_each')['TimeGenerated']}",
                                      "sessionId": "@items('For_each')['SessionID']",
                                      "type": "export"
                                    }
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "not": {
                                      "equals": [
                                        "@items('For_each')['PcapID']",
                                        "@null"
                                      ]
                                    }
                                  },
                                  {
                                    "not": {
                                      "equals": [
                                        "@items('For_each')['PcapID']",
                                        0
                                      ]
                                    }
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@items('For_each')['AlertSource']",
                                  "@string('PaloAlto')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "foreach": "@body('Run_query_and_list_results')?['value']",
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Run_query_and_list_results": {
                      "inputs": {
                        "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "[parameters('LogAnalyticsResourceGroup')]",
                          "resourcename": "[parameters('LogAnalyticsResourceName')]",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "[variables('subscriptionId')]",
                          "timerange": "Set in query"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "incident": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azureblob": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                        "connectionName": "[variables('AzureBlobConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureblob')]"
                      },
                      "azuremonitorlogs": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                        "connectionName": "[variables('AzureMonitorConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[variables('AzureSentinelConnectionName')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        },
                        "id": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      },
                      "paloaltoconnector": {
                        "connectionId": "[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
                        "resourceGroup": "', resourceGroup().name, '"
                      }
                    }
                  }
                },
                "state": "Enabled"
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[variables('workspaceResourceId')]"
              },
              "type": "Microsoft.Logic/workflows"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Playbook-PaloAlto-PAN-OS-GetThreatPCAP",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAlto-PAN-OS-GetThreatPCAP",
                "dependencies": {
                  "criteria": [
                    {
                      "contentId": "PaloAltoCustomConnector",
                      "kind": "LogicAppsCustomConnector",
                      "version": "1.0"
                    }
                  ]
                },
                "kind": "Playbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Logic/workflows/PaloAlto-PAN-OS-GetThreatPCAP",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "AzureBlobConnectionName": "[concat('azureblob-', parameters('PlaybookName'))]",
            "AzureMonitorConnectionName": "[concat('azuremonitor-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[concat('azuresentinel-', parameters('PlaybookName'))]",
            "AzureStorageName": "panosthreatpcapssa",
            "ContainerName": "panosthreatpcaps",
            "PaloAltoConnectorConnectionName": "[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "_connection-4": "[variables('connection-4')]",
            "_connection-5": "[variables('connection-5')]",
            "_connection-6": "[variables('connection-6')]",
            "_connection-7": "[variables('connection-7')]",
            "connection-4": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azureblob')]",
            "connection-5": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "connection-6": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "connection-7": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]",
            "subscriptionId": "[subscription().subscriptionId]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0",
      "properties": {
        "description": "AbuseIPDBAPIConnector Playbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0",
          "parameters": {
            "customApis_AbuseIPDBAPI_name": {
              "defaultValue": "AbuseIPDBAPI",
              "metadata": {
                "description": "Name of the AbuseIPDBAPI Connector"
              },
              "type": "string"
            }
          },
          "resources": [
            {
              "apiVersion": "2016-06-01",
              "location": "[variables('workspace-location-inline')]",
              "name": "[parameters('customApis_AbuseIPDBAPI_name')]",
              "properties": {
                "apiType": "Rest",
                "backendService": {
                  "serviceUrl": "https://api.abuseipdb.com/api/v2/"
                },
                "brandColor": "#FFFFFF",
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "constraints": {
                        "clearText": false,
                        "required": "true",
                        "tabIndex": 2
                      },
                      "description": "The API Key for this api",
                      "displayName": "API Key",
                      "tooltip": "Provide your API Key"
                    }
                  }
                },
                "description": "Connector for AbuseIPDB API",
                "displayName": "[parameters('customApis_AbuseIPDBAPI_name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACmCAYAAABUfSRKAAAMbmlDQ1BJQ0MgUHJvZmlsZQAASImVVwdYU8kWnluSkJDQAghICb0JIjWAlBBaAOlFsBGSQEKJMSGo2JFFBdcuoljRVRHFtgJix64sir0vFlSUdVEXRUF5ExLQdV/53vm+uffPmTP/KXcm9x4ANHu4EkkuqgVAnjhfGh8WxBibmsYgPQcYGA60gBUw5/JkElZsbBSAMnj/u3y4BRDF/bqTguuf8/9VdPgCGQ8AZDzEGXwZLw/ikwDg63kSaT4ARIXecmq+RIHnQqwrhQFCvEqBs5R4pwJnKPHRAZvEeDbEVwFQo3K50iwANB5APaOAlwV5NPogdhHzRWIANEdA7M8TcvkQK2IfkZc3WYErILaD9hKIYTyAmfEdZ9bf+DOG+LncrCGszGtA1IJFMkkud/r/WZr/LXm58kEfNnBQhdLweEX+sIZ3ciZHKjAV4k5xRnSMotYQ94j4yroDgFKE8vAkpT1qzJOxYf2APsQufG5wJMTGEIeKc6OjVPqMTFEoB2K4W9BponxOIsQGEC8UyEISVDabpZPjVb7Qukwpm6XSX+BKB/wqfD2S5ySxVPzvhAKOih/TKBQmpkBMgdiqQJQcDbEGxM6ynIRIlc3oQiE7etBGKo9XxG8FcbxAHBak5McKMqWh8Sr70jzZYL7YZqGIE63CB/KFieHK+mBneNyB+GEu2FWBmJU0yCOQjY0azIUvCA5R5o69FIiTElQ8PZL8oHjlWpwiyY1V2eMWgtwwhd4CYndZQYJqLZ6cDzenkh/PlOTHJirjxAuzuRGxynjwZSAKsEEwYAA5HBlgMsgGopbO+k74SzkTCrhACrKAADipNIMrUgZmxPCaAArBHxAJgGxoXdDArAAUQP2XIa3y6gQyB2YLBlbkgOcQ54FIkAt/ywdWiYe8JYNnUCP6h3cuHDwYby4civl/rx/UftOwoCZKpZEPemRoDloSQ4jBxHBiKNEeN8L9cV88Cl4D4XDFmbj3YB7f7AnPCa2EJ4SbhDbC3UmiIukPUY4BbZA/VFWLjO9rgdtATg88CPeD7JAZ18eNgBPuDv2w8ADo2QNq2aq4FVVh/MD9twy+exoqO7ILGSUPIweS7X5cqeGg4THEoqj19/VRxpoxVG/20MyP/tnfVZ8P75E/WmILsYPYeewUdhE7itUDBnYCa8CasWMKPLS7ng3srkFv8QPx5EAe0T/8DT5ZRSVlLjUuHS59yrl8wbR8xcFjT5ZMl4qyhPkMFnw7CBgcMc95BMPVxdUVAMW7Rvn39T5u4B2C6Dd/083/HQC/E/39/Ue+6SJOALDfCx7/w990dkwAtNUBuHCYJ5cWKHW44kKA/xKa8KQZAlNgCexgPq7AE/iCQBACIkAMSASpYCKMXgj3uRRMBTPBPFACysAysBqsA5vAVrAT7AEHQD04Ck6Bc+AyuApugvtw97SD16ALfAC9CIKQEBpCRwwRM8QacURcESbij4QgUUg8koqkI1mIGJEjM5H5SBmyAlmHbEGqkf3IYeQUchFpRe4ij5EO5B3yGcVQKqqLmqA26EiUibLQSDQRnYBmoVPQQrQYXYJWoFXobrQOPYVeRm+ibehrtBsDmDqmj5ljThgTY2MxWBqWiUmx2VgpVo5VYbVYI3zO17E2rBP7hBNxOs7AneAODseTcB4+BZ+NL8bX4TvxOvwMfh1/jHfhXwk0gjHBkeBD4BDGErIIUwklhHLCdsIhwll4ltoJH4hEoj7RlugFz2IqMZs4g7iYuIG4l3iS2Ep8SuwmkUiGJEeSHymGxCXlk0pIa0m7SSdI10jtpB41dTUzNVe1ULU0NbFakVq52i6142rX1F6o9ZK1yNZkH3IMmU+eTl5K3kZuJF8ht5N7KdoUW4ofJZGSTZlHqaDUUs5SHlDeq6urW6h7q8epi9Tnqleo71O/oP5Y/RNVh+pAZVPHU+XUJdQd1JPUu9T3NBrNhhZIS6Pl05bQqmmnaY9oPRp0DWcNjgZfY45GpUadxjWNN5pkTWtNluZEzULNcs2Dmlc0O7XIWjZabC2u1mytSq3DWre1urXp2qO0Y7TztBdr79K+qP1Sh6RjoxOiw9cp1tmqc1rnKR2jW9LZdB59Pn0b/Sy9XZeoa6vL0c3WLdPdo9ui26Wno+eul6w3Ta9S75hemz6mb6PP0c/VX6p/QP+W/udhJsNYwwTDFg2rHXZt2EeD4QaBBgKDUoO9BjcNPhsyDEMMcwyXG9YbPjTCjRyM4oymGm00OmvUOVx3uO9w3vDS4QeG3zNGjR2M441nGG81bjbuNjE1CTORmKw1OW3SaapvGmiabbrK9LhphxndzN9MZLbK7ITZK4Yeg8XIZVQwzjC6zI3Nw83l5lvMW8x7LWwtkiyKLPZaPLSkWDItMy1XWTZZdlmZWY2xmmlVY3XPmmzNtBZar7E+b/3RxtYmxWaBTb3NS1sDW45toW2N7QM7ml2A3RS7Krsb9kR7pn2O/Qb7qw6og4eD0KHS4Yoj6ujpKHLc4Ng6gjDCe4R4RNWI205UJ5ZTgVON02Nnfeco5yLneuc3I61Gpo1cPvL8yK8uHi65Lttc7o/SGRUxqmhU46h3rg6uPNdK1xtuNLdQtzluDW5v3R3dBe4b3e940D3GeCzwaPL44unlKfWs9ezwsvJK91rvdZupy4xlLmZe8CZ4B3nP8T7q/cnH0yff54DPn75Ovjm+u3xfjrYdLRi9bfRTPws/rt8WvzZ/hn+6/2b/tgDzAG5AVcCTQMtAfuD2wBcse1Y2azfrTZBLkDToUNBHtg97FvtkMBYcFlwa3BKiE5IUsi7kUahFaFZoTWhXmEfYjLCT4YTwyPDl4bc5Jhwep5rTFeEVMSviTCQ1MiFyXeSTKIcoaVTjGHRMxJiVYx5EW0eLo+tjQAwnZmXMw1jb2CmxR+KIcbFxlXHP40fFz4w/n0BPmJSwK+FDYlDi0sT7SXZJ8qSmZM3k8cnVyR9TglNWpLSNHTl21tjLqUapotSGNFJactr2tO5xIeNWj2sf7zG+ZPytCbYTpk24ONFoYu7EY5M0J3EnHUwnpKek70rv48Zwq7jdGZyM9RldPDZvDe81P5C/it8h8BOsELzI9Mtckfkyyy9rZVaHMEBYLuwUsUXrRG+zw7M3ZX/MicnZkdOfm5K7N08tLz3vsFhHnCM+M9l08rTJrRJHSYmkbYrPlNVTuqSR0u0yRDZB1pCvCz/qm+V28p/kjwv8CyoLeqYmTz04TXuaeFrzdIfpi6a/KAwt/GUGPoM3o2mm+cx5Mx/PYs3aMhuZnTG7aY7lnOI57XPD5u6cR5mXM++3IpeiFUV/zU+Z31hsUjy3+OlPYT/VlGiUSEtuL/BdsGkhvlC0sGWR26K1i76W8ksvlbmUlZf1LeYtvvTzqJ8rfu5fkrmkZann0o3LiMvEy24tD1i+c4X2isIVT1eOWVm3irGqdNVfqyetvljuXr5pDWWNfE1bRVRFw1qrtcvW9q0TrrtZGVS5d73x+kXrP27gb7i2MXBj7SaTTWWbPm8Wbb6zJWxLXZVNVflW4taCrc+3JW87/wvzl+rtRtvLtn/ZId7RtjN+55lqr+rqXca7ltagNfKajt3jd1/dE7ynodapdste/b1l+8A++b5X+9P33zoQeaDpIPNg7a/Wv64/RD9UWofUTa/rqhfWtzWkNrQejjjc1OjbeOiI85EdR82PVh7TO7b0OOV48fH+E4Unuk9KTnaeyjr1tGlS0/3TY0/fOBN3puVs5NkL50LPnT7POn/igt+Foxd9Lh6+xLxUf9nzcl2zR/Oh3zx+O9Ti2VJ3xetKw1Xvq42to1uPXwu4dup68PVzNzg3Lt+Mvtl6K+nWndvjb7fd4d95eTf37tt7Bfd67899QHhQ+lDrYfkj40dVv9v/vrfNs+3Y4+DHzU8Sntx/ynv6+pnsWV978XPa8/IXZi+qX7q+PNoR2nH11bhX7a8lr3s7S/7Q/mP9G7s3v/4Z+Gdz19iu9rfSt/3vFr83fL/jL/e/mrpjux99yPvQ+7G0x7Bn5yfmp/OfUz6/6J3aR+qr+GL/pfFr5NcH/Xn9/RKulDvwKYDBgWZmAvBuBwC0VADosG+jjFP2ggOCKPvXAQT+E1b2iwPiCUAt/H6P64RfN7cB2LcNtl+QXxP2qrE0ABK9AermNjRUIst0c1VyUWGfQnjU3/8e9myklQB8Wdbf31vV3/9lKwwW9o4nxcoeVCFE2DNsjv2SkZcB/o0o+9PvcvzxDhQRuIMf7/8CLK6RA7f5mOEAAABsZVhJZk1NACoAAAAIAAQBGgAFAAAAAQAAAD4BGwAFAAAAAQAAAEYBKAADAAAAAQACAACHaQAEAAAAAQAAAE4AAAAAAAAAkAAAAAEAAACQAAAAAQACoAIABAAAAAEAAACkoAMABAAAAAEAAACmAAAAADGOIuAAAAAJcEhZcwAAFiUAABYlAUlSJPAAACYWSURBVHgB7V0JnBTF1X8zO7OzNwvCcggIomDwCCExn2hEEUGNGiMajbfgSYwGxaBREAQxikGIJBEvPBHvAyRBvDWKxoiCqJxyKzfsvTM7x1f/JrX29nb3VFV3z8W+32+3uqurXl3/eXW8qle+SCSSoFZqrYEMqQF/huSjNRutNaDVQCsgW4GQUTXQCsiMao7WzLQCshUDGVUDrYDMqOZozUwrIFsxkFE10ArIjGqO1sy0ArIVAxlVA4GMyk2GZCZRX0fxDWspvmkjxb/fTPFt31N8x3ZK7N5Fico9lKipJoRJhMNE0UaiBNMt+HxEgSD5QiHyFRaRr6SUfG3Kyde2HfnbdyB/RWfyd96f/F27kb97Ty1MhhQ3o7Lh29c1NYmqPRRdtpRiy5dRbMXXFFuzkuKbN3reSP79u1Fer96U16cv5R1yGAUOO4J8ZeWep5vpCexzgEw0NFD0Px9S9LNPKPr5pxRbtTxj2ijv4EMo8JMjKfDT/6PAz48hX0FBxuQtVRnZJwAZ376VGt9/m6IfvkONiz5IVd06Tic44FgKHDOIggNPIH+Hjo75ZQODnAUkJGHjG69R5M0FmkTMhsawyyMkZv6JJ1NwyGk5LTlzDpDRpYspMv9livxrLlFjxK6Ns/NbMJ/yT/kV5Z96JgWO6J+dZbDJdc4AMvL6PIq88hxFv/ivTXFz61Og388o/9fnUP5Jp+dMwbIekOEX51D4uSe1ZZqcaRXJgmAZKXTORRQ66zzJmJkXPGsBGX75GQrPnpWSJZrMazbzHGEpKXTBCAqd+VvzAFngm3WAbHxrATU8NpNiq1dkQfWmJ4t5B/WhgkuvpuDgk9OTAQepZg0gYyu+ooYHZ1DjR+85KO6+FTV49HFUcOW1bPH90KwpeFYAsuH+e6nhiYdSXqm+omLydzuA/F2Yuq8TU/21r9BUgb6yNuQrLmFqQrZwHQwS+dmWgHiczeobmTqxgRK1NZSoqtRUjfEd2yi+hakev2NqyI3rKVFXm/JyFFx8BRWMvCHl6aokmNGAjH78AdXfN4Via1erlE0qjq+0jAKH96O8vkdQXu8fEbo96J7dJujGMdyIrfyGYl8vpeiXX1CiusrtZFrwy+t5EBVeN4YCRx3b4lsmeWQsIOtnTKHw0496WleBIwdQkC04Q1WX96PDPE3Ljnnsm2WaKrMRKs1PF9kFdfwtdP5wKrx2jGM+XjHIOEBig0PdlNs16eFFoYMDB1Pw+CEU/MUgglTMNIK0bPw3U3G++wZTd77lSfbQCxSNGa9t7PAkAQdMMwqQkVefp7q7bnNQHPOokH75J59B+UNPJV95W/NAGeib2LObIgvnU2TBqwQp6jYV3TyR8s/4jdtsHfHLGEDWT7tTW+B2VBpD5Pyhp2kVHuj/c8OX7HuNLv4P4QcbWfiaq5nHgnrh9be4ytMJs7QDEvsR6ybcxHbhvO+kHM3ihs6+gEK/uZBthO3RzD8XXuIb1lH4+aco/MJs14oTHDCQiibcnRH7MdMKSGyGrRs32rVZdGjYeRS68DJPZseutb5LjDBbDz/1CIVfmuMKR8zCiyZN1TYNu8JQkUnaAIkNsrW3jtKOBCjmvSlacNBJVDBipLZU0+S5jzxgCalh1v3U+M7rjkuMIxfFk6drqw6OmSkySAsgMXusvfnavWdRFDOOaPhVF1w9im1gHeyAS25ERZ02zJzuvLdhZ4OK75qRtjpNOSChi64de71jFBRcciUDo3M+jjOSYQwaZk6jhscfdJyr4jumpUUXnlJAugFGaFEwK8RewFYyrwHsCcWqBbRBTigdoEwZILVu+qbfO6kfwuy5cPRYRzz2pcj1U+9wPBsvvvtvKe2+UwJITGBqrh2uPmb051HRLZO0bfuZAKj339+7RGV0zfI2cODAJm8869+bPnj4gOMcdXeOY5s/YmqpsDFlyYxHUzbR8RyQWNqpueYS5dk0DtqXTH0gLbpmPeD0z2ot+0OssWP3Snnu/vDFmydoeeom/Ul5woPZd8nfH0/JkpCngMSid83VFylXBG8e7FIJncckrMcE0On/PE5OY89ByV2v0oSOvG7CH9l+UjUFBFY0SmY+6fniuaeArL3hKtc0MEU3TWAHms51rb24xLvjjjs0nvzdtQQkGXFAclcyunDwusm3UuS1l4TD6wNCo1N87wN6L9efPQOkF7rpovFT2CYJtRN2RsmXbgBatSQA6TUo6++7m8JzHrPKgq2/17pvTwDp1a4d1JS2aHvciaaVxkHGwYdAn332GdXWpn6XtmkGJTy9BqaT9Uovdwm5DkjsZ6y+9CyJqpcPeu7qLfRedb1wxI4dO9LWrVupU6dOtGXLFuF46Q6YyaAsfexFT/ZT5o0bN26CmxVfy9YaE8yWjpf0y/IiWlTTQN81ii1lcAlZU1NDnTt3ptLSUiorK9Pc6upqL7PqiDeX+F4tFQV+NkA74xNb9oV0PmMrl1PIg72UrkrIVBw74DW3PRojSMqv69XNpXTp0oWZdfRR165dafPmzRrrTZs28SQyxgUgFy5c6Fl+VCc6XhyHcA2QOJBVc/2V0pWGw1SqZ6zXh6N07pottC7MjIa6QAAmANq9e3fauHGvjcgNGza4wNk5C69BWTuarYgoLAmVTHvQ1YNjrgGy+vzTpdcbtbWtB2Zr2/Tr/zJRqdUgIX/LQLnN0H0nmFVbgMvoiiYCUILKy8upbdu2tH79eu29srKSdu/erT2n+p+XoMQ6Zc1VFyi1YenT81yrClcAqXRumqkDSx9+pkkDg82m9X//i1LB/lvbQOes2kK1OBvtAgHIRurRo4fm1bNnT3YM26+Bcs+ePRroAdBdu3YZo3jy7iUoodGpvpyZYZFUM7p57tvxpAYWJepuv1m68otunUywrMBpr2m5hGbVlvuJul3yA9SvOEQv7KrRohgBpfIOycoJ8QE+/K1bt47Wrl1LhYWFGhghPQ866CA6+OCDab/99qOioiJq3769FrW+XnwlgKfFXawMHHPMMVRSUqKtEHB/LqkBTLfJ36FCM4iAjTAyFF2ymILHDtIMKcjEMwvrWELWjr5a2ryJ3a4dJxOjf+2ppUu/9XaGzyvRCHKAEn7t2rXTAIln/rdz507CH48Dd/v27Ror7sf5Aoj4wxIVj7906VL64ovmM2FMcrwAJfKhsksIwqV46kxeDGXXESBV9jdiP2Pp4/aqq/opEyj88rNKhXqRSclr1u9tbDAwjiG9ejdmFtKSS0q4HTp0aAIYB1oyd9u2bQQwWq2degnK6kuGSe+ndGP/pCNAVl/0a+kZcsn9Twptrv3k7F9Sn81rje0s9P7kjmr648YdTWH13W+Tp0cPRolnTAbgrKio0LwRlgMVUhHvACHcL7/8sllXbeSDdy/Hk9jkWzPyIrNkLf2wYlL65CuW30U+KN9TA/uMsss1OHYgutN7XFWUhu+po1PYIrgsXdS+VJvgTNi8d6JhBhIzScnTQXg9iGXejXw5T+7u2LGD8OcGYeEcm0O80H2jndBeMschgAfgwol9SmUJWXX2UCljoVjikVkeKPjflRjPHtSJjistVGq/e7fsoSnf2y/R6IGnlIhgJLMfhWDUpME87boll/NgNLXsBfVFfH/S0poEgBll2cuFcDpQlLjKDOGHs0nKp7Vh0ajNwt3QqZx+37FNMz/jC4Bi9odwHERuuF4Cn2+hM5bNjXeZdkN6wAXwoUpqgGQ2vWUI56ZljqrqAVkXT2igVFURju3SjoZ3KJPJrhaWgxAvHExuuODB+UhnyiIC6ktfZxbBlLw141ys/WQINt9VSRqQuO0A9wDKEA7xO6EdTG8NSamqIvxz1/3o3HYlSlkwk54crEaXJ8D97d7dBqWnUlKy/YAP4ESF5AHJrt6QIZg3wexLhsx+7esjbJKzdlsLFaEo378e0IFOLy8WDZ40nB50RnCJviOcMWzShC0CoM68AiXaD+0oQ7iiRYWkJjW4lAj6Thkqe+lNaVs7fEJjls5PmUbmOTbRKYYZZQU6n+m9365S16CIJgmgAbSirijfZOG8muDAllDVMPON0VZ5KmH7FGQvd5JqVRyplCFoZNw2i/wZm+AM/3Yb/aDYk8kR0aMHdqSjSry/1NJMgnJpqHf14eRKYh7aKymJdkR7ypAsXsBbGJC4O1C7rk0iRzCJJ0tm3bWRx/tst/jI7yqN3kLvISa1Hu3ZkY4oCgmFdxoIgDP7A1+3wQieqD+ROkRYWZJtT+AFuJEhYUDiIkuZuwNhLFTFPqNoZb6ydRdNbBDOfrM6aRvw06yeFdQrxG5QSBN5AUZeFM+kZPcezArxaTyZ5C67a1LDTfKQTSGEWxS3qspQKkwFP7lpG83wyWtyUI6ubIcQuu/OQWVllUx1pDSsl1JStl1lcSMESNw3jUvPRQk2vVNhRhnnYV6ojdLDfrXZc++CIANlBbXJE6oG0eJnRDivpCTaVebGCuAG+BEloZbA5ecyBAPzqiTaZXP+K1asoHmBYno6Tw2U/dhYchaTlAE21sslkq1HmbLLtq8MfoQAGf3wHZn8arcdSEXQBVapyOXLl9PzwVJ6mQFThY5hs+5H2Zgy10ilLkXqALdZyJAMfpICErOkxkUfCKcPVVOqr97AORcccZ0dKqcFQTVQDmlTRA/0yC1QetVto31lVMHAj+hsOykgZcaOQC0uJUoHYf8gxpSzCtrRu4qgPKNtMd3bfe/xg3SUwe00ISG9kpKy7SyKo+SAZLYdZQg3ZKmS08rDeZO8vDx6oLgDfaIIyvP3K6V7enVRLULGxfNKSsq2M2yEilByQH7+qQgfLQzuDkzndW04hIWzJwDlfaUdaUlQbUnoorIQzTyqH/Xr1496sNOG+j8ci8VftpBXUlK7rJS1tyhFBXFkuwgH+46xVctF09QushQObBLQqYQESxxJxanAXr160X1tutCYys3Up1Fed/3rcCVFitrRq/v1arEBgqv+9EUQ8cOJRX5qUB/X62fUqxcHwnBxqehlocAR8OQrs/8x20rI6LKlUnWFW1UzgdasWUPffvstxZiknFG+P60Lqumuz6nfRaeEqzSJi7PY/A8SGM/c5c/6d70f/JcsWZIWMKI93Pihm7WrbHuL4MkWkLHly8zyYeoHES6zYGrKxEXP1atXa6CsD+bT39t1oy2BfCXuF9buoBMiNRr4ACz+FwgEmkDJ/cxcrAC8/fbb2plupQy4EMmrbhvtLTNEE8GTPSCZaT1RwuXnqjRjxgzq3bu36/v5Vq5cSfPnz6c1VTX0j/0OoN15arrr4VVb6OhIbTOJaJSAeNf74Rm2KfGXCeTV5Eam3WGqMRnZjiFhsF6UcAezDOFX+8QTT9DcuXM16YEG9Io++ugj2nXIIVR4YA/6w9ZvqUjSVAjyddWezdTIpOIXoZY7z43jR/wQVq1a5VVxlPh61W2j3UWNVIngyRKQifo6qYNcMAAgQpCGkyZNataFebnzhecJ2hxYj9hW0Y7+EopTns5UCg+TzP3djg00vaInrSgoMZ3ogD/An6kEULo9uRFtd9QJDoABV75C69UPS7Eke24m2TEFABEH5EePHt0CjKkAJCoE5kvmfLWCxkXUum4/2xY8csd6OrCxoWksiVk9QDhv3ryMBiPK70W3nazdka6ekuHKUkLGN23U87F99hUVW+4Mx6/y7LPPbgZCPbNUgVGf5qxlK2gn08qoqAoLWXd/xZY1NLm4ghYuX9Vko0fPP1Ofvei2sZMc7Z+oE7PjDlzl9TnUsoqsJSQ7QyFK/m4HtAiKwmOicuKJJ2YUGHlGX91dS9dvULMg0S4Ro9/t3EAFlfZGCHhameR6AkqT9rcqM87m2JE1ILd9bxev2Td/l27N3i+//HINiFgItiJIxnRIR31+5uysprGbduq9hJ+x2xzb1toF8oTjpDvgcccdR0OHDnW96za2v10540lwZQ3IHdvt+Db75u/UWXvnUhGz52SUbjDy/D28vYru/E5N0h1emK9tWyvwZ8deyuOPP54ASowlcbLTrTElb39ep3ZuPAmuLAGZ2L3XUJMdc/7N375CKxy6ZzupyMNnChh5fu7buoemMztAKvR/2l7KjipRUxpn/PjxdNttt2l/PGG3gIn2F6VkuLIGZKV4A904+1maOHGiUJ7MumpU1ltvvUVw00V3MaNUDzFpqUKDygrp4Qze4MvBaFU2p8DEBamilEiCK8tZdqJG7P6We1hDPvjZGtH8WI4b0Z3gD/Tuu+/Se++9pz2n8t84Np4sYt3vBWwLmiydxqxi3MesY1ynM5Yqy8OL8EYw8jo2S0vfhcuY+POVtTFjZ+qXDFfWEpItYCYjgHHqd7uED+1bddX6xVp0K9D9pktajmYz75fZDFyFzmH2g+7qtp9KVNfjYKyIXgf1KUMAJf8Tjecrbqm9soqLhXE7sgZk2N4EHgejHXP9N7Oumn83+9WiImOxWFqAOXLdNlpYaV9xPO9G99L2ZTSOWVxLF3Eg4kdtVq+i+ZLpxn0h8d1UiSS4sgQkRa0vI5IFo2glGMNVVVVpv3AOzFRKzeFrt9K/Je5T1Of9GmaTcjSzTZlKcguIxjwDmFgqsl2/DEpovmxwhbStAWmh61UBo510REVa0VdffUVff/014bo3PkPk4LSK45Z/LMGMpTJra4vr7HsKq/T+2LktjawQH1tZ8bHzR915BUR9ugCj7fql3xpGej7aswWueDhrTmzh2owwZnSTrLoVfucg9hPimrdFixY1gXPUqFFad85n5nagdpLX6licRjC7lCsaIkpsxu/fji5m9s7dJCMIZbtmTBhVyVJaylxYZYErnifLWTYFmBhmtln0BOmoQlaTGTte/K5BfRiAE3+ccDcM/vjAnS893X777TyIY3cLu7IO1tZg67wbM78iS1O6tSdYAeaXOsnGR3iAkJfR6gcsyte26xVgwqVls6uTG62Hdy1YAlc2ZFnDvlCIEgZAqkhHFTBy6WiTb+0TBy13R4wYoflDgi5evLhp3OMUoN+yyz1hwRd2KVVUhX9jy0F1TIr8k90qkYy4tHcLgMnSU/0OaQkCMBNhcQtnwJUdWRosrfrV8c1sstiNHdlwy3LpJ9nGW3S7xl89AMlBZpf5ZN/atGmj3YuNcLgfWw9SlbVOaGWe7dWJVFWF+ovnOfBQdr7sZayHZOVT+Y5jFm4S8j5//C1Ue+NIIbb+Dh2pbO67lmGtJWQJG/tIGAmyTEHhA2bXbpCxiw+xX+eQIUMIQOXSlAMV6em7M+NYCwv1n7BL4zH7nsNAqUJz+h5A7djFUcEf91eJ7jiOsUyOGTIGqLMpY2vpGkFmPuDKhqwB2ab5ssUihSUQke4aBUqFZNDXgRlQ8R37Nvv27asF5V2mPh5/Dr/9OlWNEW0CHostaUTCVPXHkdTm749T4OBDfviQoic+xnY7uR1rVhOxCZwI+Qy4MsaxnGUb9ZMfKQDSmJjZuxe/WrN0RPwAVCwzJaPQCSdR6e33JAtm+j2+aydVse4ttmm96XevPE844QTP1LGdguLDACOujOW1BKS/fQdjWE/e0RUaf7ldu3b1JC0RpgClyKSq4NQzqeRmtdl8jJ0tqbrxdxTfKb7FTyTvVmG8BCPS3F9i9SEZrqwBWbF3j6NVId30xyxYD0qM69JJomPYQmYEvvi6m5SyGmX3AgKUolv/VRJB7+M1GJGv7jKATIIra0CysxKiZL6ELhp7bziAEjNADsxu3ZrvQpfj5iw0pKQoFV18BRVfca1o8GbhGr/8XAMlO8LYzN/pCwfi4MGDPeum9Xk8kFkiFqVkt3JYA7JregDBpSW67UMPPVS0nGkNV3TVH6jwwsuU8hBhJo8xpnSL8INOFRCRZygLSvyWMGpRLH8SXFly8nfv2YzZ0UluZDWTksYD9M0Y2rxwaTl9+nR64403KNXSEstCslQy6k9UeNb5stG08OH33qSqcTcoxUUkLhHRw6DuUkl92TEOGTLiyhjXetmHHebGVbP81tcb2WaBYQozbYBSZPnHmDG888pFhWNpCBoYjO/cWDQ3S4/7qY5hS/40UTsI3/DPVzgrYTfM7nSpZnVeesteDYhIRNQLJGI6NjPz/B0ucd8P8GRnJAA8LSUkPub16g3HEQGQqpKSJ4wKBzjbtm1LF198sSY1YQsSklNFmnG+Vq6TWX7pxL9QaNBQK9a2/g0vPUM10+60DcOlISYrqeyarTL1k6J8q08t/EXwZCkhwS2vT19qfP8tjTG6bPxZrUeiy7YamjuRklriun8Ap14i8D2SRx55JB1++OFaSEhRmYmJjr0rw4Oye/5Blb+/lCIf/1vPWui5fvYsTYoU/+9+cQAQlG5JqGXC5N/PisU35wJPychSl42IMCJUO/qqJh4A47CV3zW9Gx/iRg/DO7pu1e7bwMryFTpidO8g6Fn79++vdfOaB/vHl3SsADtgwAAe1JGbaKinymsuocYli5X4PM0M+N/w8edKcVMV6cesu369Txfh5IqnPkDBowfahrcFJCyeVp7UvIEASCspabfJguciFaDkaeldPVDhn4oNDdDKQFJGV36jz4rw8y3s0NksxZOQwok4CIid8TLHNdq8viipBV1bQCKv1Ref2cyss52UFAEkeKYLlEjbjvgOHH0YLm31fnbPvIvlYdYu+lDbttZD8V7FUewU4zO7aji7jHKxHW9gktUXnuE8prsvfeJl/mrp2o4hESvwkyObARLjyNHsEJPZ3ki7caQ+B3yik2nA1I9NeX7N/Pg3URdHIbBtrUJC58t5T2d7KWvZBt95e9ROQnI+bru4jk8UjEgbOBIh21m2xsjEbjjOi1itS5qtR1plBMCMs42rTmfhVvwzxf+b+oi2ba1GZqu/LvMPMSMEg8usbSrqgqbscSi7aEqGRO2RJwcks7RvRi/17mIJSrPwdn5cYuYyMJ1ePD+LXRI6IAUXz9u1k/7bL5lhBBkKWODIyCMpIH3MKFFwwLHGeNo7FsuNJCMh9XH1oMxVYH7AVilwFEKFcPH8rBRePG+XRxzjOEVCQgI/wJEIJQUkmASOGWTKC902JKWRVEEJPrkOzAXMAMHv1qltO8PF87gk9CCJzQzGtnHjfRgz9ipDVvgx4yEEyODAE8zian5WoLSMIPghl4H50u4aunGjmrFU7D2EpOySxovnz2YmY2TIDj9GPkKAxMEcuzEAQLnlp72axpROJKQxgxyYuTb5eWpHNY3frHbGHRfPY0yZjovnj2bjWNwxLkrADfAjSkKABLP8E09OyhPdN5aEQG6CkicMcOYSMB/YVkl3K551BygeZRZ8g0kO3vO6c8u9UNLwgQhu9HkTBmRwyGns7uHkinQsCQGUXgCSZzyXgDmNGUqdsVV8QzCvA7iQVpCUqSKYsR7WVqK7ZnjRcCORQWFAYpaUf8qvhFinApTISK4AczIzT6OqIhzC1idVbpMQakhDoMs6yB0tAV5EZ9c8KWFAIkI+O9gkSgDlVjauPPSA7qJRlMPlAjCht35mp5qKEBfPT/P44nnsDB8hC0gJvPDGlwJk4Ij+FOj3Mx5XyP3oyos12zRCgR0GynZgjtqwXVlFeB6z+ntHV++MpWIjhQwBJ8CLLEkBEszzf32OVBrhl+bQgvv/Rm+++Sb16NFDKq5q4GwG5hVM7/1WVXIbQGZ1czmTYLd0aamsMAsr44djCjDEKkOyOOG85QF50umU7FwEZ87dhln3a9u9cCklLEJ4vSeSpwtg8j/ulw0urK0tYmZbVOi6juU0ymVjqTdI8gM+8hlOVEgakEgkdM5FUmk1vvN6085zWMsKM7O+2OqVCmByQMLNFoqwvELFuFTRWOrNbPx+heR4z6puoCKEQX8ZksWHnrcaIM86TzsApmeU7Llh5vRmQXCaMNXAzKY1zD3MWCq2ra1ukLC9qKvhSWw8qXKbhI6F9niz5BAAB7lCDB+qpARIJBa6YIRUmrG1q6lh5rQWcVqB2aJKmjw2R6LatrXvGqNNfjIPU9nM+0xJvbOe/58YGPsUJF971seRxYU+Lp7VAXnmb0n2atqGxx+k6Bf/NeZBe+fATNUYE114NkjMVUxCYkxZySSmCt3fo4Jk9y4inaPYovsf2HhUhoCHEMOFE1IGJBItuPRq6bTrkxzz5GNMDkyvx5l8jCldkBRGWMLGkhhTNiqOgx9lmzF+IXjUAMXCeaM5x/1cuoQqeDAm4giQwcEns1Nkxxl52r7H2IGn+qnJD8NzYI4bN87zmXk2SMuPYCyVSUoVymN6XGxb619svSkCIFy4cCE1NDTQqycNpMLvNkolBRwAD04p6SGvZAnEVnxF1ZeenSxYi+9FY++U0vyAAexar1+/nnDbrJez5kw766OvvF+xMeGDrBtWIRjwh1lpfqsEQIgfPj+BCZ6R+S9T3R23SLMvfexF7Ry/dERDBMeABL+G+++lhiceMrBO8urPo9KHn6G8Hx2WJKD5Zz04EcJtgGYyKKGVUVUVfu8PUOWYiXTUGS3VwLFvllH15WwMGI+ZV7qFbwGzAFcwUt02kZ6tK4AEw+rzTyfMpGUor+dBVPLAbPKVymkBjGkAnKBJkyZprpvgzFRgYqPDZEVVYV7vH1HJXx8hX/kPWp1EdRXVXHWBUhuWPj1Pq3c3/rkGyOjHH1DN9VdK5wmWDGDRwE0yAhS8nYA0U0EJrYyqqjDw459S8V8fJn5PISyUwFKJLJVMe5ACR5mfuZLlhfCuARLM6mdMofDTj+JRivJPG0ZFt06WiiMTmAN07ty5tGTJkqaosiBNdsVJE2OPH/iYD+459bup4u1/KqUYOOoXVDLtIaqbfCtFXntJmkfo/OFUeO0Y6Xh2EVwFJBKqvuxcin291C5N02+h8y6lQkXzyKYMk3ji9gd+DQiAunTp0hZS1AywqZKWetChKMZ3ffHqp/+Zws8+ofcSfvZ3O4DiG9cLh+cB8/oeQaWPPMtfXXNdB2Rsxdds1n2WUgYLLrmSCq6+Ximum5H0YOV84QcTgJzKy8ubAM39zFwOJOM3vb/VszGO3Xvdn2+jyNzn7YK4+s2tWbUxU64DEglEXn2e6u66zZiW0HumgFIosxkWqO62GynyxnzPc1V080TKP+M3nqTjaGHcKkfIrOqOD6gX6++724p1q79NDRQxY6nBY0+wCeH8E9rVKzAid55ISF7s2hvYzG2R/MwN8b2e6PA85pzL7AfV/OEyiv73Y9eLFhzAVkTudXdFxJhJTwEJ+5I1V18kvbbFM4kloaIJ9zhep+T89hU3UVujgTL2lfzk0qqOtDXjmU8mte9oFV/U35MumyfuKyunoklTKdn9djy80cW6mLZYyzQIrSReA77iEiq+62+Ud+DB4pFsQqL9tHZk7ek1eQpIZB6Gzosns825igfaof2BOgs61lYSrwFc4VZ814xm2hjx2LqQrN3QfiIG63WxlB89ByRyBtuAqBxlYrpVKPxFdgkpp5GDEcPPPUmJPbsdlQztJmrb0VFC/4vs6RjSmMHGtxZQ7Vhn64zQwxZef4v0cVxjXnL5HZugse8UW/2cUPEd01zZUiaTh5QCEhlzA5Tg07peiVpoSTgmgqUzp5QOMCLPKQckEsXdN7U3swsrFXdAgwcIM78Cdp9LcODgvR778H/UKQ7Sye64alFlGDOybjpddZoWQKISop99QrW3jqJE5Q/quBaVI+gRHHQSFYwYKX3GR5B9RgeLsWuOce4dR42dEmbTmMCkcsxozHPaAImMxNaspLpxo53/qv9XqtCw8yjEbmVNdgWusRKy8T3+/WYKP/UIwTKIG4TeBks7qZpNW+U5rYBEprB4XjfhJmWNjlnBQuxi9dBvLmQWNnqYfc5qv/iGdRR+/ikKvzDbtXJAA1M04W7PF71FMpx2QPJMYlaIZQo3KX/oaZreNdBf/gSdm/lwg1d08X+0TSuRha+5wa6JB3TTWLXIFMoYQKJCnOwSsqtQnNvJP/kMyh96qvOFYruEXP6GNcTIwvkUWfAq4byL2+Tlrh3VvGYUIFEI7Kesm3K70iZfkUrA7DF4/BAK/mJQRurIcbal8d/vUOO7bzTZQxIpl0wYbK4tGjPelVOCMumKhM04QPJMqx6H4PFF3MCRAyjIjLJjVql6+lEknWRhIP2w6tD4nw8p+umiZMEdfffi2IGjDBkiZywgkU8cHKu/b4prs3BD2Zu94uRj4PB+BOkBbRDMgngxW8fsGEs10KLgqEf0yy8IUtFrwiy68Loxrh7I8iLPGQ1IXmClc988sgPXV1RMOHPi79KN/J06k799BfnaMoP+ZW0IO2q0E3vBILOQxLYE4B7DxkZKhBsI278SVZWU2L2L4ju2UXzL9xRnliBwdiVRl/pLNN08N+2gOoWiZgUgURJYyGh4cAY7qvmeUMFaA7FLM5h5k4Irr2VjxUOzpjqyBpC8RqELb3hsptbtcb9Wt3kNYLgBw09u2Nppztn7t6wDJK+S8MvPUHj2LIpvljOKxOPnoqsZC2V2O52axEtn3WQtIHmlhV+coy2oxzes5V77nAub3ljgdmK5NlMqLesBySsy8vo8irzynKVBVB4ul1xcvYHbDlQNzGdiXeQMIHnlRpcu1o47RP41l816I9w7d1x2XRtuyMIlVir3wGR6ReQcIHmFJ5jhzcY3XqPImwsoyhacs51wqyoussTdgbLXtWVT2XMWkPpGiG9n5pDff5uiHzKV3KIP9J8y+jk44FjC5ee4b1rmit+MLlSSzO0TgNTXASQnJCZUddHPP6XYquX6z2l9zjv4EAr85EhNlQmJmMuS0Kqi9zlAGisC+zGjy5ZSbPkybWMHNg2nYikJSzTYDJvXpy/lHXIYBQ47IiP2IxrrJ9Xv+zwgzSo8UV9HWEaKb2LqPqZ7jm9jqr8d2zVVII5cJGqqCWES7EYyirKLjXA2COfOA0GmTgyRr7CIfCWlmoEEqBpxRtpfwVSPnfcnf1emhmTLNAjTSi1roBWQLeuk1SeNNZASQwFpLF9r0llWA62AzLIGy/XstgIy11s4y8rXCsgsa7Bcz24rIHO9hbOsfP8P/EvUUlLXk84AAAAASUVORK5CYII=",
                "swagger": {
                  "basePath": "/api/v2/",
                  "host": "api.abuseipdb.com",
                  "info": {
                    "description": "",
                    "title": "Default title",
                    "version": "1.0"
                  },
                  "paths": {
                    "/blacklist": {
                      "get": {
                        "description": "The blacklist is the culmination of all of the valiant reporting by AbuseIPDB users. It's a list of the most reported IP addresses.",
                        "operationId": "[variables('_operationId-blacklist_endpoint')]",
                        "parameters": [
                          {
                            "default": 25,
                            "description": "abuseConfidenceScore is our calculated evaluation on how abusive the IP is based on the users that reported it. We place a hard minimum of 25% on the abuseConfidenceScore",
                            "in": "query",
                            "name": "confidenceMinimum",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "default": 10000,
                            "description": "The number of IP addresses included in the list is capped to a hard limit, depending on your subscription. You can set the limit between 1 and your hard limit using the limit parameter. If you always want the largest list available, setting the limit to 500,000 will guarantee the max size allowable by your subscription, since 500,000 is the max limit for the highest tier.",
                            "in": "query",
                            "name": "limit",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "description": "You can also filter by country. Both the onlyCountries and exceptCountries parameters accept a comma delineated list of ISO 3166 alpha-2 codes. The onlyCountries parameter retrieves IPs that only originate in the given country or countries.",
                            "in": "query",
                            "name": "onlyCountries",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "description": "You can also filter by country. Both the onlyCountries and exceptCountries parameters accept a comma delineated list of ISO 3166 alpha-2 codes.  The exceptCountries parameter retrieves all IPs except those that originate in the given country or countries.",
                            "in": "query",
                            "name": "exceptCountries",
                            "required": false,
                            "type": "integer"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "properties": {
                                "data": {
                                  "description": "data",
                                  "items": {
                                    "properties": {
                                      "abuseConfidenceScore": {
                                        "description": "abuseConfidenceScore",
                                        "format": "int32",
                                        "type": "integer"
                                      },
                                      "ipAddress": {
                                        "description": "ipAddress",
                                        "type": "string"
                                      },
                                      "lastReportedAt": {
                                        "description": "lastReportedAt",
                                        "type": "string"
                                      }
                                    },
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "meta": {
                                  "description": "meta",
                                  "properties": {
                                    "generatedAt": {
                                      "description": "generatedAt",
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "BLACKLIST Endpoint"
                      }
                    },
                    "/check": {
                      "get": {
                        "description": "The check endpoint accepts a single IP address (v4 or v6). Optionally you may set the maxAgeInDays parameter to only return reports within the last x amount of days.  The desired data is stored in the data property. Here you can inspect details regarding the IP address queried, such as version, country of origin, usage type, ISP, and domain name. And of course, there is the valuable abusive reports.",
                        "operationId": "[variables('_operationId-check_endpoint')]",
                        "parameters": [
                          {
                            "description": "IP Address",
                            "in": "query",
                            "name": "ipAddress",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "The maxAgeInDays parameter determines how far back in time we go to fetch reports. In this example, we ask for reports no older than 90 days. The default is 30.",
                            "in": "query",
                            "name": "maxAgeInDays",
                            "required": false,
                            "type": "integer"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "OK",
                            "schema": {
                              "properties": {
                                "data": {
                                  "description": "data",
                                  "properties": {
                                    "abuseConfidenceScore": {
                                      "description": "abuseConfidenceScore",
                                      "format": "int32",
                                      "type": "integer"
                                    },
                                    "countryCode": {
                                      "description": "countryCode",
                                      "type": "string"
                                    },
                                    "countryName": {
                                      "description": "countryName",
                                      "type": "string"
                                    },
                                    "domain": {
                                      "description": "domain",
                                      "type": "string"
                                    },
                                    "hostnames": {
                                      "description": "hostnames",
                                      "type": "array"
                                    },
                                    "ipAddress": {
                                      "description": "ipAddress",
                                      "type": "string"
                                    },
                                    "ipVersion": {
                                      "description": "ipVersion",
                                      "format": "int32",
                                      "type": "integer"
                                    },
                                    "isPublic": {
                                      "description": "isPublic",
                                      "type": "boolean"
                                    },
                                    "isWhitelisted": {
                                      "description": "isWhitelisted",
                                      "type": "boolean"
                                    },
                                    "isp": {
                                      "description": "isp",
                                      "type": "string"
                                    },
                                    "lastReportedAt": {
                                      "description": "lastReportedAt",
                                      "type": "string"
                                    },
                                    "numDistinctUsers": {
                                      "description": "numDistinctUsers",
                                      "format": "int32",
                                      "type": "integer"
                                    },
                                    "reports": {
                                      "description": "reports",
                                      "items": {
                                        "properties": {
                                          "categories": {
                                            "description": "categories",
                                            "items": {
                                              "format": "int32",
                                              "type": "integer"
                                            },
                                            "type": "array"
                                          },
                                          "comment": {
                                            "description": "comment",
                                            "type": "string"
                                          },
                                          "reportedAt": {
                                            "description": "reportedAt",
                                            "type": "string"
                                          },
                                          "reporterCountryCode": {
                                            "description": "reporterCountryCode",
                                            "type": "string"
                                          },
                                          "reporterCountryName": {
                                            "description": "reporterCountryName",
                                            "type": "string"
                                          },
                                          "reporterId": {
                                            "description": "reporterId",
                                            "format": "int32",
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "totalReports": {
                                      "description": "totalReports",
                                      "format": "int32",
                                      "type": "integer"
                                    },
                                    "usageType": {
                                      "description": "usageType",
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "422": {
                            "description": "The max age in days must be between 1 and 365."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CHECK Endpoint"
                      }
                    },
                    "/check-block": {
                      "get": {
                        "description": "The check-block endpoint accepts a subnet (v4 or v6) denoted with CIDR notation.",
                        "operationId": "[variables('_operationId-check_block_endpoint')]",
                        "parameters": [
                          {
                            "description": "Due to the depth & breath of the these searches, the range of the parameters is capped by plan tier.  For most use cases, /24 is enough to an entire network. Many autonomous systems will sometimes have blocks of /20. Some of the largest autonomous systems will have blocks of /18 or /17.",
                            "in": "query",
                            "name": "network",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "The maxAgeInDays parameter determines how old the reports considered in the query search can be.",
                            "in": "query",
                            "name": "maxAgeInDays",
                            "required": false,
                            "type": "integer"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "properties": {
                                "data": {
                                  "description": "data",
                                  "properties": {
                                    "reportedAddress": {
                                      "description": "reportedAddress",
                                      "items": {
                                        "properties": {
                                          "abuseConfidenceScore": {
                                            "description": "abuseConfidenceScore",
                                            "format": "int32",
                                            "type": "integer"
                                          },
                                          "countryCode": {
                                            "description": "countryCode",
                                            "type": "string"
                                          },
                                          "ipAddress": {
                                            "description": "ipAddress",
                                            "type": "string"
                                          },
                                          "mostRecentReport": {
                                            "description": "mostRecentReport",
                                            "type": "string"
                                          },
                                          "numReports": {
                                            "description": "numReports",
                                            "format": "int32",
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "402": {
                            "description": "Exceeding a parameter limit will return a 402 Payment Required response."
                          },
                          "422": {
                            "description": "The max age in days must be between 1 and 365."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CHECK-BLOCK Endpoint"
                      }
                    },
                    "/clear-address": {
                      "delete": {
                        "description": "The clear-address endpoint accepts a single IP address (v4 or v6).  The only property it returns is the number of reports deleted from your account. This endpoint is ONLY used to delete reports for an specific address from YOUR account. It cannot delete another user's reports. If this is what you are looking to do, the correct channel is the takedown request form available on an IP's web page.",
                        "operationId": "[variables('_operationId-clear_address_endpoint')]",
                        "parameters": [
                          {
                            "description": "IP Address",
                            "in": "query",
                            "name": "ipAddress",
                            "required": true,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "properties": {
                                "data": {
                                  "description": "data",
                                  "properties": {
                                    "numReportsDeleted": {
                                      "description": "numReportsDeleted",
                                      "format": "int32",
                                      "type": "integer"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint."
                          }
                        },
                        "summary": "CLEAR-ADDRESS Endpoint"
                      }
                    },
                    "/report": {
                      "post": {
                        "description": "Reporting IP addresses is the core feature of AbuseIPDB. When you report what you observe, everyone benefits, including yourself. To report an IP address, send a POST request. At least one category is required, but you may add additional categories using commas to separate the integer IDs. Related details can be included in the comment field.",
                        "operationId": "[variables('_operationId-report_endpoint')]",
                        "parameters": [
                          {
                            "description": "IP Address",
                            "in": "query",
                            "name": "ip",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Comma separated values; Reference: https://www.abuseipdb.com/categories",
                            "in": "query",
                            "name": "categories",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "description": "Related information (server logs, timestamps, etc.)",
                            "in": "query",
                            "name": "comment",
                            "required": false,
                            "type": "string"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Ok",
                            "schema": {
                              "properties": {
                                "data": {
                                  "description": "data",
                                  "properties": {
                                    "abuseConfidenceScore": {
                                      "description": "abuseConfidenceScore",
                                      "format": "int32",
                                      "type": "integer"
                                    },
                                    "ipAddress": {
                                      "description": "ipAddress",
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "401": {
                            "description": "Authentication failed."
                          },
                          "429": {
                            "description": "Daily rate limit of requests exceeded for this endpoint. You can only report the same IP address (`127.0.0.2`) once in 15 minutes."
                          }
                        },
                        "summary": "REPORT Endpoint"
                      }
                    }
                  },
                  "schemes": [
                    "https"
                  ],
                  "security": [
                    {}
                  ],
                  "securityDefinitions": {
                    "API Key": {
                      "in": "header",
                      "name": "Key",
                      "type": "apiKey"
                    }
                  },
                  "swagger": "2.0"
                }
              },
              "type": "Microsoft.Web/customApis"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "AbuseIPDBAPIConnector",
                "kind": "LogicAppsCustomConnector",
                "parentId": "[variables('playbookId')]",
                "source": {
                  "kind": "Solution",
                  "name": "AbuseIPDB",
                  "sourceId": "azuresentinel.azure-sentinel-solution-abuseipdb"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com/",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {
            "_operationId-blacklist_endpoint": "[variables('operationId-blacklist_endpoint')]",
            "_operationId-check_block_endpoint": "[variables('operationId-check_block_endpoint')]",
            "_operationId-check_endpoint": "[variables('operationId-check_endpoint')]",
            "_operationId-clear_address_endpoint": "[variables('operationId-clear_address_endpoint')]",
            "_operationId-report_endpoint": "[variables('operationId-report_endpoint')]",
            "operationId-blacklist_endpoint": "blacklist_endpoint",
            "operationId-check_block_endpoint": "check_block_endpoint",
            "operationId-check_endpoint": "check_endpoint",
            "operationId-clear_address_endpoint": "clear_address_endpoint",
            "operationId-report_endpoint": "report_endpoint",
            "playbookContentId": "AbuseIPDBAPIConnector",
            "playbookId": "[resourceId('Microsoft.Web/customApis', parameters('customApis_AbuseIPDBAPI_name'))]",
            "workspace-location-inline": "[resourceGroup().location]",
            "workspace-name": "jim-law-001",
            "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          }
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0.0",
      "properties": {
        "description": "PaloAlto-HighRiskPorts_HuntingQueries Hunting Query with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2020-08-01",
              "location": "switzerlandnorth",
              "name": "PaloAlto-PAN-OS_Hunting_Query_1",
              "properties": {
                "category": "Hunting Queries",
                "displayName": "Palo Alto - high-risk ports",
                "eTag": "*",
                "query": "\nlet HighRiskPorts = datatable (Port:int, Protocol:string, RiskType:string, RiskDescription:string)[\n13,\"udp\",\"3rd Party Attacks\",\"Daytime protocol used in reflection/amplification attacks\",\n17,\"udp\",\"3rd Party Attacks\",\"QOTD protocol, reflection/amplification attacks\",\n19,\"udp\",\"3rd Party Attacks\",\"Chargen protocol, reflection/amplification attacks\",\n20,\"tcp\",\"Unencrypted\",\"Unencrypted FTP Traffic\",\n21,\"tcp\",\"Unencrypted\",\"Unencrypted FTP Traffic\",\n22,\"tcp\",\"Management\",\"SSH, brute force attacks common\",\n23,\"tcp\",\"Management\",\"Telnet, allows unauthenticated and/or unencrypted\",\n53,\"udp\",\"3rd Party Attacks\",\"DNS, reflection/amplification attacks\",\n69,\"udp\",\"Management\",\"TFTP, allows unauthenticated and/or unencrypted\",\n111,\"udp\",\"Management\",\"RPC, unencrypted authentication allowed\",\n111,\"tcp\",\"Management\",\"RPC, unencrypted authentication allowed\",\n119,\"tcp\",\"Unsecure\",\"NNTP, unencrypted authentication\",\n123,\"udp\",\"3rd Party Attacks\",\"Network Time Protocol, reflection/amplification attacks\",\n135,\"tcp\",\"Management\",\"End Point Mapper, multiple remote management srvcs\",\n135,\"udp\",\"Management\",\"End Point Mapper, multiple remote management srvcs\",\n137,\"tcp\",\"Hacker Recon\",\"Netbios Name Service\",\n137,\"udp\",\"Hacker Recon\",\"Netbios Name Service\",\n138,\"tcp\",\"Hacker Recon\",\"Netbios Datagram Service\",\n138,\"udp\",\"Hacker Recon\",\"Netbios Datagram Service\",\n139,\"tcp\",\"Hacker Recon\",\"Netbios Session Service\",\n161,\"tcp\",\"Unsecure/3rd Party Attacks\",\"SNMP, unsecure / no authentication UDP Reflection attacks\",\n161,\"udp\",\"Unsecure/3rd Party Attacks\",\"SNMP, unsecure / no authentication UDP Reflection attacks\",\n162,\"tcp\",\"Unsecure\",\"SNMP Trap, unsecure / no authentication\",\n162,\"udp\",\"Unsecure\",\"SNMP Trap, unsecure / no authentication\",\n389,\"tcp\",\"Hacker Recon/3rd Party Attacks\",\"LDAP/CLDAP\",\n389,\"udp\",\"Hacker Recon/3rd Party Attacks\",\"LDAP/CLDAP\",\n443,\"udp\",\"3rd Party Attacks\",\"UDP Reflection / Amplification attacks\",\n445,\"tcp\",\"Unsecure\",\"SMB - well known attack vector\",\n512,\"tcp\",\"Management\",\"Rexec on Linux, remote commands w/o encrypt auth\",\n514,\"tcp\",\"Management\",\"Remote Shell, remote commands w/o auth or encrypt\",\n593,\"tcp\",\"Management\",\"HTTP RPC EPMAP, unencrypted remote procedure call\",\n593,\"udp\",\"Management\",\"HTTP RPC EPMAP, unencrypted remote procedure call\",\n636,\"tcp\",\"Hacker Recon\",\"Lightweight Directory Access Protocol\",\n873,\"tcp\",\"Management\",\"Rsync, unencrypted file transfer\",\n1433,\"tcp\",\"Data Access/Mgmt\",\"MS SQL Management & Data Access\",\n1434,\"udp\",\"Data Access/Mgmt\",\"MS SQL Monitor Port\",\n1900,\"udp\",\"Hacker Recon/3rd Party Attacks\",\"Simple Service Discovery Protocol, unencrypted\",\n2049,\"tcp\",\"Unsecure\",\"Network File System\",\n2049,\"udp\",\"Unsecure\",\"Network File System\",\n2301,\"tcp\",\"Hacker Recon\",\"Compaq Management Service, no recent incidents\",\n2381,\"tcp\",\"Management\",\"Compaq Management Service, no recent incidents\",\n3268,\"tcp\",\"Hacker Recon\",\"Microsoft Global Catalog LDAP\",\n3306,\"tcp\",\"Data Access/Mgmt\",\"MySQL Database Management Port\",\n3389,\"tcp\",\"Management/3rd Party Attacks\",\"RDP, Common brute force attack port\",\n3389,\"udp\",\"Management/3rd Party Attacks\",\"RDP, Common brute force attack port\",\n4333,\"tcp\",\"Data Access/Mgmt\",\"MSql\",\n5353,\"udp\",\"3rd Party Attacks\",\"mDNS\",\n5432,\"tcp\",\"Data Access/Mgmt\",\"PostgresSQL Database Management\",\n5800,\"tcp\",\"Management\",\"VNC Remote Frame Buffer over HTTP\",\n5900,\"tcp\",\"Management\",\"VNC Remote Frame Buffer over HTTP\",\n5985,\"tcp\",\"Management\",\"Windows Powershell\",\n5986,\"tcp\",\"Management\",\"Windows Powershell\",\n6379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n7000,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n7001,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n7199,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9042,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9160,\"tcp\",\"Data Access/Mgmt\",\"Cassandra\",\n9200,\"tcp\",\"Data Access/Mgmt\",\"Elastic Search\",\n9300,\"tcp\",\"Data Access/Mgmt\",\"Elastic Search\",\n9987,\"udp\",\"3rd Party Attack\",\"DSM/SCM Target Interface\",\n11211,\"udp\",\"Unencrypted\",\"Memcached\",\n16379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n26379,\"tcp\",\"Data Access/Mgmt\",\"Redis\",\n27017,\"tcp\",\"Data Access/Mgmt\",\"MongoDB\",\n];\nHighRiskPorts\n| join kind=inner (\n  CommonSecurityLog\n  | where DeviceVendor == \"Palo Alto Networks\" and Activity == \"TRAFFIC\" and DeviceAction != \"deny\"\n  | where SentBytes > 0 and ReceivedBytes > 0\n  //Remove private IP communation from DestinationIP\n  | extend result = ipv4_is_private(DestinationIP) \n  | where result == 0\n  | summarize\n      Count = count(),\n      StartTime = min(TimeGenerated),\n      EndTime = max(TimeGenerated)\n      by \n      DeviceName,\n      SourceIP,\n      DestinationIP,\n      DestinationPort,\n      Protocol\n) on $left.Port == $right.DestinationPort and $left.Protocol == $right.Protocol\n| project-away Protocol1, Port\n| order by DeviceName asc, SourceIP asc, DestinationIP asc, DestinationPort asc\n| extend timestamp = StartTime, IPCustomEntity = SourceIP\n",
                "tags": [
                  {
                    "name": "description",
                    "value": "Identifies network connections whose ports are frequent targets of attacks and should not cross network boundaries or reach untrusted public networks.\nConsider updating the firewall policies to block the connections."
                  },
                  {
                    "name": "tactics",
                    "value": "InitialAccess,Discovery"
                  }
                ],
                "version": 2
              },
              "type": "Microsoft.OperationalInsights/savedSearches"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/HuntingQuery-0a57accf-3548-4e38-a861-99687c958f59",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "0a57accf-3548-4e38-a861-99687c958f59",
                "description": "PaloAlto-PAN-OS Hunting Query 1",
                "kind": "HuntingQuery",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.OperationalInsights/savedSearches/0a57accf-3548-4e38-a861-99687c958f59",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0.0",
      "properties": {
        "description": "PaloAlto-UnusualThreatSignatures_AnalyticalRules Analytics Rule with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "switzerlandnorth",
              "name": "89a86f70-615f-4a79-9621-6f68c50f365f",
              "properties": {
                "description": "Identifies Palo Alto Threat signatures from unusual IP addresses which are not historically seen. \nThis detection is also leveraged and required for MDE and PAN Fusion scenario\nhttps://docs.microsoft.com/Azure/sentinel/fusion-scenario-reference#network-request-to-tor-anonymization-service-followed-by-anomalous-traffic-flagged-by-palo-alto-networks-firewall",
                "displayName": "Palo Alto Threat signatures from Unusual IP addresses",
                "enabled": false,
                "entityMappings": [
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "SourceIP",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "query": "let starttime = 7d;\nlet endtime = 1d;\nlet timeframe = 1h;\nlet HistThreshold = 25; \nlet CurrThreshold = 10; \nlet HistoricalThreats = CommonSecurityLog\n| where isnotempty(SourceIP)\n| where TimeGenerated between (startofday(ago(starttime))..startofday(ago(endtime)))\n| where DeviceVendor =~ \"Palo Alto Networks\"\n| where Activity =~ \"THREAT\" and SimplifiedDeviceAction =~ \"alert\" \n| where DeviceEventClassID in ('spyware', 'scan', 'file', 'vulnerability', 'flood', 'packet', 'virus','wildfire', 'wildfire-virus')\n| summarize TotalEvents = count(), ThreatTypes = make_set(DeviceEventClassID), DestinationIpList = make_set(DestinationIP), FirstSeen = min(TimeGenerated) , LastSeen = max(TimeGenerated) by SourceIP, DeviceAction, DeviceVendor;\nlet CurrentHourThreats =  CommonSecurityLog\n| where isnotempty(SourceIP)\n| where TimeGenerated > ago(timeframe)\n| where DeviceVendor =~ \"Palo Alto Networks\"\n| where Activity =~ \"THREAT\" and SimplifiedDeviceAction =~ \"alert\" \n| where DeviceEventClassID in ('spyware', 'scan', 'file', 'vulnerability', 'flood', 'packet', 'virus','wildfire', 'wildfire-virus')\n| summarize TotalEvents = count(), ThreatTypes = make_set(DeviceEventClassID), DestinationIpList = make_set(DestinationIP), FirstSeen = min(TimeGenerated) , LastSeen = max(TimeGenerated) by SourceIP, DeviceAction, DeviceProduct, DeviceVendor;\nCurrentHourThreats \n| where TotalEvents < CurrThreshold\n| join kind = leftanti (HistoricalThreats \n| where TotalEvents > HistThreshold) on SourceIP\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P7D",
                "requiredDataConnectors": [
                  {
                    "connectorId": "PaloAltoNetworks",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "severity": "Medium",
                "status": "Available",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "tactics": [
                  "Discovery",
                  "Exfiltration",
                  "CommandAndControl"
                ],
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0
              },
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/AnalyticsRule-89a86f70-615f-4a79-9621-6f68c50f365f",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "89a86f70-615f-4a79-9621-6f68c50f365f",
                "description": "PaloAlto-PAN-OS Analytics Rule 1",
                "kind": "AnalyticsRule",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.SecurityInsights/AlertRuleTemplates/89a86f70-615f-4a79-9621-6f68c50f365f",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0.0",
      "properties": {
        "description": "PaloAlto-PAN-OS data connector with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2021-03-01-preview",
              "kind": "GenericUI",
              "location": "switzerlandnorth",
              "name": "jim-law-001/Microsoft.SecurityInsights/PaloAltoNetworks",
              "properties": {
                "connectorUiConfig": {
                  "availability": {
                    "isPreview": false,
                    "status": 1
                  },
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize LastLogReceived = max(TimeGenerated)\n            | project IsConnected = LastLogReceived > ago(30d)"
                      ]
                    }
                  ],
                  "dataTypes": [
                    {
                      "lastDataReceivedQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)",
                      "name": "CommonSecurityLog (PaloAlto)"
                    }
                  ],
                  "descriptionMarkdown": "The Palo Alto Networks firewall connector allows you to easily connect your Palo Alto Networks logs with Microsoft Sentinel, to view dashboards, create custom alerts, and improve investigation. This gives you more insight into your organization's network and improves your security operation capabilities.",
                  "graphQueries": [
                    {
                      "baseQuery": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n",
                      "legend": "Palo Alto Networks",
                      "metricName": "Total data received"
                    }
                  ],
                  "id": "PaloAltoNetworks",
                  "instructionSteps": [
                    {
                      "description": "Install and configure the Linux agent to collect your Common Event Format (CEF) Syslog messages and forward them to Microsoft Sentinel.\n\n> Notice that the data from all regions will be stored in the selected workspace",
                      "innerSteps": [
                        {
                          "description": "Select or create a Linux machine that Microsoft Sentinel will use as the proxy between your security solution and Microsoft Sentinel this machine can be on your on-prem environment, Azure or other clouds.",
                          "title": "1.1 Select or create a Linux machine"
                        },
                        {
                          "description": "Install the Microsoft Monitoring Agent on your Linux machine and configure the machine to listen on the necessary port and forward messages to your Microsoft Sentinel workspace. The CEF collector collects CEF messages on port 514 TCP.\n\n> 1. Make sure that you have Python on your machine using the following command: python -version.\n\n> 2. You must have elevated permissions (sudo) on your machine.",
                          "instructions": [
                            {
                              "parameters": {
                                "fillWith": [
                                  "WorkspaceId",
                                  "PrimaryKey"
                                ],
                                "label": "Run the following command to install and apply the CEF collector:",
                                "value": "sudo wget -O cef_installer.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_installer.py&&sudo python cef_installer.py {0} {1}"
                              },
                              "type": "CopyableLabel"
                            }
                          ],
                          "title": "1.2 Install the CEF collector on the Linux machine"
                        }
                      ],
                      "title": "1. Linux Syslog agent configuration"
                    },
                    {
                      "description": "Configure Palo Alto Networks to forward Syslog messages in CEF format to your Microsoft Sentinel workspace via the Syslog agent.\n\nGo to [configure Palo Alto Networks NGFW for sending CEF events.](https://aka.ms/sentinel-paloaltonetworks-readme)\n\nGo to [Palo Alto CEF Configuration](https://aka.ms/asi-syslog-paloalto-forwarding)  and Palo Alto [Configure Syslog Monitoring](https://aka.ms/asi-syslog-paloalto-configure)  steps 2, 3, choose your version, and follow the instructions using the following guidelines:\n\n1.  Set the Syslog server format to  **BSD**.\n\n2.  The copy/paste operations from the PDF might change the text and insert random characters. To avoid this, copy the text to an editor and remove any characters that might break the log format before pasting it.\n\n[Learn more >](https://aka.ms/CEFPaloAlto)",
                      "title": "2. Forward Palo Alto Networks logs to Syslog agent"
                    },
                    {
                      "description": "Follow the instructions to validate your connectivity:\n\nOpen Log Analytics to check if the logs are received using the CommonSecurityLog schema.\n\n>It may take about 20 minutes until the connection streams data to your workspace.\n\nIf the logs are not received, run the following connectivity validation script:\n\n> 1. Make sure that you have Python on your machine using the following command: python -version\n\n>2. You must have elevated permissions (sudo) on your machine",
                      "instructions": [
                        {
                          "parameters": {
                            "fillWith": [
                              "WorkspaceId"
                            ],
                            "label": "Run the following command to validate your connectivity:",
                            "value": "sudo wget  -O cef_troubleshoot.py https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/DataConnectors/CEF/cef_troubleshoot.py&&sudo python cef_troubleshoot.py  {0}"
                          },
                          "type": "CopyableLabel"
                        }
                      ],
                      "title": "3. Validate connection"
                    },
                    {
                      "description": "Make sure to configure the machine's security according to your organization's security policy\n\n\n[Learn more >](https://aka.ms/SecureCEF)",
                      "title": "4. Secure your machine "
                    }
                  ],
                  "metadata": {
                    "author": {
                      "name": "Palo Alto Networks"
                    },
                    "id": "ef80260c-3aec-43bc-a1e5-c2f2372c9adc",
                    "kind": "dataConnector",
                    "source": {
                      "kind": "community"
                    },
                    "support": {
                      "link": "https://www.paloaltonetworks.com/company/contact-support",
                      "name": "Palo Alto Networks",
                      "tier": "developer"
                    },
                    "version": "1.0.0"
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "permissionsDisplayText": "read and write permissions are required.",
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "providerDisplayName": "Workspace",
                        "requiredPermissions": {
                          "delete": true,
                          "read": true,
                          "write": true
                        },
                        "scope": "Workspace"
                      },
                      {
                        "permissionsDisplayText": "read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "providerDisplayName": "Keys",
                        "requiredPermissions": {
                          "action": true
                        },
                        "scope": "Workspace"
                      }
                    ]
                  },
                  "publisher": "Palo Alto Networks",
                  "sampleQueries": [
                    {
                      "description": "All logs",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | sort by TimeGenerated"
                    },
                    {
                      "description": "THREAT activity",
                      "query": "\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\"\n| where DeviceProduct has \"PAN-OS\"\n\n            | where Activity == \"THREAT\"\n            | sort by TimeGenerated"
                    }
                  ],
                  "title": "Palo Alto Networks (Firewall)"
                }
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/DataConnector-PaloAltoNetworks",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAltoNetworks",
                "kind": "DataConnector",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.OperationalInsights/workspaces/jim-law-001/providers/Microsoft.SecurityInsights/dataConnectors/PaloAltoNetworks",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0.1",
      "properties": {
        "description": "PaloAlto-NetworkBeaconing_AnalyticalRules Analytics Rule with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.1",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "switzerlandnorth",
              "name": "f0be259a-34ac-4946-aa15-ca2b115d5feb",
              "properties": {
                "description": "Identifies beaconing patterns from Palo Alto Network traffic logs based on recurrent timedelta patterns. \nThe query leverages various KQL functions to calculate time deltas and then compares it with total events observed in a day to find percentage of beaconing. \nThis outbound beaconing pattern to untrusted public networks should be investigated for any malware callbacks or data exfiltration attempts.\nReference Blog:\nhttp://www.austintaylor.io/detect/beaconing/intrusion/detection/system/command/control/flare/elastic/stack/2017/06/10/detect-beaconing-with-flare-elasticsearch-and-intrusion-detection-systems/\nhttps://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/detect-network-beaconing-via-intra-request-time-delta-patterns/ba-p/779586",
                "displayName": "Palo Alto - potential beaconing detected",
                "enabled": false,
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "query": "\nlet starttime = 2d;\nlet endtime = 1d;\nlet TimeDeltaThreshold = 25;\nlet TotalEventsThreshold = 30;\nlet MostFrequentTimeDeltaThreshold = 25;\nlet PercentBeaconThreshold = 80;\nCommonSecurityLog\n| where DeviceVendor == \"Palo Alto Networks\" and Activity == \"TRAFFIC\"\n| where TimeGenerated between (startofday(ago(starttime))..startofday(ago(endtime)))\n| where ipv4_is_private(DestinationIP)== false\n| project TimeGenerated, DeviceName, SourceUserID, SourceIP, SourcePort, DestinationIP, DestinationPort, ReceivedBytes, SentBytes\n| sort by SourceIP asc,TimeGenerated asc, DestinationIP asc, DestinationPort asc\n| serialize\n| extend nextTimeGenerated = next(TimeGenerated, 1), nextSourceIP = next(SourceIP, 1)\n| extend TimeDeltainSeconds = datetime_diff('second',nextTimeGenerated,TimeGenerated)\n| where SourceIP == nextSourceIP\n//Whitelisting criteria/ threshold criteria\n| where TimeDeltainSeconds > TimeDeltaThreshold \n| summarize count(), sum(ReceivedBytes), sum(SentBytes)\nby TimeDeltainSeconds, bin(TimeGenerated, 1h), DeviceName, SourceUserID, SourceIP, DestinationIP, DestinationPort\n| summarize (MostFrequentTimeDeltaCount, MostFrequentTimeDeltainSeconds) = arg_max(count_, TimeDeltainSeconds), TotalEvents=sum(count_), TotalSentBytes = sum(sum_SentBytes), TotalReceivedBytes = sum(sum_ReceivedBytes) \nby bin(TimeGenerated, 1h), DeviceName, SourceUserID, SourceIP, DestinationIP, DestinationPort\n| where TotalEvents > TotalEventsThreshold and MostFrequentTimeDeltaCount > MostFrequentTimeDeltaThreshold\n| extend BeaconPercent = MostFrequentTimeDeltaCount/toreal(TotalEvents) * 100\n| where BeaconPercent > PercentBeaconThreshold\n| extend timestamp = TimeGenerated, IPCustomEntity = DestinationIP, AccountCustomEntity = SourceUserID, HostCustomEntity = DeviceName \n",
                "queryFrequency": "P1D",
                "queryPeriod": "P2D",
                "requiredDataConnectors": [
                  {
                    "connectorId": "PaloAltoNetworks",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "severity": "Low",
                "status": "Available",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "tactics": [
                  "CommandAndControl"
                ],
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0
              },
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/AnalyticsRule-f0be259a-34ac-4946-aa15-ca2b115d5feb",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "f0be259a-34ac-4946-aa15-ca2b115d5feb",
                "description": "PaloAlto-PAN-OS Analytics Rule 3",
                "kind": "AnalyticsRule",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.SecurityInsights/AlertRuleTemplates/f0be259a-34ac-4946-aa15-ca2b115d5feb",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0.1"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.0.1",
      "properties": {
        "description": "PaloAlto-PortScanning_AnalyticalRules Analytics Rule with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.1",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "switzerlandnorth",
              "name": "5b72f527-e3f6-4a00-9908-8e4fee14da9f",
              "properties": {
                "description": "Identifies a list of internal Source IPs (10.x.x.x Hosts) that have triggered 10 or more non-graceful tcp server resets from one or more Destination IPs which \nresults in an \"ApplicationProtocol = incomplete\" designation. The server resets coupled with an \"Incomplete\" ApplicationProtocol designation can be an indication \nof internal to external port scanning or probing attack. \nReferences: https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClUvCAK and\nhttps://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClTaCAK",
                "displayName": "Palo Alto - possible internal to external port scanning",
                "enabled": false,
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ]
                  }
                ],
                "query": "\nCommonSecurityLog\n| where isnotempty(DestinationPort) and DeviceAction !in (\"reset-both\", \"deny\") \n// filter out common usage ports. Add ports that are legitimate for your environment\n| where DestinationPort !in (\"443\", \"53\", \"389\", \"80\", \"0\", \"880\", \"8888\", \"8080\")\n| where ApplicationProtocol == \"incomplete\" \n// filter out IANA ephemeral or negotiated ports as per https://en.wikipedia.org/wiki/Ephemeral_port\n| where DestinationPort !between (toint(49512) .. toint(65535)) \n| where Computer != \"\" \n| where DestinationIP !startswith \"10.\"\n| extend Reason = coalesce(\n                              column_ifexists(\"Reason\", \"\"), \n                              extract(\"reason=(.+?)(;|$)\", 1, AdditionalExtensions),\n                              \"\"\n                          )\n// Filter out any graceful reset reasons of AGED OUT which occurs when a TCP session closes with a FIN due to aging out. \n| where Reason !has \"aged-out\" \n// Filter out any TCP FIN which occurs when a TCP FIN is used to gracefully close half or both sides of a connection.\n| where Reason !has \"tcp-fin\" \n// Uncomment one of the following where clauses to trigger on specific TCP reset reasons\n// See Palo Alto article for details - https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClUvCAK\n// TCP RST-server - Occurs when the server sends a TCP reset to the client\n// | where AdditionalExtensions has \"reason=tcp-rst-from-server\"  \n// TCP RST-client - Occurs when the client sends a TCP reset to the server\n// | where AdditionalExtensions has \"reason=tcp-rst-from-client\"  \n// Already performed\n//| extend reason = tostring(split(AdditionalExtensions, \";\")[3])\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), count() by DeviceName, SourceUserID, SourceIP, ApplicationProtocol, Reason, DestinationPort, Protocol, DeviceVendor, DeviceProduct, DeviceAction, DestinationIP\n| where count_ >= 10\n| summarize StartTimeUtc = min(StartTimeUtc), EndTimeUtc = max(EndTimeUtc), makeset(DestinationIP), totalcount = sum(count_) by DeviceName, SourceUserID, SourceIP, ApplicationProtocol, Reason, DestinationPort, Protocol, DeviceVendor, DeviceProduct, DeviceAction\n| extend timestamp = StartTimeUtc, IPCustomEntity = SourceIP, AccountCustomEntity = SourceUserID, HostCustomEntity = DeviceName \n",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "requiredDataConnectors": [
                  {
                    "connectorId": "PaloAltoNetworks",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "severity": "Low",
                "status": "Available",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "tactics": [
                  "Discovery"
                ],
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0
              },
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/AnalyticsRule-5b72f527-e3f6-4a00-9908-8e4fee14da9f",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "5b72f527-e3f6-4a00-9908-8e4fee14da9f",
                "description": "PaloAlto-PAN-OS Analytics Rule 4",
                "kind": "AnalyticsRule",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.SecurityInsights/AlertRuleTemplates/5b72f527-e3f6-4a00-9908-8e4fee14da9f",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.0.1"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.1.0",
      "properties": {
        "description": "PaloAltoNetworkThreatWorkbook Workbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.1.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2021-08-01",
              "kind": "shared",
              "location": "switzerlandnorth",
              "metadata": {
                "description": "Gain insights into Palo Alto network activities by analyzing threat events.\nYou can extract meaningful security information by correlating data between threats, applications, and time.\nThis workbook makes it easy to track malware, vulnerability, and virus log events."
              },
              "name": "PaloAltoNetworkThreatWorkbook",
              "properties": {
                "category": "sentinel",
                "displayName": "Palo Alto Network Threat",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Palo Alto network threat\\n\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"d0ccb5c6-8a07-4b7e-9abf-38fa4dcc0baf\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":43200000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file';\\r\\ndata\\r\\n| summarize Count = count() by DeviceEventClassID\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceEventClassID)\\r\\n on DeviceEventClassID\\r\\n| project-away DeviceEventClassID1, TimeGenerated\\r\\n| extend DeviceEventClassIDs = DeviceEventClassID\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceEventClassID = 'All', DeviceEventClassIDs = '*' \\r\\n)\\r\\n| project DeviceEventClassID, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"DeviceEventClassID\",\"exportParameterName\":\"SelectedSubtype\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Threats, by subtypes\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Threats by subtypes\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire';\\r\\ndata\\r\\n| summarize Count = count() by DeviceCustomString2\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceCustomString2)\\r\\n on DeviceCustomString2\\r\\n| project-away DeviceCustomString21, TimeGenerated\\r\\n| extend DeviceCustomString2s = DeviceCustomString2\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceCustomString2 = 'All', DeviceCustomString2s = '*' \\r\\n)\\r\\n| project DeviceCustomString2, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"DeviceCustomString2\",\"exportParameterName\":\"SelectedWildfire\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"WildFire verdicts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceCustomString2\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"WildFire verdicts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and LogSeverity != 'url' and LogSeverity != 'file';\\r\\ndata\\r\\n| summarize Count = count() by LogSeverity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by LogSeverity)\\r\\n on LogSeverity\\r\\n| project-away LogSeverity1, TimeGenerated\\r\\n| extend LogSeveritys = LogSeverity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend LogSeverity = 'All', LogSeveritys = '*' \\r\\n)\\r\\n| project LogSeverity, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"exportFieldName\":\"LogSeverity\",\"exportParameterName\":\"SelectedSeverity\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Threats severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"lightBlue\",\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Threats severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| summarize count() by bin(TimeGenerated, 1h), DeviceEventClassID\\r\\n| render timechart\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat subtypes over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"37.5\",\"name\":\"Threat subtypes over time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| summarize count() by bin(TimeGenerated, 1h), LogSeverity\\r\\n| render timechart\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat severity over time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"37.5\",\"name\":\"Threat severity over time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT' and DeviceEventClassID != 'url' and DeviceEventClassID != 'file'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity;\\r\\ndata\\r\\n| summarize Count = count() by ApplicationProtocol\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ApplicationProtocol)\\r\\n on ApplicationProtocol\\r\\n| project-away ApplicationProtocol1, TimeGenerated\\r\\n| extend ApplicationProtocols = ApplicationProtocol\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend ApplicationProtocol = 'All', ApplicationProtocols = '*' \\r\\n)\\r\\n| project ApplicationProtocol, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threats, by application\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Threats by application\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where '{SelectedSubtype}' == \\\"All\\\" or '{SelectedSubtype}'==DeviceEventClassID\\r\\n| where '{SelectedWildfire}' == \\\"All\\\" or '{SelectedWildfire}'==DeviceCustomString2\\r\\n| where '{SelectedSeverity}' == \\\"All\\\" or '{SelectedSeverity}'==LogSeverity\\r\\n| project TimeGenerated, ReceiptTime, LogSeverity, DeviceAction, ['URL Category'] =DeviceCustomString2, DestinationPort, DestinationIP, Message, SourcePort, SourceIP, DestinationUserID, RequestURL\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Threat events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"All Threat Events\"},{\"type\":1,\"content\":{\"json\":\"---\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where DeviceEventClassID =~ 'vulnerability' \\r\\n| extend ThreatId = coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract('cat=([^;]+)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize Amount=count() by ThreatId, LogSeverity\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top vulnerability events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ThreatId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"Top vulnerability events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| search DeviceEventClassID:'*virus*'\\r\\n| summarize Amount=count() by RequestURL, DeviceEventClassID, DestinationIP, SourceIP, ApplicationProtocol\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Virus and malware events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RequestURL\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DestinationIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"SourceUserID\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"name\":\"Virus and malware events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n//| where DeviceEventClassID =~ 'correlation' \\r\\n| extend ThreatId = coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract('cat=([^;]+)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| extend ThreatCategory = extract('PanOSThreatCategory=([^;]+)',1, AdditionalExtensions)\\r\\n| summarize Amount=count() by ThreatId, ThreatCategory, LogSeverity\\r\\n| top 20 by Amount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top correlation events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ThreatId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ThreatCategory\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"LogSeverity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Amount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"name\":\"Top correlation events\"}],\"fromTemplateId\":\"sentinel-PaloAltoNetworkThreat\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "sourceId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/microsoft.OperationalInsights/Workspaces/jim-law-001",
                "version": "1.0"
              },
              "type": "Microsoft.Insights/workbooks"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Workbook-PaloAltoNetworkThreatWorkbook",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAltoNetworkThreatWorkbook",
                "description": "@{workbookKey=PaloAltoNetworkThreatWorkbook; logoFileName=paloalto_logo.svg; description=Gain insights into Palo Alto network activities by analyzing threat events.\nYou can extract meaningful security information by correlating data between threats, applications, and time.\nThis workbook makes it easy to track malware, vulnerability, and virus log events.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.1.0; title=Palo Alto Network Threat; templateRelativePath=PaloAltoNetworkThreat.json; subtitle=; provider=Palo Alto Networks}.description",
                "kind": "Workbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Insights/workbooks/PaloAltoNetworkThreatWorkbook",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.1.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.2.0",
      "properties": {
        "description": "PaloAltoOverviewWorkbook Workbook with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.2.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2021-08-01",
              "kind": "shared",
              "location": "switzerlandnorth",
              "metadata": {
                "description": "Gain insights and comprehensive monitoring into Palo Alto firewalls by analyzing traffic and activities.\nThis workbook correlates all Palo Alto data with threat events to identify suspicious entities and relationships.\nYou can learn about trends across user and data traffic, and drill down into Palo Alto Wildfire and filter results."
              },
              "name": "PaloAltoOverviewWorkbook",
              "properties": {
                "category": "sentinel",
                "displayName": "Palo Alto overview",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<div style=\\\"font-size: 200%;\\\">Palo Alto Networks overview</div>\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"a5c18655-3e2d-4d12-8ba4-82e57b296581\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}},{\"id\":\"32f5a8aa-9c54-4fd1-a2b9-8461b2c57f55\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Source_IP\",\"label\":\"Source IP\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by SourceIP\\r\\n| where SourceIP != \\\"\\\"\\r\\n| order by Count desc, SourceIP asc\\r\\n| project Value = SourceIP, Label = strcat(SourceIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\\r\\n\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":1800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"b937ca33-bc62-4183-bc0f-9ad8306dc36a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Destination_IP\",\"label\":\"Destination IP\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| summarize Count = count()/1000 by DestinationIP\\r\\n| where DestinationIP != \\\"\\\"\\r\\n| order by Count desc, DestinationIP asc\\r\\n| project Value = DestinationIP, Label = strcat(DestinationIP, \\\" - \\\", Count, \\\"k\\\"), Selected = false\",\"value\":[\"value::all\"],\"typeSettings\":{\"limitSelectTo\":10,\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"query\":\"\",\"parameters\":[{\"id\":\"7f28bae3-a11f-408a-832f-77a0f3e633d7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"EventClass\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| distinct DeviceEventClassID\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"selectAllValue\":\"All\"},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 35\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass});\\r\\ndata\\r\\n| summarize Count = count() by Activity\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Activity)\\r\\n on Activity\\r\\n| project-away Activity1, TimeGenerated\\r\\n| extend Activitys = Activity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Activity = 'All', Activitys = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"Activity\",\"exportParameterName\":\"activities\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Activities, by volume\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Activity\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"lightBlue\",\"showIcon\":true}},{\"columnMatch\":\"Activitys\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Activity\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"name\":\"all activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP})\\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass})\\r\\n| where '{activities}' == \\\"All\\\" or Activity == '{activities}'\\r\\n| summarize LogVolume=count() by DeviceEventClassID, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"aggregation\":3,\"exportToExcelOptions\":\"visible\",\"title\":\"Event trend, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"LogVolume\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Event trend by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//trend by sevearity\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where \\\"{EventClass:lable}\\\" == \\\"All\\\" or DeviceEventClassID in ({EventClass})\\r\\n| where '{activities}' == \\\"All\\\" or Activity == '{activities}'\\r\\n| summarize count() by bin_at(TimeGenerated, {TimeRange:grain},{TimeRange:start}), LogSeverity\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Events severity, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"LogSeverity\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"Events severity over time\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n### Traffic events summary\"},\"name\":\"text - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ \\\"Traffic\\\";\\r\\ndata\\r\\n| summarize Count = count() by DeviceEventClassID\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceEventClassID)\\r\\n on DeviceEventClassID\\r\\n| project-away DeviceEventClassID1, TimeGenerated\\r\\n| extend DeviceEventClassIDs = DeviceEventClassID\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceEventClassID = 'All', DeviceEventClassIDs = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceEventClassID\",\"exportParameterName\":\"EventClass\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Device events Id summary - click to filter the graph below\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceEventClassID\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"50\",\"name\":\"Traffic event summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ \\\"Traffic\\\";\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceAction = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"DeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Device action summary - click to filter the graph below\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"blueDark\",\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":5,\"formatOptions\":{\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"33\",\"name\":\"Traffic activity summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC'\\r\\n| where '{EventClass}' == \\\"All\\\" or DeviceEventClassID=='{EventClass}'\\r\\n| summarize EventCount= count() by DeviceAction, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Device action, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"Traffic activity by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where '{DeviceAction}' == \\\"All\\\" or DeviceAction=='{DeviceAction}'\\r\\n| where Activity =~ \\\"Traffic\\\"\\r\\n| summarize EventCount= count() by DeviceEventClassID, bin_at(TimeGenerated, {TimeRange:grain}, {TimeRange:start})\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Device events Id, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"Traffic class ID by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS' \\r\\n| where DeviceVendor =~ 'Palo Alto Networks' \\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC' \\r\\n| where DeviceEventClassID =~ 'end' \\r\\n| extend Reason = coalesce(\\r\\n                            column_ifexists(\\\"Reason\\\", \\\"\\\"),\\r\\n                            extract(';reason=(.*?);',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize ReasonCount= count() by  Reason, TimeGenerated  \\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Reasons for session ending, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Reasons for session ending\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Data sent outbound vs inbound\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'TRAFFIC'\\r\\n| extend Direction=iff(DeviceCustomString4=~'Trust','Outbound' ,'Inbound' )\\r\\n| summarize DataSentOutBoundMB=sumif(SentBytes, Direction=~'Outbound')/1048576,   DataRecievedInboundMB=sumif(ReceivedBytes, Direction=~'Inbound')/1048576 by TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Sent and received data, by volume\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Sent and received data by volume\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Web filter\"},\"name\":\"text - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction contains 'block'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked URLs, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"min\":0,\"palette\":\"purple\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 blocked URLs by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction in ('block-url', 'block-continue')\\r\\n| summarize CategoryCount=count() by DeviceCustomString2\\r\\n| project-rename CategoryName= DeviceCustomString2\\r\\n| top 5 by CategoryCount\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 URL blocked, by category\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CategoryName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"op 5 URL blocked by category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('block-url', 'block-continue')\\r\\n| summarize URLCount=count() by RequestURL\\r\\n| top 5 by URLCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 blocked URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"Top 5 blocked URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| summarize ProtocolCount=count() by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 URLs, by application protocols\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 URLs by application protocols\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize URLCount=count() by RequestURL\\r\\n| top 5 by URLCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"RequestURL\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"URLCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| summarize ActionCount=count() by DeviceAction\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"URL threat event summary\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActionCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"URL threat event summary\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction contains 'block'\\r\\n| extend PAReferer= extract(';PanOSReferer=(.*?);',1,AdditionalExtensions)\\r\\n| where PAReferer !=''\\r\\n| summarize RefererCount= count() by PAReferer\\r\\n| top 5 by RefererCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 referrers for blocked URLs\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"25\",\"name\":\"Top 5 referrers for blocked URLs\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize CategoryCount=count() by DeviceCustomString2\\r\\n| project-rename CategoryName= DeviceCustomString2\\r\\n| top 5 by CategoryCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs, by category\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CategoryName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"25\",\"name\":\"Top 5 allowed URLs, by category\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID  =~ 'url'\\r\\n| where DeviceAction !contains 'block'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed URLs, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed URLs by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| summarize ActionCount=count() by DeviceAction, TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Web filter ativity, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActionCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Web filter ativity by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID =~ 'url'\\r\\n| where DeviceAction in ('alert', 'continue')\\r\\n| summarize IPCount=count() by SourceIP\\r\\n| top 5 by IPCount  desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed web traffic source IP addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SourceIP\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IPCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed web traffic source IP addresses\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## Wildfire\"},\"name\":\"text - 24\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'wildfire'\\r\\n| summarize ActionCount=count() by DeviceAction, TimeGenerated\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Wildfire events, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"Wildfire events, by time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceActions = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| project DeviceAction, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"DeviceAction\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Wildfire activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"grayBlue\",\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"sortBy\":[{\"itemKey\":\"DeviceAction\",\"sortOrder\":1}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Top 5 Wildfire activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'wildfire'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceCustomString2\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceCustomString2)\\r\\n on DeviceCustomString2\\r\\n| project-away DeviceCustomString21, TimeGenerated\\r\\n| extend DeviceCustomString2s = DeviceCustomString2\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceCustomString2 = 'All', DeviceCustomString2s = '*' \\r\\n)\\r\\n| project DeviceCustomString2, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":4,\"exportFieldName\":\"DeviceCustomString2\",\"exportParameterName\":\"DeviceString\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 Wildfire verdicts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"DeviceAction\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"palette\":\"grayBlue\",\"showIcon\":true}},{\"columnMatch\":\"DeviceActions\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"jkey1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"sortBy\":[{\"itemKey\":\"DeviceAction\",\"sortOrder\":1}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceCustomString2\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Top 5 Wildfire verdicts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'wildfire'\\r\\n| where '{DeviceAction}' == \\\"All\\\" or DeviceAction=='{DeviceAction}'\\r\\n| where '{DeviceString}' == \\\"All\\\" or DeviceCustomString2=='{DeviceString}'\\r\\n| project TimeGenerated, ReceiptTime, LogSeverity, DeviceAction, ['URL Category'] =DeviceCustomString2, DestinationPort, DestinationIP, Message, SourcePort, SourceIP, DestinationUserID, RequestURL\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Wildfire events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"name\":\"Wildfire events\"},{\"type\":1,\"content\":{\"json\":\"---\\r\\n## General statistics\"},\"name\":\"text - 30\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID  =~ 'file'\\r\\n| where DeviceAction contains 'deny'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 denied files, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 denied files by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID  =~ 'file'\\r\\n| where DeviceAction !contains 'deny'\\r\\n| summarize ProtocolCount=count()  by ApplicationProtocol\\r\\n| top 5 by ProtocolCount desc\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Top 5 allowed files, by application protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ApplicationProtocol\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ProtocolCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true}}]}},\"customWidth\":\"33\",\"name\":\"Top 5 allowed files by application protocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//Palo Alto File Category By Action Summary\\r\\nCommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS' \\r\\n| where DeviceVendor =~ 'Palo Alto Networks' \\r\\n| where Activity =~ 'THREAT'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where DeviceEventClassID =~ 'file' \\r\\n| extend PACategory= coalesce(\\r\\n                            column_ifexists(\\\"DeviceEventCategory\\\", \\\"\\\"),\\r\\n                            extract(';cat=(.*?)($|;)',1,AdditionalExtensions),\\r\\n                            \\\"\\\"\\r\\n                        )\\r\\n| summarize CategoryCount=count() by PACategory\\r\\n| sort by CategoryCount\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Summary of Palo Alto file categories, by activity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"PACategory\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"CategoryCount\",\"formatter\":4,\"formatOptions\":{\"palette\":\"coldHot\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}}]}},\"customWidth\":\"33\",\"name\":\"Summary of Palo Alto file categories by activity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~'file'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP});\\r\\ndata\\r\\n| summarize Count = count() by DeviceAction\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction)\\r\\n on DeviceAction\\r\\n| project-away DeviceAction1, TimeGenerated\\r\\n| extend DeviceActions = DeviceAction\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend DeviceAction = 'All', DeviceActions = '*' \\r\\n)\\r\\n| project DeviceAction, Count, Trend\\r\\n| order by Count desc\\r\\n| take 10\\r\\n\",\"size\":4,\"exportFieldName\":\"DeviceAction\",\"exportParameterName\":\"SelectedDA\",\"exportDefaultValue\":\"All\",\"exportToExcelOptions\":\"visible\",\"title\":\"Summary of file type activities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"DeviceAction\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"secondaryContent\":{\"columnMatch\":\"Trend\",\"formatter\":9,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":false}},\"customWidth\":\"25\",\"name\":\"Summary of file type activities\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CommonSecurityLog\\r\\n| where DeviceProduct has 'PAN-OS'\\r\\n| where DeviceVendor =~ 'Palo Alto Networks'\\r\\n| where Activity =~ 'THREAT'\\r\\n| where DeviceEventClassID =~ 'file'\\r\\n| where \\\"{Destination_IP:lable}\\\"==\\\"All\\\" or DestinationIP in ({Destination_IP}) \\r\\n| where \\\"{Source_IP:lable}\\\" == \\\"All\\\" or SourceIP in ({Source_IP})\\r\\n| where '{SelectedDA}' == \\\"All\\\" or DeviceAction == '{SelectedDA}'\\r\\n| summarize ActionCount=count() by DeviceAction, bin(TimeGenerated, {TimeRange:grain})\\r\\n\",\"size\":0,\"exportToExcelOptions\":\"visible\",\"title\":\"Compare allowed and denied files, by time\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"name\":\"Compare allowed and denied files by time\"}],\"fromTemplateId\":\"sentinel-PaloAltoOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "sourceId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/microsoft.OperationalInsights/Workspaces/jim-law-001",
                "version": "1.0"
              },
              "type": "Microsoft.Insights/workbooks"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/Workbook-PaloAltoOverviewWorkbook",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "PaloAltoOverviewWorkbook",
                "description": "@{workbookKey=PaloAltoOverviewWorkbook; logoFileName=paloalto_logo.svg; description=Gain insights and comprehensive monitoring into Palo Alto firewalls by analyzing traffic and activities.\nThis workbook correlates all Palo Alto data with threat events to identify suspicious entities and relationships.\nYou can learn about trends across user and data traffic, and drill down into Palo Alto Wildfire and filter results.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.2.0; title=Palo Alto overview; templateRelativePath=PaloAltoOverview.json; subtitle=; provider=Microsoft}.description",
                "kind": "Workbook",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Insights/workbooks/PaloAltoOverviewWorkbook",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.2.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "1.3.0",
      "properties": {
        "description": "FileHashEntity_Covid19_CommonSecurityLog_AnalyticalRules Analytics Rule with template version 2.0.0",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.3.0",
          "parameters": {},
          "resources": [
            {
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "switzerlandnorth",
              "name": "2be4ef67-a93f-4d8a-981a-88158cb73abd",
              "properties": {
                "description": "Identifies a match in CommonSecurityLog Event data from any FileHash published in the Microsoft COVID-19 Threat Intel Feed - as described at https://www.microsoft.com/security/blog/2020/05/14/open-sourcing-covid-threat-intelligence/",
                "displayName": "Microsoft COVID-19 file hash indicator matches",
                "enabled": false,
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "Host",
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ]
                  },
                  {
                    "entityType": "FileHash",
                    "fieldMappings": [
                      {
                        "columnName": "FileHashValue",
                        "identifier": "Value"
                      },
                      {
                        "columnName": "FileHashType",
                        "identifier": "Algorithm"
                      }
                    ]
                  }
                ],
                "query": "\nlet dt_lookBack = 1h;\nlet covidIndicators = (externaldata(TimeGenerated:datetime, FileHashValue:string, FileHashType: string, TlpLevel: string, Product: string, ThreatType: string, Description: string )\n[@\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/Microsoft.Covid19.Indicators.csv\"] with (format=\"csv\"));\nlet fileHashIndicators = covidIndicators\n| where isnotempty(FileHashValue);\n// Handle matches against both lower case and uppercase versions of the hash:\n(fileHashIndicators | extend FileHashValue = tolower(FileHashValue)\n| union (fileHashIndicators | extend FileHashValue = toupper(FileHashValue)))\n// using innerunique to keep perf fast and result set low, we only need one match to indicate potential malicious activity that needs to be investigated\n|  join kind=innerunique (\n   CommonSecurityLog | where TimeGenerated >= ago(dt_lookBack) \n   | where isnotempty(FileHash)\n   | extend CommonSecurityLog_TimeGenerated = TimeGenerated\n   )\non $left.FileHashValue == $right.FileHash\n| summarize CommonSecurityLog_TimeGenerated = arg_max(CommonSecurityLog_TimeGenerated, *) by FileHashValue\n| project CommonSecurityLog_TimeGenerated, FileHashValue, FileHashType, Description, ThreatType,  \nSourceIP, SourcePort, DestinationIP, DestinationPort, SourceUserID, SourceUserName, DeviceName, DeviceAction, \nRequestURL, DestinationUserName, DestinationUserID, ApplicationProtocol, Activity\n| extend timestamp = CommonSecurityLog_TimeGenerated, IPCustomEntity = SourceIP, HostCustomEntity = DeviceName, AccountCustomEntity = SourceUserName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "requiredDataConnectors": [
                  {
                    "connectorId": "PaloAltoNetworks",
                    "dataTypes": [
                      "CommonSecurityLog"
                    ]
                  }
                ],
                "severity": "Medium",
                "status": "Available",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "tactics": [
                  "Impact"
                ],
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0
              },
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates"
            },
            {
              "apiVersion": "2022-01-01-preview",
              "name": "jim-law-001/Microsoft.SecurityInsights/AnalyticsRule-2be4ef67-a93f-4d8a-981a-88158cb73abd",
              "properties": {
                "author": {
                  "email": "support@microsoft.com",
                  "name": "Microsoft"
                },
                "contentId": "2be4ef67-a93f-4d8a-981a-88158cb73abd",
                "description": "PaloAlto-PAN-OS Analytics Rule 2",
                "kind": "AnalyticsRule",
                "parentId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.SecurityInsights/AlertRuleTemplates/2be4ef67-a93f-4d8a-981a-88158cb73abd",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "azuresentinel.azure-sentinel-solution-paloaltopanos"
                },
                "support": {
                  "email": "support@microsoft.com",
                  "link": "https://support.microsoft.com",
                  "name": "Microsoft Corporation",
                  "tier": "Microsoft"
                },
                "version": "1.3.0"
              },
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata"
            }
          ],
          "variables": {}
        }
      },
      "type": "microsoft.resources/templatespecs/versions"
    },
    {
      "name": "ASP-appsubscriptionvendinglight-818d",
      "properties": {
        "adminRuntimeSiteName": null,
        "adminSiteName": null,
        "computeMode": "Dedicated",
        "createdTime": "2024-11-18T08:41:40.34Z",
        "currentNumberOfWorkers": 1,
        "currentWorkerSize": "SmallV3",
        "currentWorkerSizeId": 6,
        "elasticScaleEnabled": false,
        "existingServerFarmIds": null,
        "freeOfferExpirationTime": null,
        "geoRegion": "Switzerland North",
        "hostingEnvironment": null,
        "hostingEnvironmentId": null,
        "hostingEnvironmentProfile": null,
        "hyperV": false,
        "isSpot": false,
        "isXenon": false,
        "kind": "linux",
        "kubeEnvironmentProfile": null,
        "maximumElasticWorkerCount": 1,
        "maximumNumberOfWorkers": 30,
        "mdmId": "waws-prod-zrh-013_9619",
        "migrateToVMSS": null,
        "name": "ASP-appsubscriptionvendinglight-818d",
        "numberOfSites": 1,
        "numberOfWorkers": 1,
        "perSiteScaling": false,
        "planName": "VirtualDedicatedPlan",
        "provisioningState": "Succeeded",
        "reserved": true,
        "resourceGroup": "app-subscription-vending-light",
        "serverFarmId": 9619,
        "siteMode": null,
        "spotExpirationTime": null,
        "status": "Ready",
        "subscription": "9db2792a-3551-43a5-be87-068751dd95d5",
        "tags": null,
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0,
        "vnetConnectionsMax": 2,
        "vnetConnectionsUsed": 0,
        "webSiteId": null,
        "webSpace": "app-subscription-vending-light-SwitzerlandNorthwebspace-Linux",
        "workerSize": "SmallV3",
        "workerSizeId": 6,
        "workerTierName": null,
        "zoneRedundant": false
      },
      "type": "microsoft.web/serverfarms"
    },
    {
      "name": "ASP-nedi-9908",
      "properties": {
        "adminRuntimeSiteName": null,
        "adminSiteName": null,
        "computeMode": "Dedicated",
        "createdTime": "0001-01-01T00:00:00Z",
        "currentNumberOfWorkers": 1,
        "currentWorkerSize": "Default",
        "currentWorkerSizeId": 0,
        "elasticScaleEnabled": false,
        "existingServerFarmIds": null,
        "freeOfferExpirationTime": null,
        "geoRegion": "West Europe",
        "hostingEnvironment": null,
        "hostingEnvironmentId": null,
        "hostingEnvironmentProfile": null,
        "hyperV": false,
        "isSpot": false,
        "isXenon": false,
        "kind": "linux",
        "kubeEnvironmentProfile": null,
        "maximumElasticWorkerCount": 1,
        "maximumNumberOfWorkers": 1,
        "mdmId": "waws-prod-am2-369_13910",
        "migrateToVMSS": null,
        "name": "ASP-nedi-9908",
        "numberOfSites": 1,
        "numberOfWorkers": 1,
        "perSiteScaling": false,
        "planName": "VirtualDedicatedPlan",
        "provisioningState": "Succeeded",
        "reserved": true,
        "resourceGroup": "nedi-001",
        "serverFarmId": 13910,
        "siteMode": null,
        "spotExpirationTime": null,
        "status": "Ready",
        "subscription": "ad1010eb-97f6-4f63-980f-5b7f1dc9e295",
        "tags": {
          "app": "nedi",
          "dateCreated": "2021-12-03T17:55:51.3080025Z"
        },
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0,
        "vnetConnectionsMax": 2,
        "vnetConnectionsUsed": 0,
        "webSiteId": null,
        "webSpace": "nedi-WestEuropewebspace-Linux",
        "workerSize": "Default",
        "workerSizeId": 0,
        "workerTierName": null,
        "zoneRedundant": false
      },
      "type": "microsoft.web/serverfarms"
    },
    {
      "name": "ASP-ruschtgroup-95fc",
      "properties": {
        "adminRuntimeSiteName": null,
        "adminSiteName": null,
        "computeMode": "Dynamic",
        "createdTime": "2023-12-21T08:20:53.85Z",
        "currentNumberOfWorkers": 0,
        "currentWorkerSize": "Default",
        "currentWorkerSizeId": 0,
        "elasticScaleEnabled": false,
        "existingServerFarmIds": null,
        "freeOfferExpirationTime": null,
        "geoRegion": "Switzerland North",
        "hostingEnvironment": null,
        "hostingEnvironmentId": null,
        "hostingEnvironmentProfile": null,
        "hyperV": false,
        "isSpot": false,
        "isXenon": false,
        "kind": "functionapp",
        "kubeEnvironmentProfile": null,
        "maximumElasticWorkerCount": 1,
        "maximumNumberOfWorkers": 0,
        "mdmId": "waws-prod-zrh-003_59513",
        "migrateToVMSS": null,
        "name": "ASP-ruschtgroup-95fc",
        "numberOfSites": 1,
        "numberOfWorkers": 0,
        "perSiteScaling": false,
        "planName": "VirtualDedicatedPlan",
        "provisioningState": "Succeeded",
        "reserved": true,
        "resourceGroup": "ruscht_group",
        "serverFarmId": 59513,
        "siteMode": null,
        "spotExpirationTime": null,
        "status": "Ready",
        "subscription": "97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1",
        "tags": {},
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0,
        "vnetConnectionsMax": 2,
        "vnetConnectionsUsed": 0,
        "webSiteId": null,
        "webSpace": "ruscht_group-SwitzerlandNorthwebspace-Linux",
        "workerSize": "Default",
        "workerSizeId": 0,
        "workerTierName": null,
        "zoneRedundant": false
      },
      "type": "microsoft.web/serverfarms"
    },
    {
      "name": "ASP-uakari-e051",
      "properties": {
        "adminRuntimeSiteName": null,
        "adminSiteName": null,
        "computeMode": "Dynamic",
        "createdTime": "0001-01-01T00:00:00Z",
        "currentNumberOfWorkers": 0,
        "currentWorkerSize": "Default",
        "currentWorkerSizeId": 0,
        "elasticScaleEnabled": false,
        "existingServerFarmIds": null,
        "freeOfferExpirationTime": null,
        "geoRegion": "Switzerland North",
        "hostingEnvironment": null,
        "hostingEnvironmentId": null,
        "hostingEnvironmentProfile": null,
        "hyperV": false,
        "isSpot": false,
        "isXenon": false,
        "kind": "functionapp",
        "kubeEnvironmentProfile": null,
        "maximumElasticWorkerCount": 1,
        "maximumNumberOfWorkers": 0,
        "mdmId": "waws-prod-zrh-003_53794",
        "migrateToVMSS": null,
        "name": "ASP-uakari-e051",
        "numberOfSites": 1,
        "numberOfWorkers": 0,
        "perSiteScaling": false,
        "planName": "VirtualDedicatedPlan",
        "provisioningState": "Succeeded",
        "reserved": true,
        "resourceGroup": "uakari",
        "serverFarmId": 53794,
        "siteMode": null,
        "spotExpirationTime": null,
        "status": "Ready",
        "subscription": "8388e650-3cfd-4abe-9322-fcb80da875f2",
        "tags": null,
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0,
        "vnetConnectionsMax": 2,
        "vnetConnectionsUsed": 0,
        "webSiteId": null,
        "webSpace": "uakari-SwitzerlandNorthwebspace-Linux",
        "workerSize": "Default",
        "workerSizeId": 0,
        "workerTierName": null,
        "zoneRedundant": false
      },
      "type": "microsoft.web/serverfarms"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "Application Insights Smart Detection",
      "properties": {
        "armRoleReceivers": [
          {
            "name": "Monitoring Contributor",
            "roleId": "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
            "useCommonAlertSchema": true
          },
          {
            "name": "Monitoring Reader",
            "roleId": "43d0d8ad-25c7-4714-9337-8ba259a9fe05",
            "useCommonAlertSchema": true
          }
        ],
        "automationRunbookReceivers": [],
        "azureAppPushReceivers": [],
        "azureFunctionReceivers": [],
        "emailReceivers": [],
        "enabled": true,
        "eventHubReceivers": [],
        "groupShortName": "SmartDetect",
        "itsmReceivers": [],
        "logicAppReceivers": [],
        "smsReceivers": [],
        "voiceReceivers": [],
        "webhookReceivers": []
      },
      "type": "microsoft.insights/actiongroups"
    },
    {
      "name": "AzureAutomationTutorial",
      "properties": {
        "creationTime": "2022-10-05T05:55:10.44Z",
        "description": " An example runbook which gets all the ARM resources using the Run As Account (Service Principal).",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-10-05T05:55:10.44Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "GraphPowerShell",
        "serviceManagementTags": null,
        "state": "New"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzureAutomationTutorialScript",
      "properties": {
        "creationTime": "2022-10-04T12:08:37.723Z",
        "description": " An example runbook which gets all the ARM resources using the Run As Account (Service Principal).",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-10-04T12:08:37.723Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "PowerShell",
        "serviceManagementTags": null,
        "state": "New"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzureAutomationTutorialWithIdentity",
      "properties": {
        "creationTime": "2022-03-28T08:34:14.59Z",
        "description": " An example runbook which gets all the ARM resources using the Managed Identity.",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-03-28T08:34:14.5933333Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "PowerShell",
        "serviceManagementTags": null,
        "state": "Published"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzureAutomationTutorialWithIdentity",
      "properties": {
        "creationTime": "2022-10-04T12:07:49.6Z",
        "description": " An example runbook which gets all the ARM resources using the Managed Identity.",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-10-04T12:07:49.603Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "PowerShell",
        "serviceManagementTags": null,
        "state": "Published"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzureAutomationTutorialWithIdentityGraphical",
      "properties": {
        "creationTime": "2022-10-04T12:07:49.733Z",
        "description": " An example runbook which gets all the ARM resources using the Managed Identity.",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-10-04T12:07:49.737Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "GraphPowerShell",
        "serviceManagementTags": null,
        "state": "Published"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzureAutomationTutorialWithIdentityGraphical",
      "properties": {
        "creationTime": "2022-03-28T08:34:14.72Z",
        "description": " An example runbook which gets all the ARM resources using the Managed Identity.",
        "jobCount": 0,
        "lastModifiedBy": null,
        "lastModifiedTime": "2022-03-28T08:34:14.72Z",
        "logActivityTrace": 0,
        "logProgress": false,
        "logVerbose": false,
        "outputTypes": [],
        "parameters": {},
        "provisioningState": "Succeeded",
        "runbookType": "GraphPowerShell",
        "serviceManagementTags": null,
        "state": "Published"
      },
      "type": "microsoft.automation/automationaccounts/runbooks"
    },
    {
      "name": "AzurePolicyforLinux",
      "properties": {
        "autoUpgradeMinorVersion": true,
        "enableAutomaticUpgrade": true,
        "provisioningState": "Succeeded",
        "publisher": "Microsoft.GuestConfiguration",
        "settings": {},
        "type": "ConfigurationforLinux",
        "typeHandlerVersion": "1.0"
      },
      "type": "microsoft.compute/virtualmachines/extensions"
    },
    {
      "name": "ChangeTracking(jim-law-001)",
      "properties": {
        "configurations": [],
        "containedResources": [
          "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.OperationalInsights/workspaces/jim-law-001/views/ChangeTracking(jim-law-001)"
        ],
        "creationTime": "Mon, 28 Mar 2022 08:36:11 GMT",
        "lastModifiedTime": "Mon, 28 Mar 2022 08:36:26 GMT",
        "provisioningState": "Succeeded",
        "workspaceResourceId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.OperationalInsights/workspaces/jim-law-001"
      },
      "type": "microsoft.operationsmanagement/solutions"
    },
    {
      "name": "Collab-Lab-SBC-nsg",
      "properties": {
        "defaultSecurityRules": [
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/AllowVnetInBound",
            "name": "AllowVnetInBound",
            "properties": {
              "access": "Allow",
              "description": "Allow inbound traffic from all VMs in VNET",
              "destinationAddressPrefix": "VirtualNetwork",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65000,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "VirtualNetwork",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound",
            "name": "AllowAzureLoadBalancerInBound",
            "properties": {
              "access": "Allow",
              "description": "Allow inbound traffic from azure load balancer",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65001,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "AzureLoadBalancer",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/DenyAllInBound",
            "name": "DenyAllInBound",
            "properties": {
              "access": "Deny",
              "description": "Deny all inbound traffic",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65500,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/AllowVnetOutBound",
            "name": "AllowVnetOutBound",
            "properties": {
              "access": "Allow",
              "description": "Allow outbound traffic from all VMs to all VMs in VNET",
              "destinationAddressPrefix": "VirtualNetwork",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65000,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "VirtualNetwork",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/AllowInternetOutBound",
            "name": "AllowInternetOutBound",
            "properties": {
              "access": "Allow",
              "description": "Allow outbound traffic from all VMs to Internet",
              "destinationAddressPrefix": "Internet",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65001,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/defaultSecurityRules/DenyAllOutBound",
            "name": "DenyAllOutBound",
            "properties": {
              "access": "Deny",
              "description": "Deny all outbound traffic",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65500,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          }
        ],
        "networkInterfaces": [
          {
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkInterfaces/collab-lab-sbc253",
            "resourceGroup": "rg-collab-sbc"
          },
          {
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkInterfaces/collab-lab-sbc2",
            "resourceGroup": "rg-collab-sbc"
          }
        ],
        "provisioningState": "Succeeded",
        "resourceGuid": "00777a1b-772c-43cd-aae6-afd179d2ba0c",
        "securityRules": [
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowMSU-Home-SSHInbound",
            "name": "AllowMSU-Home-SSHInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "22",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1030,
              "protocol": "TCP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "84.226.92.207",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowNetcloud-SSHInbound",
            "name": "AllowNetcloud-SSHInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "22",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1029,
              "protocol": "TCP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "195.8.198.0/24",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowCidrBlockHTTPSInbound",
            "name": "AllowCidrBlockHTTPSInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "443",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1040,
              "protocol": "TCP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "195.8.198.0/24",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowMSUHTTPSInbound",
            "name": "AllowMSUHTTPSInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "443",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1050,
              "protocol": "TCP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "84.226.92.207",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowSIPInbound",
            "name": "AllowSIPInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "5061-5079",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1070,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "52.122.0.0/15",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowSIPInbound-2",
            "name": "AllowSIPInbound-2",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "5061-5079",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1060,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "52.112.0.0/14",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowRTPInbound",
            "name": "AllowRTPInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "16384-32766",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1080,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "52.112.0.0/14",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowRTPInbound-2",
            "name": "AllowRTPInbound-2",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "16384-32766",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1090,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "52.120.0.0/14",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowICMPInbound",
            "name": "AllowICMPInbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1100,
              "protocol": "ICMP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"edd93fc1-70ac-4de7-aa80-8122ae0420a5\"",
            "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkSecurityGroups/Collab-Lab-SBC-nsg/securityRules/AllowAnyCustom5070Inbound",
            "name": "AllowAnyCustom5070Inbound",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "5070",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 1110,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "rg-collab-sbc",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          }
        ]
      },
      "type": "microsoft.network/networksecuritygroups"
    },
    {
      "name": "Collab-Lab-SBC-public",
      "properties": {
        "idleTimeoutInMinutes": 4,
        "ipAddress": "20.203.241.244",
        "ipConfiguration": {
          "id": "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourceGroups/rg-collab-sbc/providers/Microsoft.Network/networkInterfaces/collab-lab-sbc253/ipConfigurations/ipconfig1",
          "resourceGroup": "rg-collab-sbc"
        },
        "ipTags": [],
        "provisioningState": "Succeeded",
        "publicIPAddressVersion": "IPv4",
        "publicIPAllocationMethod": "Static",
        "resourceGuid": "7c0690ce-ddf5-4cb6-a2e4-9b76c7bd2756"
      },
      "type": "microsoft.network/publicipaddresses"
    },
    {
      "name": "DefaultWorkspace-170a8b5b-d291-4238-af26-44482b44afd9-EUS",
      "properties": {
        "createdDate": "2023-11-10T15:34:52.3305395Z",
        "customerId": "68721089-ecbe-4714-a1d4-fa209d912bc1",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2023-11-10T15:34:53.7094094Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2023-11-10T15:34:52.3305395Z",
          "name": "perGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2023-11-11T02:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-350a807a-2496-4b95-9da5-aa0ee242d851-WEU",
      "properties": {
        "createdDate": "2023-07-07T08:21:23.5582722Z",
        "customerId": "3b119621-81a6-4641-9f52-3b2e22d231f8",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2023-07-07T08:21:23.5582722Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2023-07-07T08:21:23.5582722Z",
          "name": "pergb2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2023-07-08T01:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-5c14603b-c025-47d7-99ed-bf121addc5d3-CHN",
      "properties": {
        "createdDate": "2024-09-17T21:23:27.7517279Z",
        "customerId": "f5997e98-88bd-4e45-9af2-2482bca29e24",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2024-09-17T21:23:32.3244673Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2024-09-17T21:23:27.7517279Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2024-09-18T17:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-84e47cef-bcf9-4e86-a0ef-fc80391a82cc-CHN",
      "properties": {
        "createdDate": "2024-10-30T16:55:38.1923227Z",
        "customerId": "d6277476-3b8e-41eb-b667-115eb553ed61",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2024-10-30T16:55:41.1450835Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2024-10-30T16:55:38.1923227Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2024-10-31T07:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-84e47cef-bcf9-4e86-a0ef-fc80391a82cc-WEU",
      "properties": {
        "createdDate": "2024-09-15T19:34:37.3544267Z",
        "customerId": "cd33a342-ccc9-4345-acea-c2bdd077de69",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2024-09-15T19:34:38.8786614Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2024-09-15T19:34:37.3544267Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2024-09-16T19:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-8ec22a89-5b71-4558-ab8c-d66de409a500-CHN",
      "properties": {
        "createdDate": "2022-03-29T10:38:36.5141618Z",
        "customerId": "d60edf7b-6898-4097-b200-debdbda8ffb8",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2022-03-29T10:38:36.5141618Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2022-03-29T10:38:36.5141618Z",
          "name": "perGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2022-03-30T06:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-8ec22a89-5b71-4558-ab8c-d66de409a500-EUS",
      "properties": {
        "createdDate": "2024-09-27T18:31:26.0662553Z",
        "customerId": "2dff01d2-295e-47a4-86ba-49e4390c496e",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2024-09-27T18:31:27.0855939Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2024-09-27T18:31:26.0662553Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2024-09-28T15:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1-CHN",
      "properties": {
        "createdDate": "2023-12-21T08:20:53.6679267Z",
        "customerId": "376f7f69-f698-4ec5-afb3-11896b4d632c",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2023-12-21T08:20:55.8120364Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2023-12-21T08:20:53.6679267Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2023-12-22T07:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-9db2792a-3551-43a5-be87-068751dd95d5-CHN",
      "properties": {
        "createdDate": "2024-11-18T10:41:54.0901749Z",
        "customerId": "0577da20-0104-49ea-8d43-7f9367eaef54",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2024-11-18T10:41:57.6601318Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2024-11-18T10:41:54.0901749Z",
          "name": "PerGB2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2024-11-19T07:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DefaultWorkspace-c26f7f65-7f80-4e0e-a7f9-d8c51dbe7489-CHN",
      "properties": {
        "createdDate": "2023-06-28T16:25:04.4511416Z",
        "customerId": "e2c040dd-2ed4-4a9e-8aec-8396aaff32ee",
        "features": {
          "enableLogAccessUsingOnlyResourcePermissions": true,
          "legacy": 0,
          "searchVersion": 1
        },
        "modifiedDate": "2023-06-28T16:25:04.4511416Z",
        "provisioningState": "Succeeded",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled",
        "retentionInDays": 30,
        "sku": {
          "lastSkuUpdate": "2023-06-28T16:25:04.4511416Z",
          "name": "pergb2018"
        },
        "workspaceCapping": {
          "dailyQuotaGb": -1.0,
          "dataIngestionStatus": "RespectQuota",
          "quotaNextResetTime": "2023-06-29T16:00:00Z"
        }
      },
      "type": "microsoft.operationalinsights/workspaces"
    },
    {
      "name": "DnsAnalytics(jim-law-001)",
      "properties": {
        "containedResources": [
          "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.OperationalInsights/workspaces/jim-law-001/views/DnsAnalytics(jim-law-001)"
        ],
        "creationTime": "Wed, 30 Mar 2022 06:54:39 GMT",
        "lastModifiedTime": "Wed, 30 Mar 2022 06:54:39 GMT",
        "provisioningState": "Succeeded",
        "workspaceResourceId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-md01/providers/Microsoft.OperationalInsights/workspaces/jim-law-001"
      },
      "type": "microsoft.operationsmanagement/solutions"
    },
    {
      "name": "Failure Anomalies - ipam-hxezp2m3h5znq",
      "properties": {
        "actionGroups": {
          "customEmailSubject": null,
          "customWebhookPayload": null,
          "groupIds": [
            "/subscriptions/c26f7f65-7f80-4e0e-a7f9-d8c51dbe7489/resourcegroups/ipam-rg-hxezp2m3h5znq/providers/microsoft.insights/actiongroups/application insights smart detection"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "description": "Detects if your application experiences an abnormal rise in the rate of HTTP requests or dependency calls that are reported as failed. The anomaly detection uses machine learning algorithms and occurs in near real time, therefore there's no need to define a frequency for this signal.<br><br>To help you triage and diagnose the problem, an analysis of the characteristics of the failures and related telemetry is provided with the detection. This feature works for any app, hosted in the cloud or on your own servers, that generates request or dependency telemetry - for example, if you have a worker role that calls <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackrequest\\\" target=\\\"_blank\\\">TrackRequest()</a> or <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackdependency\\\" target=\\\"_blank\\\">TrackDependency()</a>.<br/><br/><a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/azure-monitor/app/proactive-failure-diagnostics\\\" target=\\\"_blank\\\">Learn more about Failure Anomalies</a><br><br><p style=\\\"font-size: 13px; font-weight: 700;\\\">A note about your data privacy:</p><br><br>The service is entirely automatic and only you can see these notifications. <a class=\\\"ext-smartDetecor-link\\\" href=\\\"https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-retention-privacy\\\" target=\\\"_blank\\\">Read more about data privacy</a><br><br>Smart Alerts conditions can't be edited or added for now.",
          "id": "FailureAnomaliesDetector",
          "name": "Failure Anomalies",
          "parameterDefinitions": [],
          "parameters": null,
          "supportedCadences": [
            1
          ],
          "supportedResourceTypes": [
            "ApplicationInsights"
          ]
        },
        "frequency": "PT1M",
        "scope": [
          "/subscriptions/c26f7f65-7f80-4e0e-a7f9-d8c51dbe7489/resourcegroups/ipam-rg-hxezp2m3h5znq/providers/microsoft.insights/components/ipam-hxezp2m3h5znq"
        ],
        "severity": "Sev3",
        "state": "Enabled",
        "throttling": null
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "name": "Failure Anomalies - ruscht",
      "properties": {
        "actionGroups": {
          "customEmailSubject": null,
          "customWebhookPayload": null,
          "groupIds": [
            "/subscriptions/97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1/resourcegroups/sls-swin-dev-return-ip-rg/providers/microsoft.insights/actiongroups/application insights smart detection"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "description": "Detects if your application experiences an abnormal rise in the rate of HTTP requests or dependency calls that are reported as failed. The anomaly detection uses machine learning algorithms and occurs in near real time, therefore there's no need to define a frequency for this signal.<br><br>To help you triage and diagnose the problem, an analysis of the characteristics of the failures and related telemetry is provided with the detection. This feature works for any app, hosted in the cloud or on your own servers, that generates request or dependency telemetry - for example, if you have a worker role that calls <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackrequest\\\" target=\\\"_blank\\\">TrackRequest()</a> or <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackdependency\\\" target=\\\"_blank\\\">TrackDependency()</a>.<br/><br/><a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/azure-monitor/app/proactive-failure-diagnostics\\\" target=\\\"_blank\\\">Learn more about Failure Anomalies</a><br><br><p style=\\\"font-size: 13px; font-weight: 700;\\\">A note about your data privacy:</p><br><br>The service is entirely automatic and only you can see these notifications. <a class=\\\"ext-smartDetecor-link\\\" href=\\\"https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-retention-privacy\\\" target=\\\"_blank\\\">Read more about data privacy</a><br><br>Smart Alerts conditions can't be edited or added for now.",
          "id": "FailureAnomaliesDetector",
          "name": "Failure Anomalies",
          "parameterDefinitions": [],
          "parameters": null,
          "supportedCadences": [
            1
          ],
          "supportedResourceTypes": [
            "ApplicationInsights"
          ]
        },
        "frequency": "PT1M",
        "scope": [
          "/subscriptions/97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1/resourcegroups/ruscht_group/providers/microsoft.insights/components/ruscht"
        ],
        "severity": "Sev3",
        "state": "Enabled",
        "throttling": null
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "name": "Failure Anomalies - sls-swin-dev-a1a064-appinsights",
      "properties": {
        "actionGroups": {
          "customEmailSubject": null,
          "customWebhookPayload": null,
          "groupIds": [
            "/subscriptions/97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1/resourcegroups/sls-swin-dev-return-ip-rg/providers/microsoft.insights/actiongroups/application insights smart detection"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "description": "Detects if your application experiences an abnormal rise in the rate of HTTP requests or dependency calls that are reported as failed. The anomaly detection uses machine learning algorithms and occurs in near real time, therefore there's no need to define a frequency for this signal.<br><br>To help you triage and diagnose the problem, an analysis of the characteristics of the failures and related telemetry is provided with the detection. This feature works for any app, hosted in the cloud or on your own servers, that generates request or dependency telemetry - for example, if you have a worker role that calls <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackrequest\\\" target=\\\"_blank\\\">TrackRequest()</a> or <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackdependency\\\" target=\\\"_blank\\\">TrackDependency()</a>.<br/><br/><a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/azure-monitor/app/proactive-failure-diagnostics\\\" target=\\\"_blank\\\">Learn more about Failure Anomalies</a><br><br><p style=\\\"font-size: 13px; font-weight: 700;\\\">A note about your data privacy:</p><br><br>The service is entirely automatic and only you can see these notifications. <a class=\\\"ext-smartDetecor-link\\\" href=\\\"https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-retention-privacy\\\" target=\\\"_blank\\\">Read more about data privacy</a><br><br>Smart Alerts conditions can't be edited or added for now.",
          "id": "FailureAnomaliesDetector",
          "name": "Failure Anomalies",
          "parameterDefinitions": [],
          "parameters": null,
          "supportedCadences": [
            1
          ],
          "supportedResourceTypes": [
            "ApplicationInsights"
          ]
        },
        "frequency": "PT1M",
        "scope": [
          "/subscriptions/97ea5bcc-58d3-41bd-894f-2fe0c7b23ef1/resourcegroups/sls-swin-dev-return-ip-rg/providers/microsoft.insights/components/sls-swin-dev-a1a064-appinsights"
        ],
        "severity": "Sev3",
        "state": "Enabled",
        "throttling": null
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "name": "Failure Anomalies - task1azure",
      "properties": {
        "actionGroups": {
          "customEmailSubject": null,
          "customWebhookPayload": null,
          "groupIds": [
            "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourcegroups/task1azure-rg/providers/microsoft.insights/actiongroups/application insights smart detection"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "description": "Detects if your application experiences an abnormal rise in the rate of HTTP requests or dependency calls that are reported as failed. The anomaly detection uses machine learning algorithms and occurs in near real time, therefore there's no need to define a frequency for this signal.<br><br>To help you triage and diagnose the problem, an analysis of the characteristics of the failures and related telemetry is provided with the detection. This feature works for any app, hosted in the cloud or on your own servers, that generates request or dependency telemetry - for example, if you have a worker role that calls <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackrequest\\\" target=\\\"_blank\\\">TrackRequest()</a> or <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackdependency\\\" target=\\\"_blank\\\">TrackDependency()</a>.<br/><br/><a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/azure-monitor/app/proactive-failure-diagnostics\\\" target=\\\"_blank\\\">Learn more about Failure Anomalies</a><br><br><p style=\\\"font-size: 13px; font-weight: 700;\\\">A note about your data privacy:</p><br><br>The service is entirely automatic and only you can see these notifications. <a class=\\\"ext-smartDetecor-link\\\" href=\\\"https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-retention-privacy\\\" target=\\\"_blank\\\">Read more about data privacy</a><br><br>Smart Alerts conditions can't be edited or added for now.",
          "id": "FailureAnomaliesDetector",
          "name": "Failure Anomalies",
          "parameterDefinitions": [],
          "parameters": null,
          "supportedCadences": [
            1
          ],
          "supportedResourceTypes": [
            "ApplicationInsights"
          ]
        },
        "frequency": "PT1M",
        "scope": [
          "/subscriptions/8e5603b6-2131-4cec-971a-3118c98d8833/resourcegroups/task1azure-rg/providers/microsoft.insights/components/task1azure"
        ],
        "severity": "Sev3",
        "state": "Enabled",
        "throttling": null
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "name": "Failure Anomalies - uakari",
      "properties": {
        "actionGroups": {
          "customEmailSubject": null,
          "customWebhookPayload": null,
          "groupIds": [
            "/subscriptions/8388e650-3cfd-4abe-9322-fcb80da875f2/resourcegroups/uakari/providers/microsoft.insights/actiongroups/application insights smart detection"
          ]
        },
        "description": "Failure Anomalies notifies you of an unusual rise in the rate of failed HTTP requests or dependency calls.",
        "detector": {
          "description": "Detects if your application experiences an abnormal rise in the rate of HTTP requests or dependency calls that are reported as failed. The anomaly detection uses machine learning algorithms and occurs in near real time, therefore there's no need to define a frequency for this signal.<br><br>To help you triage and diagnose the problem, an analysis of the characteristics of the failures and related telemetry is provided with the detection. This feature works for any app, hosted in the cloud or on your own servers, that generates request or dependency telemetry - for example, if you have a worker role that calls <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackrequest\\\" target=\\\"_blank\\\">TrackRequest()</a> or <a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics#trackdependency\\\" target=\\\"_blank\\\">TrackDependency()</a>.<br/><br/><a class=\"ext-smartDetecor-link\" href=\\\"https://docs.microsoft.com/azure/azure-monitor/app/proactive-failure-diagnostics\\\" target=\\\"_blank\\\">Learn more about Failure Anomalies</a><br><br><p style=\\\"font-size: 13px; font-weight: 700;\\\">A note about your data privacy:</p><br><br>The service is entirely automatic and only you can see these notifications. <a class=\\\"ext-smartDetecor-link\\\" href=\\\"https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-retention-privacy\\\" target=\\\"_blank\\\">Read more about data privacy</a><br><br>Smart Alerts conditions can't be edited or added for now.",
          "id": "FailureAnomaliesDetector",
          "name": "Failure Anomalies",
          "parameterDefinitions": [],
          "parameters": null,
          "supportedCadences": [
            1
          ],
          "supportedResourceTypes": [
            "ApplicationInsights"
          ]
        },
        "frequency": "PT1M",
        "scope": [
          "/subscriptions/8388e650-3cfd-4abe-9322-fcb80da875f2/resourcegroups/uakari/providers/microsoft.insights/components/uakari"
        ],
        "severity": "Sev3",
        "state": "Enabled",
        "throttling": null
      },
      "type": "microsoft.alertsmanagement/smartdetectoralertrules"
    },
    {
      "name": "Get-GeoFromIpAndTagIncident",
      "properties": {
        "accessEndpoint": "https://prod-190.westeurope.logic.azure.com:443/workflows/d4b89f6bede340d88ef9ea3c792e6f13",
        "changedTime": "2022-07-15T13:57:45.2897003Z",
        "createdTime": "2022-07-15T13:57:45.2900104Z",
        "definition": {
          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
          "actions": {
            "Alert_-_Get_IPs": {
              "inputs": {
                "body": "@triggerBody()?['Entities']",
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "method": "post",
                "path": "/entities/ip"
              },
              "runAfter": {
                "Alert_-_Get_incident": [
                  "Succeeded"
                ]
              },
              "type": "ApiConnection"
            },
            "Alert_-_Get_incident": {
              "inputs": {
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "method": "get",
                "path": "/Cases/@{encodeURIComponent(triggerBody()?['SystemAlertId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}"
              },
              "runAfter": {},
              "type": "ApiConnection"
            },
            "For_each": {
              "actions": {
                "Add_labels_to_incident": {
                  "inputs": {
                    "body": {
                      "Labels": [
                        {
                          "Label": "@body('Parse_JSON')?['city']"
                        },
                        {
                          "Label": "@body('Parse_JSON')?['country']"
                        }
                      ]
                    },
                    "host": {
                      "connection": {
                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                      }
                    },
                    "method": "put",
                    "path": "/Case/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}/@{encodeURIComponent('Incident')}/@{encodeURIComponent(body('Alert_-_Get_incident')?['properties']?['CaseNumber'])}/AddLabels"
                  },
                  "runAfter": {
                    "Parse_JSON": [
                      "Succeeded"
                    ]
                  },
                  "type": "ApiConnection"
                },
                "HTTP": {
                  "inputs": {
                    "method": "GET",
                    "uri": "http://ip-api.com/json/@{items('For_each')?['Address']}"
                  },
                  "runAfter": {},
                  "type": "Http"
                },
                "Parse_JSON": {
                  "inputs": {
                    "content": "@body('HTTP')",
                    "schema": {
                      "properties": {
                        "as": {
                          "type": "string"
                        },
                        "city": {
                          "type": "string"
                        },
                        "country": {
                          "type": "string"
                        },
                        "countryCode": {
                          "type": "string"
                        },
                        "isp": {
                          "type": "string"
                        },
                        "lat": {
                          "type": "number"
                        },
                        "lon": {
                          "type": "number"
                        },
                        "org": {
                          "type": "string"
                        },
                        "query": {
                          "type": "string"
                        },
                        "region": {
                          "type": "string"
                        },
                        "regionName": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "timezone": {
                          "type": "string"
                        },
                        "zip": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    }
                  },
                  "runAfter": {
                    "HTTP": [
                      "Succeeded"
                    ]
                  },
                  "type": "ParseJson"
                }
              },
              "foreach": "@body('Alert_-_Get_IPs')?['IPs']",
              "runAfter": {
                "Alert_-_Get_IPs": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 1
                }
              },
              "type": "Foreach"
            }
          },
          "contentVersion": "1.0.0.0",
          "outputs": {},
          "parameters": {
            "$connections": {
              "defaultValue": {},
              "type": "Object"
            }
          },
          "triggers": {
            "When_a_response_to_an_Azure_Sentinel_alert_is_triggered": {
              "inputs": {
                "body": {
                  "callback_url": "@{listCallbackUrl()}"
                },
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "path": "/subscribe"
              },
              "type": "ApiConnectionWebhook"
            }
          }
        },
        "endpointsConfiguration": {
          "connector": {
            "outgoingIpAddresses": [
              {
                "address": "52.174.88.118"
              },
              {
                "address": "40.91.208.65"
              },
              {
                "address": "13.69.64.208/28"
              },
              {
                "address": "13.69.71.192/27"
              },
              {
                "address": "13.93.36.78"
              },
              {
                "address": "20.86.93.32/27"
              },
              {
                "address": "20.86.93.64/28"
              },
              {
                "address": "20.126.243.151"
              },
              {
                "address": "20.126.241.238"
              },
              {
                "address": "20.103.132.139"
              },
              {
                "address": "20.103.131.1"
              }
            ]
          },
          "workflow": {
            "accessEndpointIpAddresses": [
              {
                "address": "13.95.155.53"
              },
              {
                "address": "52.174.54.218"
              },
              {
                "address": "52.174.49.6"
              },
              {
                "address": "20.103.21.113"
              },
              {
                "address": "20.103.18.84"
              },
              {
                "address": "20.103.57.210"
              },
              {
                "address": "20.101.174.52"
              },
              {
                "address": "20.93.236.81"
              },
              {
                "address": "20.103.94.255"
              },
              {
                "address": "20.82.87.229"
              },
              {
                "address": "20.76.171.34"
              },
              {
                "address": "20.103.84.61"
              },
              {
                "address": "98.64.193.78"
              },
              {
                "address": "98.64.194.143"
              },
              {
                "address": "98.64.198.223"
              },
              {
                "address": "98.64.198.203"
              },
              {
                "address": "98.64.208.186"
              },
              {
                "address": "98.64.209.52"
              },
              {
                "address": "172.211.196.189"
              },
              {
                "address": "172.211.195.251"
              },
              {
                "address": "98.64.154.66"
              },
              {
                "address": "98.64.156.81"
              },
              {
                "address": "98.64.156.180"
              },
              {
                "address": "98.64.156.68"
              },
              {
                "address": "20.238.229.165"
              },
              {
                "address": "20.8.128.2"
              },
              {
                "address": "20.238.230.113"
              },
              {
                "address": "108.141.139.111"
              },
              {
                "address": "108.142.111.162"
              },
              {
                "address": "108.142.111.174"
              },
              {
                "address": "108.142.111.178"
              },
              {
                "address": "108.142.111.183"
              },
              {
                "address": "108.142.111.152"
              },
              {
                "address": "108.142.111.156"
              },
              {
                "address": "108.142.111.179"
              },
              {
                "address": "108.142.111.169"
              },
              {
                "address": "98.64.203.30"
              },
              {
                "address": "98.64.156.172"
              },
              {
                "address": "20.56.202.157"
              },
              {
                "address": "20.56.203.30"
              },
              {
                "address": "57.153.19.33"
              },
              {
                "address": "57.153.59.202"
              },
              {
                "address": "108.141.95.140"
              },
              {
                "address": "20.61.147.216"
              },
              {
                "address": "57.153.83.52"
              },
              {
                "address": "57.153.38.174"
              },
              {
                "address": "57.153.3.13"
              },
              {
                "address": "57.153.1.223"
              },
              {
                "address": "108.142.29.55"
              },
              {
                "address": "108.142.31.220"
              },
              {
                "address": "108.142.31.202"
              },
              {
                "address": "20.61.153.22"
              },
              {
                "address": "57.153.7.252"
              },
              {
                "address": "108.141.83.61"
              },
              {
                "address": "57.153.7.252"
              },
              {
                "address": "108.141.83.61"
              }
            ],
            "outgoingIpAddresses": [
              {
                "address": "40.68.222.65"
              },
              {
                "address": "40.68.209.23"
              },
              {
                "address": "13.95.147.65"
              },
              {
                "address": "23.97.218.130"
              },
              {
                "address": "51.144.182.201"
              },
              {
                "address": "23.97.211.179"
              },
              {
                "address": "104.45.9.52"
              },
              {
                "address": "23.97.210.126"
              },
              {
                "address": "13.69.71.160"
              },
              {
                "address": "13.69.71.161"
              },
              {
                "address": "13.69.71.162"
              },
              {
                "address": "13.69.71.163"
              },
              {
                "address": "13.69.71.164"
              },
              {
                "address": "13.69.71.165"
              },
              {
                "address": "13.69.71.166"
              },
              {
                "address": "13.69.71.167"
              },
              {
                "address": "20.103.21.81"
              },
              {
                "address": "20.103.17.247"
              },
              {
                "address": "20.103.17.223"
              },
              {
                "address": "20.103.16.47"
              },
              {
                "address": "20.103.58.116"
              },
              {
                "address": "20.103.57.29"
              },
              {
                "address": "20.101.174.49"
              },
              {
                "address": "20.101.174.23"
              },
              {
                "address": "20.93.236.26"
              },
              {
                "address": "20.93.235.107"
              },
              {
                "address": "20.103.94.250"
              },
              {
                "address": "20.76.174.72"
              },
              {
                "address": "20.82.87.192"
              },
              {
                "address": "20.82.87.16"
              },
              {
                "address": "20.76.170.145"
              },
              {
                "address": "20.103.91.39"
              },
              {
                "address": "20.103.84.41"
              },
              {
                "address": "20.76.161.156"
              },
              {
                "address": "98.64.193.64"
              },
              {
                "address": "98.64.194.135"
              },
              {
                "address": "98.64.198.219"
              },
              {
                "address": "98.64.198.194"
              },
              {
                "address": "98.64.208.46"
              },
              {
                "address": "98.64.209.43"
              },
              {
                "address": "172.211.196.188"
              },
              {
                "address": "172.211.195.181"
              },
              {
                "address": "98.64.157.37"
              },
              {
                "address": "98.64.156.69"
              },
              {
                "address": "98.64.156.152"
              },
              {
                "address": "98.64.156.62"
              },
              {
                "address": "20.238.229.108"
              },
              {
                "address": "108.141.139.225"
              },
              {
                "address": "20.238.230.87"
              },
              {
                "address": "108.141.139.80"
              },
              {
                "address": "108.142.111.161"
              },
              {
                "address": "108.142.111.173"
              },
              {
                "address": "108.142.111.175"
              },
              {
                "address": "108.142.111.182"
              },
              {
                "address": "108.142.111.151"
              },
              {
                "address": "108.142.111.155"
              },
              {
                "address": "108.142.111.157"
              },
              {
                "address": "108.142.111.167"
              },
              {
                "address": "98.64.203.5"
              },
              {
                "address": "98.64.156.150"
              },
              {
                "address": "20.56.202.134"
              },
              {
                "address": "20.56.202.244"
              },
              {
                "address": "57.153.19.27"
              },
              {
                "address": "57.153.59.193"
              },
              {
                "address": "108.141.95.129"
              },
              {
                "address": "20.61.147.200"
              },
              {
                "address": "57.153.83.40"
              },
              {
                "address": "57.153.38.60"
              },
              {
                "address": "57.153.2.162"
              },
              {
                "address": "57.153.1.215"
              },
              {
                "address": "108.142.24.182"
              },
              {
                "address": "108.142.31.170"
              },
              {
                "address": "108.142.31.143"
              },
              {
                "address": "20.61.152.226"
              },
              {
                "address": "57.153.7.245"
              },
              {
                "address": "108.141.83.46"
              },
              {
                "address": "57.153.7.245"
              },
              {
                "address": "108.141.83.46"
              }
            ]
          }
        },
        "parameters": {
          "$connections": {
            "value": {
              "azuresentinel": {
                "connectionId": "/subscriptions/607065e4-46e5-4876-8cc1-8aaa743fa11d/resourceGroups/rg-msa-sentinel-lab/providers/Microsoft.Web/connections/azuresentinel-Get-GeoFromIpAndTagIncident",
                "connectionName": "azuresentinel-Get-GeoFromIpAndTagIncident",
                "id": "/subscriptions/607065e4-46e5-4876-8cc1-8aaa743fa11d/providers/Microsoft.Web/locations/westeurope/managedApis/azuresentinel"
              }
            }
          }
        },
        "provisioningState": "Succeeded",
        "state": "Enabled",
        "version": "08585437134202126824"
      },
      "type": "microsoft.logic/workflows"
    },
    {
      "name": "Get-GeoFromIpAndTagIncident",
      "properties": {
        "accessEndpoint": "https://prod-01.switzerlandnorth.logic.azure.com:443/workflows/6d317e2263fa48539fd56a6bcbff3eb5",
        "changedTime": "2022-09-22T09:35:34.5891672Z",
        "createdTime": "2022-09-22T09:35:34.5920533Z",
        "definition": {
          "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
          "actions": {
            "Alert_-_Get_IPs": {
              "inputs": {
                "body": "@triggerBody()?['Entities']",
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "method": "post",
                "path": "/entities/ip"
              },
              "runAfter": {
                "Alert_-_Get_incident": [
                  "Succeeded"
                ]
              },
              "type": "ApiConnection"
            },
            "Alert_-_Get_incident": {
              "inputs": {
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "method": "get",
                "path": "/Cases/@{encodeURIComponent(triggerBody()?['SystemAlertId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}"
              },
              "runAfter": {},
              "type": "ApiConnection"
            },
            "For_each": {
              "actions": {
                "Add_labels_to_incident": {
                  "inputs": {
                    "body": {
                      "Labels": [
                        {
                          "Label": "@body('Parse_JSON')?['city']"
                        },
                        {
                          "Label": "@body('Parse_JSON')?['country']"
                        }
                      ]
                    },
                    "host": {
                      "connection": {
                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                      }
                    },
                    "method": "put",
                    "path": "/Case/@{encodeURIComponent(triggerBody()?['WorkspaceSubscriptionId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceId'])}/@{encodeURIComponent(triggerBody()?['WorkspaceResourceGroup'])}/@{encodeURIComponent('Incident')}/@{encodeURIComponent(body('Alert_-_Get_incident')?['properties']?['CaseNumber'])}/AddLabels"
                  },
                  "runAfter": {
                    "Parse_JSON": [
                      "Succeeded"
                    ]
                  },
                  "type": "ApiConnection"
                },
                "HTTP": {
                  "inputs": {
                    "method": "GET",
                    "uri": "http://ip-api.com/json/@{items('For_each')?['Address']}"
                  },
                  "runAfter": {},
                  "type": "Http"
                },
                "Parse_JSON": {
                  "inputs": {
                    "content": "@body('HTTP')",
                    "schema": {
                      "properties": {
                        "as": {
                          "type": "string"
                        },
                        "city": {
                          "type": "string"
                        },
                        "country": {
                          "type": "string"
                        },
                        "countryCode": {
                          "type": "string"
                        },
                        "isp": {
                          "type": "string"
                        },
                        "lat": {
                          "type": "number"
                        },
                        "lon": {
                          "type": "number"
                        },
                        "org": {
                          "type": "string"
                        },
                        "query": {
                          "type": "string"
                        },
                        "region": {
                          "type": "string"
                        },
                        "regionName": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "timezone": {
                          "type": "string"
                        },
                        "zip": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    }
                  },
                  "runAfter": {
                    "HTTP": [
                      "Succeeded"
                    ]
                  },
                  "type": "ParseJson"
                }
              },
              "foreach": "@body('Alert_-_Get_IPs')?['IPs']",
              "runAfter": {
                "Alert_-_Get_IPs": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 1
                }
              },
              "type": "Foreach"
            }
          },
          "contentVersion": "1.0.0.0",
          "outputs": {},
          "parameters": {
            "$connections": {
              "defaultValue": {},
              "type": "Object"
            }
          },
          "triggers": {
            "When_a_response_to_an_Azure_Sentinel_alert_is_triggered": {
              "inputs": {
                "body": {
                  "callback_url": "@{listCallbackUrl()}"
                },
                "host": {
                  "connection": {
                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                  }
                },
                "path": "/subscribe"
              },
              "type": "ApiConnectionWebhook"
            }
          }
        },
        "endpointsConfiguration": {
          "connector": {
            "outgoingIpAddresses": [
              {
                "address": "51.103.142.22"
              },
              {
                "address": "51.107.86.217"
              },
              {
                "address": "51.107.59.16/28"
              },
              {
                "address": "51.107.60.224/27"
              },
              {
                "address": "51.107.246.112/28"
              },
              {
                "address": "51.107.246.128/27"
              }
            ]
          },
          "workflow": {
            "accessEndpointIpAddresses": [
              {
                "address": "51.103.128.52"
              },
              {
                "address": "51.103.132.236"
              },
              {
                "address": "51.103.134.138"
              },
              {
                "address": "51.103.136.209"
              },
              {
                "address": "20.203.230.170"
              },
              {
                "address": "20.203.227.226"
              },
              {
                "address": "4.226.35.171"
              },
              {
                "address": "20.250.239.241"
              },
              {
                "address": "20.250.238.113"
              },
              {
                "address": "20.250.238.80"
              },
              {
                "address": "20.250.233.38"
              },
              {
                "address": "20.250.235.79"
              },
              {
                "address": "20.250.235.177"
              },
              {
                "address": "20.250.235.117"
              }
            ],
            "outgoingIpAddresses": [
              {
                "address": "51.103.137.79"
              },
              {
                "address": "51.103.135.51"
              },
              {
                "address": "51.103.139.122"
              },
              {
                "address": "51.103.134.69"
              },
              {
                "address": "51.103.138.96"
              },
              {
                "address": "51.103.138.28"
              },
              {
                "address": "51.103.136.37"
              },
              {
                "address": "51.103.136.210"
              },
              {
                "address": "20.203.230.58"
              },
              {
                "address": "20.203.229.127"
              },
              {
                "address": "20.203.224.37"
              },
              {
                "address": "20.203.225.242"
              },
              {
                "address": "4.226.35.166"
              },
              {
                "address": "20.250.239.202"
              },
              {
                "address": "20.250.239.33"
              },
              {
                "address": "20.250.239.55"
              },
              {
                "address": "20.250.233.27"
              },
              {
                "address": "20.250.235.76"
              },
              {
                "address": "20.250.235.169"
              },
              {
                "address": "20.250.235.96"
              }
            ]
          }
        },
        "parameters": {
          "$connections": {
            "value": {
              "azuresentinel": {
                "connectionId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-rg-MD01/providers/Microsoft.Web/connections/azuresentinel-Get-GeoFromIpAndTagIncident",
                "connectionName": "azuresentinel-Get-GeoFromIpAndTagIncident",
                "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/providers/Microsoft.Web/locations/switzerlandnorth/managedApis/azuresentinel"
              }
            }
          }
        },
        "provisioningState": "Succeeded",
        "state": "Enabled",
        "version": "08585377675514719771"
      },
      "type": "microsoft.logic/workflows"
    },
    {
      "name": "JIM-LIN-101",
      "properties": {
        "additionalCapabilities": {
          "hibernationEnabled": false
        },
        "diagnosticsProfile": {
          "bootDiagnostics": {
            "enabled": true
          }
        },
        "extended": {
          "instanceView": {
            "computerName": "JIM-LIN-101",
            "hyperVGeneration": "V2",
            "osName": "ubuntu",
            "osVersion": "24.04",
            "powerState": {
              "code": "PowerState/running",
              "displayStatus": "VM running",
              "level": "Info"
            }
          }
        },
        "hardwareProfile": {
          "vmSize": "Standard_B2ats_v2"
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkInterfaces/jim-lin-101932_z1",
              "properties": {
                "deleteOption": "Detach"
              },
              "resourceGroup": "jim-islab-001"
            }
          ]
        },
        "osProfile": {
          "adminUsername": "hslupoc",
          "allowExtensionOperations": true,
          "computerName": "JIM-LIN-101",
          "linuxConfiguration": {
            "disablePasswordAuthentication": false,
            "patchSettings": {
              "assessmentMode": "ImageDefault",
              "patchMode": "ImageDefault"
            },
            "provisionVMAgent": true
          },
          "requireGuestProvisionSignal": true,
          "secrets": []
        },
        "provisioningState": "Succeeded",
        "securityProfile": {
          "securityType": "TrustedLaunch",
          "uefiSettings": {
            "secureBootEnabled": true,
            "vTpmEnabled": true
          }
        },
        "storageProfile": {
          "dataDisks": [],
          "diskControllerType": "SCSI",
          "imageReference": {
            "exactVersion": "24.04.202409260",
            "offer": "ubuntu-24_04-lts",
            "publisher": "canonical",
            "sku": "server",
            "version": "latest"
          },
          "osDisk": {
            "caching": "ReadWrite",
            "createOption": "FromImage",
            "deleteOption": "Delete",
            "diskSizeGB": 30,
            "managedDisk": {
              "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/JIM-ISLAB-001/providers/Microsoft.Compute/disks/JIM-LIN-101_OsDisk_1_1edbc1f79f6f4b7fba6dca4befdc5a08",
              "resourceGroup": "JIM-ISLAB-001",
              "storageAccountType": "Premium_LRS"
            },
            "name": "JIM-LIN-101_OsDisk_1_1edbc1f79f6f4b7fba6dca4befdc5a08",
            "osType": "Linux"
          }
        },
        "timeCreated": "2024-09-27T07:33:14.53Z",
        "vmId": "72083829-1122-4ac9-933e-535a97a9bfb0"
      },
      "type": "microsoft.compute/virtualmachines"
    },
    {
      "name": "JIM-LIN-101-ip",
      "properties": {
        "idleTimeoutInMinutes": 4,
        "ipAddress": "20.55.26.220",
        "ipConfiguration": {
          "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkInterfaces/jim-lin-101932_z1/ipConfigurations/ipconfig1",
          "resourceGroup": "jim-islab-001"
        },
        "ipTags": [],
        "provisioningState": "Succeeded",
        "publicIPAddressVersion": "IPv4",
        "publicIPAllocationMethod": "Static",
        "resourceGuid": "ff0fa8db-46e8-4909-a192-87e058425c68"
      },
      "type": "microsoft.network/publicipaddresses"
    },
    {
      "name": "JIM-LIN-101-nsg",
      "properties": {
        "defaultSecurityRules": [
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/AllowVnetInBound",
            "name": "AllowVnetInBound",
            "properties": {
              "access": "Allow",
              "description": "Allow inbound traffic from all VMs in VNET",
              "destinationAddressPrefix": "VirtualNetwork",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65000,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "VirtualNetwork",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/AllowAzureLoadBalancerInBound",
            "name": "AllowAzureLoadBalancerInBound",
            "properties": {
              "access": "Allow",
              "description": "Allow inbound traffic from azure load balancer",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65001,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "AzureLoadBalancer",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/DenyAllInBound",
            "name": "DenyAllInBound",
            "properties": {
              "access": "Deny",
              "description": "Deny all inbound traffic",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 65500,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/AllowVnetOutBound",
            "name": "AllowVnetOutBound",
            "properties": {
              "access": "Allow",
              "description": "Allow outbound traffic from all VMs to all VMs in VNET",
              "destinationAddressPrefix": "VirtualNetwork",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65000,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "VirtualNetwork",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/AllowInternetOutBound",
            "name": "AllowInternetOutBound",
            "properties": {
              "access": "Allow",
              "description": "Allow outbound traffic from all VMs to Internet",
              "destinationAddressPrefix": "Internet",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65001,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/defaultSecurityRules/DenyAllOutBound",
            "name": "DenyAllOutBound",
            "properties": {
              "access": "Deny",
              "description": "Deny all outbound traffic",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "*",
              "destinationPortRanges": [],
              "direction": "Outbound",
              "priority": 65500,
              "protocol": "*",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/defaultSecurityRules"
          }
        ],
        "networkInterfaces": [
          {
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkInterfaces/jim-lin-101932_z1",
            "resourceGroup": "jim-islab-001"
          }
        ],
        "provisioningState": "Succeeded",
        "resourceGuid": "c87b1fad-fc70-4e27-bb03-ac3a1d8d475c",
        "securityRules": [
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/securityRules/SSH",
            "name": "SSH",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "22",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 300,
              "protocol": "TCP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          },
          {
            "etag": "W/\"d86ab0c1-2fe1-4b8e-9935-1d061b4e8432\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/networkSecurityGroups/JIM-LIN-101-nsg/securityRules/Allow-WG",
            "name": "Allow-WG",
            "properties": {
              "access": "Allow",
              "destinationAddressPrefix": "*",
              "destinationAddressPrefixes": [],
              "destinationPortRange": "51820",
              "destinationPortRanges": [],
              "direction": "Inbound",
              "priority": 310,
              "protocol": "UDP",
              "provisioningState": "Succeeded",
              "sourceAddressPrefix": "*",
              "sourceAddressPrefixes": [],
              "sourcePortRange": "*",
              "sourcePortRanges": []
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/networkSecurityGroups/securityRules"
          }
        ]
      },
      "type": "microsoft.network/networksecuritygroups"
    },
    {
      "name": "JIM-LIN-101-vnet",
      "properties": {
        "addressSpace": {
          "addressPrefixes": [
            "10.0.0.0/16"
          ]
        },
        "enableDdosProtection": false,
        "privateEndpointVNetPolicies": "Disabled",
        "provisioningState": "Succeeded",
        "resourceGuid": "ebf08439-26f0-4fc8-a575-8cbf1f4e577a",
        "subnets": [
          {
            "etag": "W/\"a043af45-3a35-42b5-949c-d7a167074ed2\"",
            "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/jim-islab-001/providers/Microsoft.Network/virtualNetworks/JIM-LIN-101-vnet/subnets/default",
            "name": "default",
            "properties": {
              "addressPrefix": "10.0.0.0/24",
              "delegations": [],
              "ipConfigurations": [
                {
                  "id": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/JIM-ISLAB-001/providers/Microsoft.Network/networkInterfaces/JIM-LIN-101932_Z1/ipConfigurations/IPCONFIG1",
                  "resourceGroup": "JIM-ISLAB-001"
                }
              ],
              "privateEndpointNetworkPolicies": "Disabled",
              "privateLinkServiceNetworkPolicies": "Enabled",
              "provisioningState": "Succeeded"
            },
            "resourceGroup": "jim-islab-001",
            "type": "Microsoft.Network/virtualNetworks/subnets"
          }
        ],
        "virtualNetworkPeerings": []
      },
      "type": "microsoft.network/virtualnetworks"
    },
    {
      "name": "JIM-LIN-101_OsDisk_1_1edbc1f79f6f4b7fba6dca4befdc5a08",
      "properties": {
        "LastOwnershipUpdateTime": "2024-11-16T08:04:21.9294893Z",
        "creationData": {
          "createOption": "FromImage",
          "imageReference": {
            "id": "/Subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/Providers/Microsoft.Compute/Locations/eastus/Publishers/canonical/ArtifactTypes/VMImage/Offers/ubuntu-24_04-lts/Skus/server/Versions/24.04.202409260"
          }
        },
        "diskIOPSReadWrite": 120,
        "diskMBpsReadWrite": 25,
        "diskSizeBytes": 32213303296,
        "diskSizeGB": 30,
        "diskState": "Attached",
        "encryption": {
          "type": "EncryptionAtRestWithPlatformKey"
        },
        "hyperVGeneration": "V2",
        "networkAccessPolicy": "AllowAll",
        "osType": "Linux",
        "provisioningState": "Succeeded",
        "publicNetworkAccess": "Enabled",
        "securityProfile": {
          "securityType": "TrustedLaunch"
        },
        "supportedCapabilities": {
          "acceleratedNetwork": true,
          "architecture": "x64",
          "diskControllerTypes": "SCSI, NVMe"
        },
        "supportsHibernation": true,
        "tier": "P4",
        "timeCreated": "2024-09-27T07:33:16.6637211Z",
        "uniqueId": "1edbc1f7-9f6f-4b7f-ba6d-ca4befdc5a08"
      },
      "type": "microsoft.compute/disks"
    },
    {
      "name": "MDE.Linux",
      "properties": {
        "autoUpgradeMinorVersion": true,
        "forceUpdateTag": "b217d7a8-9e28-44c1-b5d2-e5d1cb61d115",
        "provisioningState": "Succeeded",
        "publisher": "Microsoft.Azure.AzureDefenderForServers",
        "settings": {
          "autoUpdate": true,
          "azureResourceId": "/subscriptions/8ec22a89-5b71-4558-ab8c-d66de409a500/resourceGroups/JIM-ISLAB-001/providers/Microsoft.Compute/virtualMachines/JIM-LIN-101",
          "forceReOnboarding": false,
          "vNextEnabled": false
        },
        "type": "MDE.Linux",
        "typeHandlerVersion": "1.0"
      },
      "type": "microsoft.compute/virtualmachines/extensions"
    },
    {
      "name": "MSVMI-DefaultWorkspace-170a8b5b-d291-4238-af26-44482b44afd9-EUS",
      "properties": {
        "dataFlows": [
          {
            "destinations": [
              "VMInsightsPerf-Logs-Dest"
            ],
            "streams": [
              "Microsoft-InsightsMetrics"
            ]
          }
        ],
        "dataSources": {
          "performanceCounters": [
            {
              "counterSpecifiers": [
                "\\VmInsights\\DetailedMetrics"
              ],
              "name": "VMInsightsPerfCounters",
              "samplingFrequencyInSeconds": 60,
              "streams": [
                "Microsoft-InsightsMetrics"
              ]
            }
          ]
        },
        "description": "Data collection rule for VM Insights.",
        "destinations": {
          "logAnalytics": [
            {
              "name": "VMInsightsPerf-Logs-Dest",
              "workspaceId": "68721089-ecbe-4714-a1d4-fa209d912bc1",
              "workspaceResourceId": "/subscriptions/170a8b5b-d291-4238-af26-44482b44afd9/resourceGroups/DefaultResourceGroup-EUS/providers/Microsoft.OperationalInsights/workspaces/DefaultWorkspace-170a8b5b-d291-4238-af26-44482b44afd9-EUS"
            }
          ]
        },
        "immutableId": "dcr-a82c107af82d4ab1bb91ba63beabb4d8",
        "provisioningState": "Succeeded"
      },
      "type": "microsoft.insights/datacollectionrules"
    },
    {
      "name": "NetworkWatcher_centralindia",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_eastus",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_germanywestcentral",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_germanywestcentral",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_northeurope",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_qatarcentral",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_southindia",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    },
    {
      "name": "NetworkWatcher_switzerlandnorth",
      "properties": {
        "provisioningState": "Succeeded",
        "runningOperationIds": []
      },
      "type": "microsoft.network/networkwatchers"
    }
  ],
  "skip_token": "ew0KICAiJGlkIjogIjEiLA0KICAiTWF4Um93cyI6IDEwMCwNCiAgIlJvd3NUb1NraXAiOiAxMDAsDQogICJLdXN0b0NsdXN0ZXJVcmwiOiAiaHR0cHM6Ly9hcmctd3VzMi10aHJlZS1zZi5hcmcuY29yZS53aW5kb3dzLm5ldCINCn0=",
  "total_records": 466
}
